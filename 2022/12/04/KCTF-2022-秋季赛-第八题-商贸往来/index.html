<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>KCTF 2022 秋季赛第八题 - 商贸往来 | in1t's blog</title><meta name="keywords" content="逆向,Writeup"><meta name="author" content="in1t"><meta name="copyright" content="in1t"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一次做看雪的 CTF 赛题，感觉还行，就是有点累">
<meta property="og:type" content="article">
<meta property="og:title" content="KCTF 2022 秋季赛第八题 - 商贸往来">
<meta property="og:url" content="https://in1t.top/2022/12/04/KCTF-2022-%E7%A7%8B%E5%AD%A3%E8%B5%9B-%E7%AC%AC%E5%85%AB%E9%A2%98-%E5%95%86%E8%B4%B8%E5%BE%80%E6%9D%A5/index.html">
<meta property="og:site_name" content="in1t&#39;s blog">
<meta property="og:description" content="第一次做看雪的 CTF 赛题，感觉还行，就是有点累">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://in1t.top/img/cover/kctf2022-autumn.jpg">
<meta property="article:published_time" content="2022-12-04T12:05:55.000Z">
<meta property="article:modified_time" content="2022-12-14T09:30:05.983Z">
<meta property="article:author" content="in1t">
<meta property="article:tag" content="逆向">
<meta property="article:tag" content="Writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://in1t.top/img/cover/kctf2022-autumn.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://in1t.top/2022/12/04/KCTF-2022-%E7%A7%8B%E5%AD%A3%E8%B5%9B-%E7%AC%AC%E5%85%AB%E9%A2%98-%E5%95%86%E8%B4%B8%E5%BE%80%E6%9D%A5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'KCTF 2022 秋季赛第八题 - 商贸往来',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-14 17:30:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">45</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/kctf2022-autumn.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">in1t's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">KCTF 2022 秋季赛第八题 - 商贸往来</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-04T12:05:55.000Z" title="发表于 2022-12-04 20:05:55">2022-12-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-14T09:30:05.983Z" title="更新于 2022-12-14 17:30:05">2022-12-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>本题我愿称之为 ”非常 6 + 1“，一题更比 6 题强，下图是题目概况：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/article/20221204/1.png" alt="challenge_info"></p>
<p>运行 32 位程序 <code>crackme.exe</code>，弹出一个经典 CM 界面，如下图所示。点击 check 按钮时，若输入的序列号错误，程序退出。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/article/20221204/2.png" alt="challenge_info"></p>
<h2 id="管中窥豹"><a href="#管中窥豹" class="headerlink" title="管中窥豹"></a>管中窥豹</h2><p>该程序没有 main 函数，在 sub_402D4C 里首先通过 PEB 找到 kernel32 模块，拿到两个关键函数 GetProcAddress 和 LoadLibraryA。借助它们找到本函数内所需的所有导入函数，并将一众函数指针保存到自定义结构体中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">custom</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> kernel32_hModule;</span><br><span class="line">    HMODULE (__stdcall *LoadLibraryA)(LPCSTR lpLibFileName);</span><br><span class="line">    FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName);</span><br><span class="line">    <span class="comment">// LocalAlloc</span></span><br><span class="line">    <span class="comment">// ExitProcess</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>之后创建了一个事件 <code>poision132</code>（估计是用来防止多开的）与主对话框：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/article/20221204/3.png" alt="sub_402D4C"></p>
<p>其中 GetModuleHandleW 的后四个参数实为 DialogBoxParamA 的参数，因为汇编里它们四个在调用 GetModuleHandleW 前就入栈了，IDA 没能分辨出来。</p>
<p>对话框对应的函数是这样处理 check 按下的：</p>
<div class="hide-block"><button type="button" class="hide-button button--animated" style="">查看长代码
    </button><div class="hide-content"><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( v22 == <span class="number">273</span> &amp;&amp; a3 == <span class="number">1002</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v40 = custom;</span><br><span class="line">  v21 = (*(custom + <span class="number">92</span>))(a1, <span class="number">1001</span>);           <span class="comment">// GetDlgItem</span></span><br><span class="line">  <span class="keyword">if</span> ( v21 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x100</span>; ++i )</span><br><span class="line">      input[i] = <span class="number">0</span>;</span><br><span class="line">    input_len = (*(v40 + <span class="number">96</span>))(v21);           <span class="comment">// GetWindowTextLengthA</span></span><br><span class="line">    <span class="keyword">if</span> ( input_len &lt;= <span class="number">210</span> &amp;&amp; input_len &gt;= <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      (*(v40 + <span class="number">100</span>))(v21, input, <span class="number">255</span>);        <span class="comment">// GetWindowTextA</span></span><br><span class="line">      input_len = (*(v40 + <span class="number">24</span>))(input);       <span class="comment">// lstrlenA</span></span><br><span class="line">      <span class="keyword">if</span> ( input_len &gt;= <span class="number">1</span> &amp;&amp; input_len &lt;= <span class="number">128</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> ( j = input_len; j &lt; <span class="number">128</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( j % <span class="number">2</span> )</span><br><span class="line">            input[j] = <span class="number">32</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            input[j] = <span class="number">127</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v39 = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v39 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v39 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v39 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v39 )</span><br><span class="line">  &#123;</span><br><span class="line">    v48 = custom;</span><br><span class="line">    <span class="keyword">if</span> ( (*(custom + <span class="number">56</span>))(<span class="number">0</span>, crackme_exe_path, <span class="number">255</span>) )<span class="comment">// GetModuleFileNameW</span></span><br><span class="line">    &#123;</span><br><span class="line">      v27 = <span class="number">104</span>;</span><br><span class="line">      v28 = <span class="number">0</span>;</span><br><span class="line">      v29 = <span class="number">-72</span>;</span><br><span class="line">      v30 = <span class="number">0</span>;</span><br><span class="line">      v31 = <span class="number">-1</span>;</span><br><span class="line">      v32 = <span class="number">-48</span>;</span><br><span class="line">      v19 = <span class="number">0</span>;</span><br><span class="line">      v36 = <span class="number">0</span>;</span><br><span class="line">      v8[<span class="number">17</span>] = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">0x44</span>; ++k )</span><br><span class="line">        *(v8 + k) = <span class="number">0</span>;</span><br><span class="line">      v8[<span class="number">0</span>] = <span class="number">68</span>;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">0x10</span>; ++m )</span><br><span class="line">        *(&amp;v42 + m) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (*(v48 + <span class="number">28</span>))(crackme_exe_path, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, CREATE_SUSPENDED, <span class="number">0</span>, <span class="number">0</span>, v8, &amp;v42) )<span class="comment">// CreateProcessW</span></span><br><span class="line">      &#123;</span><br><span class="line">        v6[<span class="number">0</span>] = <span class="number">65543</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !(*(v48 + <span class="number">32</span>))(v43, v6) )        <span class="comment">// GetThreadContext</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_69;</span><br><span class="line">        v19 = v6[<span class="number">44</span>];</span><br><span class="line">        v36 = (*(v48 + <span class="number">44</span>))(v42, <span class="number">0</span>, <span class="number">128</span>, <span class="number">4096</span>, <span class="number">4</span>);<span class="comment">// VirtualAllocEx</span></span><br><span class="line">        <span class="keyword">if</span> ( !v36 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_69;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; <span class="number">0x80</span>; n += v17 )</span><br><span class="line">        &#123;</span><br><span class="line">          v17 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> ( !(*(v48 + <span class="number">48</span>))(v42, n + v36, &amp;input[n], <span class="number">128</span> - n, &amp;v17) )<span class="comment">// WriteProcessMemory</span></span><br><span class="line">          &#123;</span><br><span class="line">            v16 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_45;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        v16 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !v16 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_69;</span><br><span class="line">LABEL_45:</span><br><span class="line">        v20 = (*(v48 + <span class="number">20</span>))(<span class="number">0</span>);               <span class="comment">// GetModuleHandleW</span></span><br><span class="line">        v10 = *(v20 + <span class="number">60</span>) + v20;</span><br><span class="line">        v9 = v19 - *(v10 + <span class="number">40</span>);</span><br><span class="line">        v11 = sub_B31000 - v20;</span><br><span class="line">        v28 = v36;</span><br><span class="line">        v30 = sub_B31000 + v9 - v20;</span><br><span class="line">        <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt; <span class="number">0xC</span>; ii += v15 )</span><br><span class="line">        &#123;</span><br><span class="line">          v15 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> ( !(*(v48 + <span class="number">48</span>))(v42, ii + v19, &amp;v27 + ii, <span class="number">12</span> - ii, &amp;v15) )<span class="comment">// WriteProcessMemory</span></span><br><span class="line">          &#123;</span><br><span class="line">            v14 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_52;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        v14 = <span class="number">1</span>;</span><br><span class="line">LABEL_52:</span><br><span class="line">        <span class="keyword">if</span> ( v14 )</span><br><span class="line">        &#123;</span><br><span class="line">          (*(v48 + <span class="number">36</span>))(v43);                 <span class="comment">// ResumeThread</span></span><br><span class="line">          v35 = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">if</span> ( (*(v48 + <span class="number">60</span>))(v42, <span class="number">30000</span>) )    <span class="comment">// WaitForSingleObject</span></span><br><span class="line">          &#123;</span><br><span class="line">            (*(v48 + <span class="number">64</span>))(v42, <span class="number">2</span>);            <span class="comment">// TerminateProcess</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v18 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> ( (*(v48 + <span class="number">52</span>))(v42, &amp;v18) &amp;&amp; v18 != <span class="number">2</span> )<span class="comment">// GetExitCodeProcess</span></span><br><span class="line">              v35 = v18;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> ( v35 == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">strcpy</span>(v25, <span class="string">&quot;Unknown Error&quot;</span>);</span><br><span class="line">            (*(v48 + <span class="number">88</span>))(<span class="number">0</span>, v25, v25, <span class="number">0</span>);    <span class="comment">// MessageBoxA</span></span><br><span class="line">            (*(v48 + <span class="number">16</span>))(<span class="number">0</span>);                 <span class="comment">// ExitProcess</span></span><br><span class="line">            v13 = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v43 )</span><br><span class="line">            &#123;</span><br><span class="line">              (*(v48 + <span class="number">64</span>))(v42, <span class="number">2</span>);          <span class="comment">// TerminateProcess</span></span><br><span class="line">              (*(v48 + <span class="number">40</span>))(v43);             <span class="comment">// CloseHandle</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( v42 )</span><br><span class="line">              (*(v48 + <span class="number">40</span>))(v42);             <span class="comment">// CloseHandle</span></span><br><span class="line">            <span class="keyword">if</span> ( v35 != <span class="number">1</span> )</span><br><span class="line">              (*(v48 + <span class="number">16</span>))(<span class="number">0</span>);               <span class="comment">// ExitProcess</span></span><br><span class="line">            v13 = v35;</span><br><span class="line">          &#125;</span><br><span class="line">          v33 = v13;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">LABEL_69:</span><br><span class="line">          v34 = <span class="number">2</span>;</span><br><span class="line">          <span class="built_in">strcpy</span>(v24, <span class="string">&quot;Unknown Error&quot;</span>);</span><br><span class="line">          (*(v48 + <span class="number">88</span>))(<span class="number">0</span>, v24, v24, <span class="number">0</span>);      <span class="comment">// MessageBoxA</span></span><br><span class="line">          (*(v48 + <span class="number">16</span>))(<span class="number">0</span>);                   <span class="comment">// ExitProcess</span></span><br><span class="line">          v12 = <span class="number">0</span>;</span><br><span class="line">          v33 = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v33 = <span class="number">-1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v33 = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v33 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">strcpy</span>(v23, <span class="string">&quot;SUCCESS!&quot;</span>);</span><br><span class="line">      <span class="built_in">strcpy</span>(v26, <span class="string">&quot;INFO&quot;</span>);</span><br><span class="line">      (*(custom + <span class="number">88</span>))(<span class="number">0</span>, v23, v26, <span class="number">0</span>);       <span class="comment">// MessageBoxA</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  (*(custom + <span class="number">16</span>))(<span class="number">0</span>);                        <span class="comment">// ExitProcess</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<p>其行为主要是：</p>
<ol>
<li>获得输入框内容，判断输入长度在 1 ~ 128 之间</li>
<li>新建一个子进程  crackme.exe 并挂起</li>
<li>在子进程中申请一片空间 A 并写入输入内容</li>
<li>将子进程 start 函数开头改为直接调用 sub_401000，并传入 A 的地址</li>
<li>启动子进程，等待子进程执行结束，获取其退出码，<strong>若为 1 则正确</strong></li>
</ol>
<p>故父进程只起到检查作用，只需关心子进程的核心逻辑 sub_401000。该函数形似 sub_402D4C，都是先找到一众函数地址，然后再执行自己的逻辑：</p>
<ol>
<li>通过 Decompress 函数解压释放代码</li>
<li>调用前 6 个加密函数对输入进行加密</li>
<li>调用最后一个函数对输入进行最后一次加密的同时校验输入</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/article/20221204/4.png" alt="sub_401000"></p>
<p>因此，本题的题意应该就是分析这 7 种加密方式再写脚本还原了。</p>
<h2 id="一叶障目"><a href="#一叶障目" class="headerlink" title="一叶障目"></a>一叶障目</h2><p>一开始我用 x32dbg 启动父进程，用 IDA 附加子进程。在跟进第一个加密函数后，天真的我按下了 F5，当听到电脑的风扇声时，我意识到问题没有那么简单。同时，我发现对同一组输入，输出的加密结果竟然每次都不一样，那八成是存在调试器检测了。</p>
<p>反正也反编译不出来，所以我交换了一下，用 IDA 与 x32dbg 来分别调试父、子进程，方便用插件隐藏调试器。这次对于同一组输入，输出果然固定了下来。</p>
<p>在汇编层面进行一些分析后，我发现本题的每个加密函数中都存在非常多的无用代码，应该是用来做代码膨胀的，这直接导致 IDA 需要分析大量无用逻辑来生成伪代码。虽然一直等下去有可能能跑出来，但是我怕还没看到伪代码就该下一题了，于是就采用选择明文攻击及对输入下硬件访问断点（简称连蒙带猜）来找到和还原加密逻辑。</p>
<h2 id="山重水复"><a href="#山重水复" class="headerlink" title="山重水复"></a>山重水复</h2><h3 id="第一次加密"><a href="#第一次加密" class="headerlink" title="第一次加密"></a>第一次加密</h3><ol>
<li>找到 128 以内的质数作为下标数组，访问输入，对对应下标的字符进行查表替换</li>
<li>与已知数组逐字节异或</li>
</ol>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc1</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;b466efcad9ebb6423614b123b5abd400b0bb96e430a87e5e872daa0147a03dd2dae185f5ff0cfdad07aff2c8739446fce77f1570baf3085f0aa38d1fe6056dc44d31881799c6b26b831c80db6927fac22eec4b2f62a4d339bc6a4a8633bf929144b9cdacf6976ce9906554747609e249f0f9a2139a1632f4823f6f290b5a22b39c4e68d0c1e041ae6428d5048f9f78cc1d180d675be5487b19edd7dd55590e258e2c4012601e10bdc571f851c721c01b45e83ba1f76e2b8cb7d60fde35892a1a7d95d1723ca53411b8525c75ee9bf1fba96179c9203ec337817ccb5798dcbe243a586302d8ea4f43849d064c9efee3a7a68a0356938b7ace385326cfdf775d50&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pp = <span class="string">b&quot;0123456789ABCDEF&quot;</span> * <span class="number">8</span></span><br><span class="line">    ee = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;3031157034f3365f3839418843994546307f32703435365f38394142439945b23031323334f3363738a34188434445b23031323334f336373839418543994546303132703435365f38a34142434445b2303132703435363738a3414243444546307f323334f3365f3839418843994546307f32333435363738394142434445b2&quot;</span>)</span><br><span class="line">    idxs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ee)):</span><br><span class="line">        <span class="keyword">if</span> ee[i] != pp[i]:</span><br><span class="line">            idxs.append(i)</span><br><span class="line"></span><br><span class="line">    cc = <span class="built_in">list</span>(pp)</span><br><span class="line">    cipher = <span class="built_in">list</span>(plain)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> idxs:</span><br><span class="line">        cc[idx] = tbl[pp[idx]]</span><br><span class="line">        cipher[idx] = tbl[plain[idx]]</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;0b3a177e1fc61b4a70304b8958ad0560115632373b7020731c1a5b55059e658c232e150c31cf3507288173885e5c76ba2200731d2ab0130124117b8501a47d0f3c250b7470021c4617a5434146434ebf2122256d2b101f1c17967a7f00030c096326535653985b2e47bac803d60ed8e597d281868bf4f3f0ebe6a2a7aaabb449&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">        cipher[i] ^= cc[i] ^ rr[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipher)</span><br></pre></td></tr></table></figure>

<h3 id="第二次加密"><a href="#第二次加密" class="headerlink" title="第二次加密"></a>第二次加密</h3><ol>
<li>逐字节查表替换</li>
<li>前后 64 字节位置调换</li>
<li>按 32 字节划分为 4 组，1、3 组位置交换</li>
<li>与已知数组逐字节异或</li>
<li>2、4 组位置交换</li>
<li>与已知数组逐字节异或</li>
</ol>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc2</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;38393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637716e66655e61696b5d64676f5c606a7063685b6d5f626c8788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff72737475767778797a7b7c7d7e7f80818283848586&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pp = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;5a69aef84e591d6a7a3a3ef22d6b781f40e463b16a23265316102e227058189d727d445b60503301225206f32b2f0bab7353224a7b2f15072e1b0efe746200706d765af221511a661d763636333033ae707174eb7a43191a1d450f08757071763294020102075d0e4db0bd78a3c8a59ac660d0d1daa7f5f6e1ecd7d0dfd8c958&quot;</span>)</span><br><span class="line">    cc = <span class="built_in">list</span>(pp)</span><br><span class="line">    cipher = <span class="built_in">list</span>(plain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        cc[i] = tbl[pp[i]]</span><br><span class="line">        cipher[i] = tbl[plain[i]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        cc[i], cc[<span class="number">0x80</span>-i-<span class="number">1</span>] = cc[<span class="number">0x80</span>-i-<span class="number">1</span>], cc[i]</span><br><span class="line">        cipher[i], cipher[<span class="number">0x80</span>-i-<span class="number">1</span>] = cipher[<span class="number">0x80</span>-i-<span class="number">1</span>], cipher[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        cc[i], cc[<span class="number">0x40</span>+i] = cc[<span class="number">0x40</span>+i], cc[i]</span><br><span class="line">        cipher[i], cipher[<span class="number">0x40</span>+i] = cipher[<span class="number">0x40</span>+i], cipher[i]</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;680567cabc021234390d1ed230593e9cc250360d412f2e553e2e386c711999bb8f646b9c500264121a186ac43ec4222d93415f434746dd02370b7402256ad50455bf8f97818915916565a6f4fad443f8868aefa6a5fcf10159470c16141db429977f1142703e7e7940727203b2288f6a2ff41971056669f0183c5c4013ae0458&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">        cipher[i] ^= cc[i] ^ rr[i]</span><br><span class="line"></span><br><span class="line">    cc = <span class="built_in">list</span>(rr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        cc[<span class="number">0x20</span>+i], cc[<span class="number">0x60</span>+i] = cc[<span class="number">0x60</span>+i], cc[<span class="number">0x20</span>+i]</span><br><span class="line">        cipher[<span class="number">0x20</span>+i], cipher[<span class="number">0x60</span>+i] = cipher[<span class="number">0x60</span>+i], cipher[<span class="number">0x20</span>+i]</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;f6b0c1702bb6869da6bcba77bde9b92f51db99a5efa3a6d4b8b2bcc0c781342b14dd80ccd0a3e8c0e7c0f79a198205f8b46e99fe90e4ca51afb5e498ca74df8488615077606bf6758083411c1369ac087036514d500731f9b5a9b3efeee95eda7ddf9a71a7c3a6d1deddac03f60de8e65f8c918c97970fd1e3dea2d5db962af9&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">        cipher[i] ^= cc[i] ^ rr[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipher)</span><br></pre></td></tr></table></figure>

<h3 id="第三次加密"><a href="#第三次加密" class="headerlink" title="第三次加密"></a>第三次加密</h3><ol>
<li>相邻字节两两交换位置</li>
<li>与已知数组逐字节错位异或</li>
<li>前后 64 字节位置调换</li>
<li>逐字节加 0x80</li>
</ol>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc3</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;c4189868c047179a23f21a2f75ffd837eb1c7d1861cdf1b74914c18590e1616d7bd4f82307d23443325c3c1aeddff337e4ae04e36d2506bd4ea1f351bd3f8ca1974465b774ac094bdb56552fe61bfc579daa9b47710921084a979b12601de096438c39b57b9bfe9e0e196ceb9a9632a14c5c7e3291bd9017d0db023a8f002eb2&quot;</span>)</span><br><span class="line">    tbl = <span class="built_in">list</span>(tbl)</span><br><span class="line">    cipher = <span class="built_in">list</span>(plain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), <span class="number">2</span>):</span><br><span class="line">        cipher[i], cipher[i+<span class="number">1</span>] = cipher[i+<span class="number">1</span>], cipher[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tbl)):</span><br><span class="line">        tbl[i] ^= cipher[(<span class="number">0x75</span> + i) % <span class="number">128</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        tbl[i], tbl[<span class="number">0x80</span>-i-<span class="number">1</span>] = tbl[<span class="number">0x80</span>-i-<span class="number">1</span>], tbl[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tbl)):</span><br><span class="line">        tbl[i] = (tbl[i] + <span class="number">0x80</span>) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(tbl)</span><br></pre></td></tr></table></figure>

<h3 id="第四次加密"><a href="#第四次加密" class="headerlink" title="第四次加密"></a>第四次加密</h3><p>与已知数组逐字节加</p>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc4</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    cipher = <span class="built_in">list</span>(plain)</span><br><span class="line"></span><br><span class="line">    pp1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;a53f0c50366abda69abc3ecf6f580d6be2286767b4b24360f7cdf44e9c88f5931131d090a4b71fd9e1e0957144ed5f7dbc2ceceece0a5291bf6db45b822f9587c5954189bf76d9d7bf713f0aa36ceeb414f393794788f7754208923f11de80144e78c441def8bb74decb3a47247b014001990f031fb08b788c3512a3361749d3&quot;</span>)</span><br><span class="line">    cc1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;a642115b4c77f1b5fdba36cb428a409f17f2309fdea03474e6d0f7519f8bf8961434d393a7ba22dce4e3987447f05876b525e5e7c7034b8ab866ad547b289082c0903c84ba71d4d2ba6c3a059e67f5bb1bfa9a804e8ffe7c490f994618e587144e78c441def8bb74decb3a472483094809a1170b27b89380943d1aab3e0c3ec8&quot;</span>)</span><br><span class="line">    dis = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pp1)):</span><br><span class="line">        dis.append((cc1[i] - pp1[i]) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">        cipher[i] += dis[i]</span><br><span class="line">        cipher[i] &amp;= <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipher)</span><br></pre></td></tr></table></figure>

<h3 id="第五次加密"><a href="#第五次加密" class="headerlink" title="第五次加密"></a>第五次加密</h3><ol>
<li>前 64 字节倒序排列</li>
<li>逐字节查表替换</li>
<li>与已知数组逐字节异或</li>
</ol>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc5</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    cipher = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>, -<span class="number">1</span>, -<span class="number">0x10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xF</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            cipher.append(plain[i+j])</span><br><span class="line">    cipher += <span class="built_in">list</span>(plain[<span class="number">0x40</span>:])</span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;d5a04a5de8a503a8dd2d980a4d8f901234023d5545b73f2cbabc07c70186df532961253e09217b85b60895300bb09e6bdbf9af51844950d210ebac2b48c56a74cdfd1d314bd6f3b381367e9c582f4c6c0513635a419b387c6519d047c4927a6fefb15783271a71d8fa2ae142a28ceaff166400561e374328ab06c9c3d3a614aeb5e6969a9d5f2615f223a7a34e8772ec208059a440f70ce7bb33ede2ee0f8eb20e3c916824754660a17932b8738b76d11fda8d22f00dc011c2e0665ed79ffe88dc7d8aca4404d417c61b94f654694f6de5be3b6ecbf18278f4def5bd2ece67c835ad7752c17fb99339f8e418bfd9cfb489cc5c1cfcaa3a7062fb5be3a99997e9&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x80</span>):</span><br><span class="line">        cipher[i] = tbl[cipher[i]]</span><br><span class="line"></span><br><span class="line">    pp = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;9620b6c3418b71c2a79c5d17937f210d436589b31ebb52c12e256660a46e84450c62a3b21370e5b91e840e67b2db5c2cb2cda71df65066990dcc285847021d46dc20489d6664cb3b66a2aca58ed8aa5ec75bedb54cec97d3361233f3ba7f15454cab44fd67625e1e67f6acb3099a2d812d3c2c0a85c2a4b540c507b86a4d6ac6&quot;</span>)</span><br><span class="line">    cc = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;1e76d27f22bf0ba060c447584fa9b895954c4a32bdc046d036cd250181466efc2f002f48486ec74947015bcc5249878f274d2cfb1ab6a9b9a362ca9cff8f586ac125846ea7c2acf7c225d7662ca5b39e5387ca66b8687d953a4d09b09436291f92e9a38ace7ce6cdd1ba7464e488dc9118143ec808ec822e4438538100d068b3&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">        cipher[i] ^= pp[i] ^ cc[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipher)</span><br></pre></td></tr></table></figure>

<h3 id="第六次加密"><a href="#第六次加密" class="headerlink" title="第六次加密"></a>第六次加密</h3><p>与已知数组逐字节异或</p>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc6</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    p = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;cf00fa1ac6497c69840b0c74e6d8c2ad50e23957b7b581e678aac75be30e61d895f5d38858be754f4dcf567f9f1cf0cc89fed6aee83cf43e20c8c8fadbc6f2cbd16eca9559b795199d171848be19fa92a30f49b7dc3ec2f54599d28e29a38546bc459e3b969792d0fb06532ac838a4c8fd72055c12d398bbd1f5ad497a5a831b&quot;</span>)</span><br><span class="line">    c = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;5a125abad541706a858bf87f4354c5ab409259b7e73511f6589a87ab23de41f885c5d2855fbf7a4d44df76ef7fec30fc005fe6ee885cb41e60e8880a1b16d2ebe11efa65eabc97298c061940be6770a8132f0907acaedbc505dbf2e563b7ad50eec6ee66e6f7b240eb0603bad868f498ed52956c62f3a8cbe1863b497658ae6b&quot;</span>)</span><br><span class="line">    tbl = [p[i] ^ c[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(p))]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([tbl[i] ^ plain[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain))])</span><br></pre></td></tr></table></figure>

<h3 id="第七次加密及校验"><a href="#第七次加密及校验" class="headerlink" title="第七次加密及校验"></a>第七次加密及校验</h3><ol>
<li>逐字节查表替换 × 7</li>
<li>加密结束，与目标数组比较</li>
</ol>
<p>Python 描述：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc7</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    tbl1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;588d51e8d4d9a5c53094c6bab325c238a4c8aaf74e2e603b3ab2a975a12316fb64e42478322631434bbcb8ac639b7e871b42b59e612a866e4cd2355ad6e9b91db77fa8537bd7de799a745f0bf001ade24a3d98651e6cd8dbabe5442221cb507615565c2972896d418c8e19e1919df2063f1a7d978a8392dc77f936cf48a0c78214e3963984b188284611afa352fe10f457f1e0ca547ca27049a72db6d090da7a67c3bd1cf6f52b9308691359624feaced3eceb5ed10e04204d0f8bbbc9bf03059ccc40dfef853e3cf3ffd50a272fee8f6a1ffd955d817355dde75b6f18c4ae450d689fc012edcd0c33f8fc2c003747bee634a666b0b49971806b07fac1170209&quot;</span>)</span><br><span class="line">    tbl2 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;35b3a22a08d483add97fb6c277933814aa1341488d79eca0f6529df8a64d30fa6124b557658ef9f0d1c3c41acd252f676aa44c17686682c7cc6343e987dd8cb2ea3f7cfc6d115db8b1bd562cc186b044056236a8399427ae7b80df73e5e233e3d3cba7859b9991d0006921e66e9806372b8bf42e95a3cf0c7119530410c96b3aee1b88e12397d6f2d54fe4be4270ffe8de5c7db9f126a9843bced2bcc6d83d501c81db2d6045493e587692c512fb9c54ba070290ef477e75af18bb51f5209a9631349f599e46bfa1ca89014a5a1f1e5bf78fb7d7fe5ee01528e7dcda725f55030d64744b29c04e78ab40226f1d09f3a516c8fd6cac8a0fed0a3c327a0b0eebb4&quot;</span>)</span><br><span class="line">    tbl3 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;7f9458886cfd2dafe88538c7287bebeeb925894fd2053a0cde8ffccb65ad45c959e12b2f4372c381db8eab010677075e74bc03628c543d3718e279840a307e2e83f95746d15b1a1f116820a76495710b5627a350bbc102e035b582d333ca4a0eef26f413b786acc83ed8759d233b934ca15ab6a0048b8a551922be61e69690c099c69ed7603241f087e9aa175f7c4b1b0d40ffb34269e410faa9d62cf5edbad9480f4ef378d014f7a66eaea870669a52801d34366b5da4ecdf0891ce9c4992a221cc2a6df8bd514d6ae55ce767b0f2f12412989b29b4b197fbc453cdda44e3dd1e6f31dc3cc576ead5f673c28d3f1ccf477aa50039fe7db215d4b863bf9f1609&quot;</span>)</span><br><span class="line">    tbl4 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;4f8a646ddee94796105c220be55999d3319533ff1821ab3d2d78291e7758844db99ff851357d2b666ec2b15e2cdc5fd742ae98371fe2439cd94bcadfec9761398334676345366270243f877e467ca203d47394a41da6bb1add8cebd6d8be93feb419a832002a0a11c94ced28f3fc8ea0a1f675c0ce0754fbb512ea914e9dc7746014ac8f385ac152501c539bf1c4e36a4a41b2e8e19071b3cc0c57f9d2ada523bd7615effdbcf5af85dae068f4c8fa69d5256b273b891655db9ee448b69aee80f7170406b0921bcfbf6f86727bf05db713ba050f01e6aa2fc35b7a026ccda32ea9c53c568882e78d3e8120cb0d79f244653a260830a7b84940d07fc6d18b0e09&quot;</span>)</span><br><span class="line">    tbl5 = <span class="string">b&#x27;\x1d\xbcs,\xdb\x81\xe3\x04\x06U\x8dF\xfcQ\x83\x00G\x14v-C\xf8\xc6\x10l\x11\x1c\xc0\x96V\x99\xbd\xd7\xeb\xa8\t\xc4=\x0ci\xea\xfd.j\xbf\x947!\x0fo(\x1f\xa7\x1bg6\x13\xd9\xff\xe8d0?\xf4q+\x8c\\p\&#x27;m@2\xa0z#\xcct\x871\xc1DN\x80&amp;c\x07\x12W\x91&lt;`h|w\xb7\x84\xae\x9c\xc9\xc2\xd0\xc3\x97\xf1B%y$\xc8\x02\xca/\xe4\xf0Or\x92\x0b\xfb\xa3n\xe7\x1eT\xc7\xa4J\xe0\xd5\x86\xb1\xf7\x8bY\xd2\x89\xf5\x08E\n:\x93\xd4\xd6&#125;\xf9&#123;\x85\x9d\xfe\xd3&quot;L;~\xbe\xab\xb0\xb9\xa9\x88\xa6\xda\xbb\xf6\x1a\x05\xde\x18&gt;\x8e\xb4\xfa\xba\xb3\xb8\xb6k\x0eK5\xcb\xec\xdc\x17\x8f \xf2*eb\x82\xf3\xa2\xcf^\xb5\xe6\xce\x9ff\xe9PR\xef[\x9e\xdd\x8a\xe2Iau\xed8\xd8\xd1\xe1)\x15\x98ZS\x01\xa5M\xcd\xc5\x90]\r9\x7f4\xdf_\x16\x03\xee\xa1\xad\x9b\xaf\xb23X\xe5\x19HA\xaa\x95\xac\x9ax&#x27;</span></span><br><span class="line">    tbl6 = <span class="string">b&#x27;V\xd6x\xdc\x8fs\xcf\x8e\x0b\x14\xaa\xfa?=\xc0\xf1)\xde\x8b:t\xb1n\x8cH\xc5\xc4R\xdd.\xd76yD\x7f\xe1\xc1\x99\xd4\x9a\xd8h\xa52WC\x17\xa2\xdf\x87\x82\xf8\xe6\xe7\xb5\x004\xb2\xc9\rX\xaeK\xad\xc3\xc7\x88\x91\n\x051dz&gt;Mb\x06m\xa4\xc6\xe3Bji\xa3\xcc\xb0\x92a\xbf\x8a!Q\x07\xa7-&amp;A\x10\x08\x19\xe2\x1ckr\xca\xb4\x18\x94U\xdaJ\xf3Y^&quot;\x0cE\xbe\xfbG@&#125;\xd0]*\xf2\x0eO/\xcd\x90\x03\x97\xff&lt;\x968\x15\x80\xec\x0f\xc2\x1b\xb3\xeb\x9b~I\xaf&#123;g\x9d$\x86\tf\xf7\\;\xd3\xfd\x04o\x1f\xd9\xb8\xa8ev\x8d\x95\xbb\xb9l\xb7\xee\x01\xf4 `\x1au\xf65\x89%\xbd\x11\x83,\xbcF\xd5\xcb\xab(w\&#x27;\xd2\xc8\xe0\xb6N\xd1\x98\xe9\xcep\xe4P+\xe8\xa1#\xa6\xfe\xedS\x9c\xa9\x127Z[\x81\xbaLT\xf9\x9e\xdb3\xea\x939\x1d\x02qc\x16\x85\x1e\x9f|\xac\xf0\xf5\x84\xef\xa00\xe5\x13_\xfc&#x27;</span></span><br><span class="line">    tbl7 = <span class="string">b&#x27; ;\xec\xbe\xb6\x87\x85\x9fS\xefW\xe0\xc3\x01\xf8:\xe7AKr)\x0bl\x04y\xfc\x18\xb4g\xce\xf0\x0eZ4\x9e\xf6\x94\xacXo\xf3\xc42\x8aU\x9c\x07\xb0e\xe3\x9bRQ\xc7\xddc\xa9\x12\x0f\x95\x80Y\x1a\xcf&#123;0\xa8\xab1/a\x16\x1cMi&quot;p\xcbu&lt;\xd3t\x91\xf1O\xa5\xe2\xfd\xbd\x11m6+\xaa\xd5\x90\xe4\x8d\xda\xb8\xa2\xaf\x1d\x98\x1f\x88*I\x82x\x99\xebGf\xca?\xa6J&amp;\xdfD\x7f\x13\xa4\xb1\x02z\xc9\x9d\x00\xd6^\xbaC\xc2\x03\xff(5\xbcdq\xdc\xa3[\xd4\xee\x83\xf7F-k&#125;\xaeb\xd9\xa7,\xc8\r\xa1\x8ej\xe8`n\xb2@%h\xf4\xb7\xb3w\xc18\xc0\xd8\xd1\xfe\xb9\&#x27;\xbfE]=\x19\xf5\xcc9\xde\x81\x9a3\xc5s\x15\\P\x89N\xa0!$\xdb\xbbV\x17_\xad\xf2\x8c\x8f\x96\x97\xe5T\x86\t\x1bB\x10H\xb5\xf9~|\x05\xd7&gt;\x067\xe6\x93\xfa\xe9v\n\x1e\xed\x0c.\xcd\xfb\x08\xea\x84\x92\xd0\xc6L\xe1#\xd2\x14\x8b&#x27;</span></span><br><span class="line"></span><br><span class="line">    cipher = <span class="built_in">list</span>(plain)</span><br><span class="line">    tbls = [tbl1, tbl2, tbl3, tbl4, tbl5, tbl6, tbl7]</span><br><span class="line">    <span class="keyword">for</span> tbl <span class="keyword">in</span> tbls:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">            cipher[i] = tbl[cipher[i]]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cipher)</span><br><span class="line"></span><br><span class="line">target = <span class="built_in">bytes</span>([<span class="number">121</span>, <span class="number">23</span>, <span class="number">66</span>, <span class="number">107</span>, <span class="number">59</span>, <span class="number">80</span>, <span class="number">122</span>, <span class="number">227</span>, <span class="number">70</span>, <span class="number">208</span>, <span class="number">222</span>, <span class="number">78</span>, <span class="number">36</span>, <span class="number">167</span>, <span class="number">138</span>, <span class="number">106</span>, <span class="number">105</span>, <span class="number">208</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">240</span>, <span class="number">39</span>, <span class="number">36</span>, <span class="number">189</span>, <span class="number">192</span>, <span class="number">187</span>, <span class="number">227</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">163</span>, <span class="number">151</span>, <span class="number">48</span>, <span class="number">60</span>, <span class="number">182</span>, <span class="number">235</span>, <span class="number">104</span>, <span class="number">144</span>, <span class="number">9</span>, <span class="number">208</span>, <span class="number">234</span>, <span class="number">17</span>, <span class="number">242</span>, <span class="number">196</span>, <span class="number">96</span>, <span class="number">165</span>, <span class="number">203</span>, <span class="number">195</span>, <span class="number">252</span>, <span class="number">69</span>, <span class="number">251</span>, <span class="number">92</span>, <span class="number">83</span>, <span class="number">192</span>, <span class="number">128</span>, <span class="number">58</span>, <span class="number">153</span>, <span class="number">89</span>, <span class="number">111</span>, <span class="number">47</span>, <span class="number">84</span>, <span class="number">74</span>, <span class="number">217</span>, <span class="number">14</span>, <span class="number">106</span>, <span class="number">52</span>, <span class="number">222</span>, <span class="number">210</span>, <span class="number">236</span>, <span class="number">175</span>, <span class="number">74</span>, <span class="number">11</span>, <span class="number">164</span>, <span class="number">138</span>, <span class="number">182</span>, <span class="number">250</span>, <span class="number">147</span>, <span class="number">31</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">68</span>, <span class="number">238</span>, <span class="number">228</span>, <span class="number">214</span>, <span class="number">158</span>, <span class="number">244</span>, <span class="number">69</span>, <span class="number">18</span>, <span class="number">77</span>, <span class="number">55</span>, <span class="number">60</span>, <span class="number">240</span>, <span class="number">17</span>, <span class="number">248</span>, <span class="number">200</span>, <span class="number">68</span>, <span class="number">118</span>, <span class="number">99</span>, <span class="number">16</span>, <span class="number">115</span>, <span class="number">45</span>, <span class="number">104</span>, <span class="number">215</span>, <span class="number">157</span>, <span class="number">47</span>, <span class="number">195</span>, <span class="number">132</span>, <span class="number">42</span>, <span class="number">182</span>, <span class="number">204</span>, <span class="number">181</span>, <span class="number">55</span>, <span class="number">97</span>, <span class="number">79</span>, <span class="number">15</span>, <span class="number">22</span>, <span class="number">188</span>, <span class="number">187</span>, <span class="number">140</span>, <span class="number">83</span>, <span class="number">39</span>, <span class="number">238</span>, <span class="number">119</span>, <span class="number">170</span>, <span class="number">31</span>, <span class="number">156</span>, <span class="number">194</span>, <span class="number">24</span>, <span class="number">222</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> enc7(enc6(enc5(enc4(enc3(enc2(enc1(user_input))))))) == target</span><br></pre></td></tr></table></figure>

<h2 id="抛砖引玉"><a href="#抛砖引玉" class="headerlink" title="抛砖引玉"></a>抛砖引玉</h2><p>第七个函数比较小，当时一不小心反编译出来，就花了点时间写去混淆的 IDAPython 脚本。原理是基于模式匹配，识别出其中的 13 种无用代码的模式，再将它们 nop 掉。脚本在该函数上效果很好，运行后基本只剩下核心逻辑，代码如下（运行前要先创建加密函数，拿到函数的起始、结束地址）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nop</span>(<span class="params">ea: <span class="built_in">int</span>, size: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">        patch_byte(ea + i, <span class="number">0x90</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printable</span>(<span class="params">hex_str: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">32</span> &lt;= <span class="built_in">int</span>(hex_str, <span class="number">16</span>) &lt; <span class="number">127</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deobfus</span>(<span class="params">start: <span class="built_in">int</span>, end: <span class="built_in">int</span></span>):</span></span><br><span class="line">    cur = start</span><br><span class="line">    <span class="keyword">while</span> cur &lt; end:</span><br><span class="line">        asm1 = generate_disasm_line(cur, <span class="number">0</span>)</span><br><span class="line">        asm2 = generate_disasm_line(cur+get_item_size(cur), <span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_(.+)\], *1000h&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;lea +eax, *\[ebp\+var_(.+)\]&quot;</span>, asm2)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m1.group(<span class="number">1</span>) == m2.group(<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;found pattern-1 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">            asm3 = generate_disasm_line(cur + <span class="number">0xd4</span> - <span class="number">6</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r&quot;mov +\[ebp\+var_(.+)\], *eax&quot;</span>, asm3):</span><br><span class="line">                nop(cur, <span class="number">0xd4</span>)</span><br><span class="line">                cur += <span class="number">0xd4</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_(.+)\], *(.&#123;2&#125;)h&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_(.+)\], *(.&#123;2&#125;)h&quot;</span>, asm2)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> <span class="built_in">int</span>(m1.group(<span class="number">1</span>), <span class="number">16</span>) - <span class="built_in">int</span>(m2.group(<span class="number">1</span>), <span class="number">16</span>) == <span class="number">1</span> <span class="keyword">and</span> printable(m1.group(<span class="number">2</span>)) <span class="keyword">and</span> printable(m2.group(<span class="number">2</span>)):</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x1d7</span> - <span class="number">2</span>, <span class="number">2</span>) == <span class="string">b&#x27;\xeb\xc7&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-2 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x1d7</span>)</span><br><span class="line">                cur += <span class="number">0x1d7</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> get_bytes(cur + <span class="number">0x1bb</span> - <span class="number">2</span>, <span class="number">2</span>) == <span class="string">b&#x27;\xeb\xc7&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-2 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x1bb</span>)</span><br><span class="line">                cur += <span class="number">0x1bb</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> get_bytes(cur + <span class="number">0x12d</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&#x27;\xE9\x5A\xFF\xFF\xFF&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-11 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x12d</span>)</span><br><span class="line">                cur += <span class="number">0x12d</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;and +\[ebp\+var_(.+)\], *0&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;lea +eax, *\[ebp\+var_(.+)\]&quot;</span>, asm2)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m1.group(<span class="number">1</span>) == m2.group(<span class="number">1</span>):</span><br><span class="line">            asm3 = generate_disasm_line(cur + <span class="number">0xb5</span> - <span class="number">7</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r&quot;or +\[ebp\+var_(.+)\], *0FFFFFFFFh&quot;</span>, asm3):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-3 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0xb5</span>)</span><br><span class="line">                cur += <span class="number">0xb5</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;and +\[ebp\+var_.+\], *0&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;and +\[ebp\+var_.+\], *0&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0x73</span>, <span class="number">0</span>)</span><br><span class="line">        m3 = re.match(<span class="string">r&quot;cmp +\[ebp\+var_.+\], *0Ah&quot;</span>, asm3)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x15c</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\x0A\xFF\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-4 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x15c</span>)</span><br><span class="line">                cur += <span class="number">0x15c</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;and +\[ebp\+var_.+\], *0&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *1&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0x90</span>, <span class="number">0</span>)</span><br><span class="line">        m3 = re.match(<span class="string">r&quot;cmp +\[ebp\+var_.+\], *5&quot;</span>, asm3)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x192</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\xF1\xFE\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-5 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x192</span>)</span><br><span class="line">                cur += <span class="number">0x192</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> get_bytes(cur + <span class="number">0x98</span>, <span class="number">2</span>) == <span class="string">b&quot;\x72\xC1&quot;</span>:</span><br><span class="line">            asm3 = generate_disasm_line(cur + <span class="number">0xb5</span> - <span class="number">0xa</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *1&quot;</span>, asm3):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-12 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0xb5</span>)</span><br><span class="line">                cur += <span class="number">0xb5</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *0Ah&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *2&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0x7a</span>, <span class="number">0</span>)</span><br><span class="line">        m3 = re.match(<span class="string">r&quot;cmp +\[ebp\+var_.+\], *9&quot;</span>, asm3)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x109</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\x64\xFF\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-6 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x109</span>)</span><br><span class="line">                cur += <span class="number">0x109</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *1&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *3&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0x92</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> <span class="string">&quot;jg&quot;</span> <span class="keyword">in</span> asm3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x14f</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\x37\xFF\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-7 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x14f</span>)</span><br><span class="line">                cur += <span class="number">0x14f</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *1&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *5&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0xc8</span>, <span class="number">0</span>)</span><br><span class="line">        m3 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *2&quot;</span>, asm3)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x198</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\xFE\xFE\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-8 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x198</span>)</span><br><span class="line">                cur += <span class="number">0x198</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *20h&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *6Dh&quot;</span>, asm2)</span><br><span class="line">        asm3 = generate_disasm_line(cur + <span class="number">0x5c</span>, <span class="number">0</span>)</span><br><span class="line">        m3 = re.match(<span class="string">r&quot;cmp +\[ebp\+var_.+\], *3&quot;</span>, asm3)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> m3:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0xf7</span> - <span class="number">5</span>, <span class="number">5</span>) == <span class="string">b&quot;\xE9\x58\xFF\xFF\xFF&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-9 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0xf7</span>)</span><br><span class="line">                cur += <span class="number">0xf7</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;and +\[ebp\+var_.+\], *0&quot;</span>, asm1)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> get_bytes(cur + <span class="number">0xe</span>, <span class="number">2</span>) == <span class="string">b&quot;\xEB\x0D&quot;</span> <span class="keyword">and</span> get_bytes(cur + <span class="number">0xc6</span>, <span class="number">5</span>) == <span class="string">b&quot;\xB9\x00\x04\x00\x00&quot;</span>:</span><br><span class="line">            asm3 = generate_disasm_line(cur + <span class="number">0x136</span> - <span class="number">6</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *eax&quot;</span>, asm3):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-10 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x136</span>)</span><br><span class="line">                cur += <span class="number">0x136</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        m1 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *3&quot;</span>, asm1)</span><br><span class="line">        m2 = re.match(<span class="string">r&quot;mov +\[ebp\+var_.+\], *2&quot;</span>, asm2)</span><br><span class="line">        <span class="keyword">if</span> m1 <span class="keyword">and</span> m2 <span class="keyword">and</span> get_bytes(cur + <span class="number">0x4c</span>, <span class="number">2</span>) == <span class="string">b&#x27;\x73\x34&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> get_bytes(cur + <span class="number">0x82</span> - <span class="number">2</span>, <span class="number">2</span>) == <span class="string">b&quot;\xEB\xBE&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;found pattern-13 at: <span class="subst">&#123;<span class="built_in">hex</span>(cur)&#125;</span>&quot;</span>)</span><br><span class="line">                nop(cur, <span class="number">0x82</span>)</span><br><span class="line">                cur += <span class="number">0x82</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        cur += get_item_size(cur)</span><br><span class="line"></span><br><span class="line">start_ea = <span class="number">0x028ADA1C</span></span><br><span class="line">end_ea = <span class="number">0x028E5FC1</span></span><br><span class="line"></span><br><span class="line">deobfus(start_ea, end_ea)</span><br><span class="line">del_items(start_ea, <span class="number">0</span>, end_ea)</span><br><span class="line">create_insn(start_ea)</span><br><span class="line">add_func(start_ea)</span><br></pre></td></tr></table></figure>

<p>不过在其他 6 个函数上用的效果不是很好，因为其他函数中还有许多 call 无用 API 的模式没有考虑。它们肯定都可以通过模式识别进行定位并去除，考虑到未知的工作量，赛中就没有再写下去了。脚本放在这里，希望能起到抛砖引玉的作用。</p>
<h2 id="柳暗花明"><a href="#柳暗花明" class="headerlink" title="柳暗花明"></a>柳暗花明</h2><p>将每个加密函数的逆函数写出来再逐个调用就得到正确的序列号了，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec1</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;b466efcad9ebb6423614b123b5abd400b0bb96e430a87e5e872daa0147a03dd2dae185f5ff0cfdad07aff2c8739446fce77f1570baf3085f0aa38d1fe6056dc44d31881799c6b26b831c80db6927fac22eec4b2f62a4d339bc6a4a8633bf929144b9cdacf6976ce9906554747609e249f0f9a2139a1632f4823f6f290b5a22b39c4e68d0c1e041ae6428d5048f9f78cc1d180d675be5487b19edd7dd55590e258e2c4012601e10bdc571f851c721c01b45e83ba1f76e2b8cb7d60fde35892a1a7d95d1723ca53411b8525c75ee9bf1fba96179c9203ec337817ccb5798dcbe243a586302d8ea4f43849d064c9efee3a7a68a0356938b7ace385326cfdf775d50&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pp = <span class="string">b&quot;0123456789ABCDEF&quot;</span> * <span class="number">8</span></span><br><span class="line">    ee = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;3031157034f3365f3839418843994546307f32703435365f38394142439945b23031323334f3363738a34188434445b23031323334f336373839418543994546303132703435365f38a34142434445b2303132703435363738a3414243444546307f323334f3365f3839418843994546307f32333435363738394142434445b2&quot;</span>)</span><br><span class="line">    idxs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ee)):</span><br><span class="line">        <span class="keyword">if</span> ee[i] != pp[i]:</span><br><span class="line">            idxs.append(i)</span><br><span class="line"></span><br><span class="line">    cc = <span class="built_in">list</span>(pp)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> idxs:</span><br><span class="line">        cc[idx] = tbl[pp[idx]]</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;0b3a177e1fc61b4a70304b8958ad0560115632373b7020731c1a5b55059e658c232e150c31cf3507288173885e5c76ba2200731d2ab0130124117b8501a47d0f3c250b7470021c4617a5434146434ebf2122256d2b101f1c17967a7f00030c096326535653985b2e47bac803d60ed8e597d281868bf4f3f0ebe6a2a7aaabb449&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">        plain[i] ^= cc[i] ^ rr[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> idxs:</span><br><span class="line">        plain[idx] = tbl.index(plain[idx])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plain)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec2</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;38393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f3031323334353637716e66655e61696b5d64676f5c606a7063685b6d5f626c8788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff72737475767778797a7b7c7d7e7f80818283848586&quot;</span>)</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;f6b0c1702bb6869da6bcba77bde9b92f51db99a5efa3a6d4b8b2bcc0c781342b14dd80ccd0a3e8c0e7c0f79a198205f8b46e99fe90e4ca51afb5e498ca74df8488615077606bf6758083411c1369ac087036514d500731f9b5a9b3efeee95eda7ddf9a71a7c3a6d1deddac03f60de8e65f8c918c97970fd1e3dea2d5db962af9&quot;</span>)</span><br><span class="line">    cc = <span class="built_in">list</span>(<span class="built_in">bytes</span>.fromhex(<span class="string">&quot;680567cabc021234390d1ed230593e9cc250360d412f2e553e2e386c711999bb8f646b9c500264121a186ac43ec4222d93415f434746dd02370b7402256ad50455bf8f97818915916565a6f4fad443f8868aefa6a5fcf10159470c16141db429977f1142703e7e7940727203b2288f6a2ff41971056669f0183c5c4013ae0458&quot;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        cc[<span class="number">0x20</span>+i], cc[<span class="number">0x60</span>+i] = cc[<span class="number">0x60</span>+i], cc[<span class="number">0x20</span>+i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        plain[i] ^= cc[i] ^ rr[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        plain[<span class="number">0x20</span>+i], plain[<span class="number">0x60</span>+i] = plain[<span class="number">0x60</span>+i], plain[<span class="number">0x20</span>+i]</span><br><span class="line"></span><br><span class="line">    rr = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;680567cabc021234390d1ed230593e9cc250360d412f2e553e2e386c711999bb8f646b9c500264121a186ac43ec4222d93415f434746dd02370b7402256ad50455bf8f97818915916565a6f4fad443f8868aefa6a5fcf10159470c16141db429977f1142703e7e7940727203b2288f6a2ff41971056669f0183c5c4013ae0458&quot;</span>)</span><br><span class="line">    pp = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;5a69aef84e591d6a7a3a3ef22d6b781f40e463b16a23265316102e227058189d727d445b60503301225206f32b2f0bab7353224a7b2f15072e1b0efe746200706d765af221511a661d763636333033ae707174eb7a43191a1d450f08757071763294020102075d0e4db0bd78a3c8a59ac660d0d1daa7f5f6e1ecd7d0dfd8c958&quot;</span>)</span><br><span class="line">    cc = <span class="built_in">list</span>(pp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        cc[i] = tbl[pp[i]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        cc[i], cc[<span class="number">0x80</span>-i-<span class="number">1</span>] = cc[<span class="number">0x80</span>-i-<span class="number">1</span>], cc[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        cc[i], cc[<span class="number">0x40</span>+i] = cc[<span class="number">0x40</span>+i], cc[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">        plain[i] ^= cc[i] ^ rr[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">        plain[i], plain[<span class="number">0x40</span>+i] = plain[<span class="number">0x40</span>+i], plain[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        plain[i], plain[<span class="number">0x80</span>-i-<span class="number">1</span>] = plain[<span class="number">0x80</span>-i-<span class="number">1</span>], plain[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        plain[i] = tbl.index(plain[i])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plain)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec3</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;c4189868c047179a23f21a2f75ffd837eb1c7d1861cdf1b74914c18590e1616d7bd4f82307d23443325c3c1aeddff337e4ae04e36d2506bd4ea1f351bd3f8ca1974465b774ac094bdb56552fe61bfc579daa9b47710921084a979b12601de096438c39b57b9bfe9e0e196ceb9a9632a14c5c7e3291bd9017d0db023a8f002eb2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        plain[i] = (plain[i] - <span class="number">0x80</span>) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        plain[i], plain[<span class="number">0x80</span>-i-<span class="number">1</span>] = plain[<span class="number">0x80</span>-i-<span class="number">1</span>], plain[i]</span><br><span class="line"></span><br><span class="line">    ret = [<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tbl)):</span><br><span class="line">        ret[(<span class="number">0x75</span> + i) % <span class="number">128</span>] = plain[i] ^ tbl[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ret), <span class="number">2</span>):</span><br><span class="line">        ret[i], ret[i+<span class="number">1</span>] = ret[i+<span class="number">1</span>], ret[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(ret)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec4</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line"></span><br><span class="line">    pp1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;a53f0c50366abda69abc3ecf6f580d6be2286767b4b24360f7cdf44e9c88f5931131d090a4b71fd9e1e0957144ed5f7dbc2ceceece0a5291bf6db45b822f9587c5954189bf76d9d7bf713f0aa36ceeb414f393794788f7754208923f11de80144e78c441def8bb74decb3a47247b014001990f031fb08b788c3512a3361749d3&quot;</span>)</span><br><span class="line">    cc1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;a642115b4c77f1b5fdba36cb428a409f17f2309fdea03474e6d0f7519f8bf8961434d393a7ba22dce4e3987447f05876b525e5e7c7034b8ab866ad547b289082c0903c84ba71d4d2ba6c3a059e67f5bb1bfa9a804e8ffe7c490f994618e587144e78c441def8bb74decb3a472483094809a1170b27b89380943d1aab3e0c3ec8&quot;</span>)</span><br><span class="line">    dis = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pp1)):</span><br><span class="line">        dis.append((cc1[i] - pp1[i]) &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">        plain[i] -= dis[i]</span><br><span class="line">        plain[i] &amp;= <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plain)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec5</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line">    tbl = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;d5a04a5de8a503a8dd2d980a4d8f901234023d5545b73f2cbabc07c70186df532961253e09217b85b60895300bb09e6bdbf9af51844950d210ebac2b48c56a74cdfd1d314bd6f3b381367e9c582f4c6c0513635a419b387c6519d047c4927a6fefb15783271a71d8fa2ae142a28ceaff166400561e374328ab06c9c3d3a614aeb5e6969a9d5f2615f223a7a34e8772ec208059a440f70ce7bb33ede2ee0f8eb20e3c916824754660a17932b8738b76d11fda8d22f00dc011c2e0665ed79ffe88dc7d8aca4404d417c61b94f654694f6de5be3b6ecbf18278f4def5bd2ece67c835ad7752c17fb99339f8e418bfd9cfb489cc5c1cfcaa3a7062fb5be3a99997e9&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pp = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;9620b6c3418b71c2a79c5d17937f210d436589b31ebb52c12e256660a46e84450c62a3b21370e5b91e840e67b2db5c2cb2cda71df65066990dcc285847021d46dc20489d6664cb3b66a2aca58ed8aa5ec75bedb54cec97d3361233f3ba7f15454cab44fd67625e1e67f6acb3099a2d812d3c2c0a85c2a4b540c507b86a4d6ac6&quot;</span>)</span><br><span class="line">    cc = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;1e76d27f22bf0ba060c447584fa9b895954c4a32bdc046d036cd250181466efc2f002f48486ec74947015bcc5249878f274d2cfb1ab6a9b9a362ca9cff8f586ac125846ea7c2acf7c225d7662ca5b39e5387ca66b8687d953a4d09b09436291f92e9a38ace7ce6cdd1ba7464e488dc9118143ec808ec822e4438538100d068b3&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">        plain[i] ^= pp[i] ^ cc[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x80</span>):</span><br><span class="line">        plain[i] = tbl.index(plain[i])</span><br><span class="line"></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>, -<span class="number">1</span>, -<span class="number">0x10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xF</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            ret.append(plain[i+j])</span><br><span class="line">    ret += plain[<span class="number">0x40</span>:]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(ret)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec6</span>(<span class="params">plain: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    p = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;cf00fa1ac6497c69840b0c74e6d8c2ad50e23957b7b581e678aac75be30e61d895f5d38858be754f4dcf567f9f1cf0cc89fed6aee83cf43e20c8c8fadbc6f2cbd16eca9559b795199d171848be19fa92a30f49b7dc3ec2f54599d28e29a38546bc459e3b969792d0fb06532ac838a4c8fd72055c12d398bbd1f5ad497a5a831b&quot;</span>)</span><br><span class="line">    c = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;5a125abad541706a858bf87f4354c5ab409259b7e73511f6589a87ab23de41f885c5d2855fbf7a4d44df76ef7fec30fc005fe6ee885cb41e60e8880a1b16d2ebe11efa65eabc97298c061940be6770a8132f0907acaedbc505dbf2e563b7ad50eec6ee66e6f7b240eb0603bad868f498ed52956c62f3a8cbe1863b497658ae6b&quot;</span>)</span><br><span class="line">    tbl = [p[i] ^ c[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(p))]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([tbl[i] ^ plain[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain))])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec7</span>(<span class="params">cipher: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span></span><br><span class="line">    tbl1 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;588d51e8d4d9a5c53094c6bab325c238a4c8aaf74e2e603b3ab2a975a12316fb64e42478322631434bbcb8ac639b7e871b42b59e612a866e4cd2355ad6e9b91db77fa8537bd7de799a745f0bf001ade24a3d98651e6cd8dbabe5442221cb507615565c2972896d418c8e19e1919df2063f1a7d978a8392dc77f936cf48a0c78214e3963984b188284611afa352fe10f457f1e0ca547ca27049a72db6d090da7a67c3bd1cf6f52b9308691359624feaced3eceb5ed10e04204d0f8bbbc9bf03059ccc40dfef853e3cf3ffd50a272fee8f6a1ffd955d817355dde75b6f18c4ae450d689fc012edcd0c33f8fc2c003747bee634a666b0b49971806b07fac1170209&quot;</span>)</span><br><span class="line">    tbl2 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;35b3a22a08d483add97fb6c277933814aa1341488d79eca0f6529df8a64d30fa6124b557658ef9f0d1c3c41acd252f676aa44c17686682c7cc6343e987dd8cb2ea3f7cfc6d115db8b1bd562cc186b044056236a8399427ae7b80df73e5e233e3d3cba7859b9991d0006921e66e9806372b8bf42e95a3cf0c7119530410c96b3aee1b88e12397d6f2d54fe4be4270ffe8de5c7db9f126a9843bced2bcc6d83d501c81db2d6045493e587692c512fb9c54ba070290ef477e75af18bb51f5209a9631349f599e46bfa1ca89014a5a1f1e5bf78fb7d7fe5ee01528e7dcda725f55030d64744b29c04e78ab40226f1d09f3a516c8fd6cac8a0fed0a3c327a0b0eebb4&quot;</span>)</span><br><span class="line">    tbl3 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;7f9458886cfd2dafe88538c7287bebeeb925894fd2053a0cde8ffccb65ad45c959e12b2f4372c381db8eab010677075e74bc03628c543d3718e279840a307e2e83f95746d15b1a1f116820a76495710b5627a350bbc102e035b582d333ca4a0eef26f413b786acc83ed8759d233b934ca15ab6a0048b8a551922be61e69690c099c69ed7603241f087e9aa175f7c4b1b0d40ffb34269e410faa9d62cf5edbad9480f4ef378d014f7a66eaea870669a52801d34366b5da4ecdf0891ce9c4992a221cc2a6df8bd514d6ae55ce767b0f2f12412989b29b4b197fbc453cdda44e3dd1e6f31dc3cc576ead5f673c28d3f1ccf477aa50039fe7db215d4b863bf9f1609&quot;</span>)</span><br><span class="line">    tbl4 = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;4f8a646ddee94796105c220be55999d3319533ff1821ab3d2d78291e7758844db99ff851357d2b666ec2b15e2cdc5fd742ae98371fe2439cd94bcadfec9761398334676345366270243f877e467ca203d47394a41da6bb1add8cebd6d8be93feb419a832002a0a11c94ced28f3fc8ea0a1f675c0ce0754fbb512ea914e9dc7746014ac8f385ac152501c539bf1c4e36a4a41b2e8e19071b3cc0c57f9d2ada523bd7615effdbcf5af85dae068f4c8fa69d5256b273b891655db9ee448b69aee80f7170406b0921bcfbf6f86727bf05db713ba050f01e6aa2fc35b7a026ccda32ea9c53c568882e78d3e8120cb0d79f244653a260830a7b84940d07fc6d18b0e09&quot;</span>)</span><br><span class="line">    tbl5 = <span class="string">b&#x27;\x1d\xbcs,\xdb\x81\xe3\x04\x06U\x8dF\xfcQ\x83\x00G\x14v-C\xf8\xc6\x10l\x11\x1c\xc0\x96V\x99\xbd\xd7\xeb\xa8\t\xc4=\x0ci\xea\xfd.j\xbf\x947!\x0fo(\x1f\xa7\x1bg6\x13\xd9\xff\xe8d0?\xf4q+\x8c\\p\&#x27;m@2\xa0z#\xcct\x871\xc1DN\x80&amp;c\x07\x12W\x91&lt;`h|w\xb7\x84\xae\x9c\xc9\xc2\xd0\xc3\x97\xf1B%y$\xc8\x02\xca/\xe4\xf0Or\x92\x0b\xfb\xa3n\xe7\x1eT\xc7\xa4J\xe0\xd5\x86\xb1\xf7\x8bY\xd2\x89\xf5\x08E\n:\x93\xd4\xd6&#125;\xf9&#123;\x85\x9d\xfe\xd3&quot;L;~\xbe\xab\xb0\xb9\xa9\x88\xa6\xda\xbb\xf6\x1a\x05\xde\x18&gt;\x8e\xb4\xfa\xba\xb3\xb8\xb6k\x0eK5\xcb\xec\xdc\x17\x8f \xf2*eb\x82\xf3\xa2\xcf^\xb5\xe6\xce\x9ff\xe9PR\xef[\x9e\xdd\x8a\xe2Iau\xed8\xd8\xd1\xe1)\x15\x98ZS\x01\xa5M\xcd\xc5\x90]\r9\x7f4\xdf_\x16\x03\xee\xa1\xad\x9b\xaf\xb23X\xe5\x19HA\xaa\x95\xac\x9ax&#x27;</span></span><br><span class="line">    tbl6 = <span class="string">b&#x27;V\xd6x\xdc\x8fs\xcf\x8e\x0b\x14\xaa\xfa?=\xc0\xf1)\xde\x8b:t\xb1n\x8cH\xc5\xc4R\xdd.\xd76yD\x7f\xe1\xc1\x99\xd4\x9a\xd8h\xa52WC\x17\xa2\xdf\x87\x82\xf8\xe6\xe7\xb5\x004\xb2\xc9\rX\xaeK\xad\xc3\xc7\x88\x91\n\x051dz&gt;Mb\x06m\xa4\xc6\xe3Bji\xa3\xcc\xb0\x92a\xbf\x8a!Q\x07\xa7-&amp;A\x10\x08\x19\xe2\x1ckr\xca\xb4\x18\x94U\xdaJ\xf3Y^&quot;\x0cE\xbe\xfbG@&#125;\xd0]*\xf2\x0eO/\xcd\x90\x03\x97\xff&lt;\x968\x15\x80\xec\x0f\xc2\x1b\xb3\xeb\x9b~I\xaf&#123;g\x9d$\x86\tf\xf7\\;\xd3\xfd\x04o\x1f\xd9\xb8\xa8ev\x8d\x95\xbb\xb9l\xb7\xee\x01\xf4 `\x1au\xf65\x89%\xbd\x11\x83,\xbcF\xd5\xcb\xab(w\&#x27;\xd2\xc8\xe0\xb6N\xd1\x98\xe9\xcep\xe4P+\xe8\xa1#\xa6\xfe\xedS\x9c\xa9\x127Z[\x81\xbaLT\xf9\x9e\xdb3\xea\x939\x1d\x02qc\x16\x85\x1e\x9f|\xac\xf0\xf5\x84\xef\xa00\xe5\x13_\xfc&#x27;</span></span><br><span class="line">    tbl7 = <span class="string">b&#x27; ;\xec\xbe\xb6\x87\x85\x9fS\xefW\xe0\xc3\x01\xf8:\xe7AKr)\x0bl\x04y\xfc\x18\xb4g\xce\xf0\x0eZ4\x9e\xf6\x94\xacXo\xf3\xc42\x8aU\x9c\x07\xb0e\xe3\x9bRQ\xc7\xddc\xa9\x12\x0f\x95\x80Y\x1a\xcf&#123;0\xa8\xab1/a\x16\x1cMi&quot;p\xcbu&lt;\xd3t\x91\xf1O\xa5\xe2\xfd\xbd\x11m6+\xaa\xd5\x90\xe4\x8d\xda\xb8\xa2\xaf\x1d\x98\x1f\x88*I\x82x\x99\xebGf\xca?\xa6J&amp;\xdfD\x7f\x13\xa4\xb1\x02z\xc9\x9d\x00\xd6^\xbaC\xc2\x03\xff(5\xbcdq\xdc\xa3[\xd4\xee\x83\xf7F-k&#125;\xaeb\xd9\xa7,\xc8\r\xa1\x8ej\xe8`n\xb2@%h\xf4\xb7\xb3w\xc18\xc0\xd8\xd1\xfe\xb9\&#x27;\xbfE]=\x19\xf5\xcc9\xde\x81\x9a3\xc5s\x15\\P\x89N\xa0!$\xdb\xbbV\x17_\xad\xf2\x8c\x8f\x96\x97\xe5T\x86\t\x1bB\x10H\xb5\xf9~|\x05\xd7&gt;\x067\xe6\x93\xfa\xe9v\n\x1e\xed\x0c.\xcd\xfb\x08\xea\x84\x92\xd0\xc6L\xe1#\xd2\x14\x8b&#x27;</span></span><br><span class="line"></span><br><span class="line">    plain = <span class="built_in">list</span>(cipher)</span><br><span class="line">    tbls = [tbl1, tbl2, tbl3, tbl4, tbl5, tbl6, tbl7]</span><br><span class="line">    <span class="keyword">for</span> tbl <span class="keyword">in</span> tbls[::-<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain)):</span><br><span class="line">            plain[i] = tbl.index(plain[i])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plain)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target = <span class="built_in">bytes</span>([<span class="number">121</span>, <span class="number">23</span>, <span class="number">66</span>, <span class="number">107</span>, <span class="number">59</span>, <span class="number">80</span>, <span class="number">122</span>, <span class="number">227</span>, <span class="number">70</span>, <span class="number">208</span>, <span class="number">222</span>, <span class="number">78</span>, <span class="number">36</span>, <span class="number">167</span>, <span class="number">138</span>, <span class="number">106</span>, <span class="number">105</span>, <span class="number">208</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">240</span>, <span class="number">39</span>, <span class="number">36</span>, <span class="number">189</span>, <span class="number">192</span>, <span class="number">187</span>, <span class="number">227</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">163</span>, <span class="number">151</span>, <span class="number">48</span>, <span class="number">60</span>, <span class="number">182</span>, <span class="number">235</span>, <span class="number">104</span>, <span class="number">144</span>, <span class="number">9</span>, <span class="number">208</span>, <span class="number">234</span>, <span class="number">17</span>, <span class="number">242</span>, <span class="number">196</span>, <span class="number">96</span>, <span class="number">165</span>, <span class="number">203</span>, <span class="number">195</span>, <span class="number">252</span>, <span class="number">69</span>, <span class="number">251</span>, <span class="number">92</span>, <span class="number">83</span>, <span class="number">192</span>, <span class="number">128</span>, <span class="number">58</span>, <span class="number">153</span>, <span class="number">89</span>, <span class="number">111</span>, <span class="number">47</span>, <span class="number">84</span>, <span class="number">74</span>, <span class="number">217</span>, <span class="number">14</span>, <span class="number">106</span>, <span class="number">52</span>, <span class="number">222</span>, <span class="number">210</span>, <span class="number">236</span>, <span class="number">175</span>, <span class="number">74</span>, <span class="number">11</span>, <span class="number">164</span>, <span class="number">138</span>, <span class="number">182</span>, <span class="number">250</span>, <span class="number">147</span>, <span class="number">31</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">68</span>, <span class="number">238</span>, <span class="number">228</span>, <span class="number">214</span>, <span class="number">158</span>, <span class="number">244</span>, <span class="number">69</span>, <span class="number">18</span>, <span class="number">77</span>, <span class="number">55</span>, <span class="number">60</span>, <span class="number">240</span>, <span class="number">17</span>, <span class="number">248</span>, <span class="number">200</span>, <span class="number">68</span>, <span class="number">118</span>, <span class="number">99</span>, <span class="number">16</span>, <span class="number">115</span>, <span class="number">45</span>, <span class="number">104</span>, <span class="number">215</span>, <span class="number">157</span>, <span class="number">47</span>, <span class="number">195</span>, <span class="number">132</span>, <span class="number">42</span>, <span class="number">182</span>, <span class="number">204</span>, <span class="number">181</span>, <span class="number">55</span>, <span class="number">97</span>, <span class="number">79</span>, <span class="number">15</span>, <span class="number">22</span>, <span class="number">188</span>, <span class="number">187</span>, <span class="number">140</span>, <span class="number">83</span>, <span class="number">39</span>, <span class="number">238</span>, <span class="number">119</span>, <span class="number">170</span>, <span class="number">31</span>, <span class="number">156</span>, <span class="number">194</span>, <span class="number">24</span>, <span class="number">222</span>])</span><br><span class="line"></span><br><span class="line">decs = [dec1, dec2, dec3, dec4, dec5, dec6, dec7]</span><br><span class="line"><span class="keyword">for</span> func <span class="keyword">in</span> decs[::-<span class="number">1</span>]:</span><br><span class="line">    target = func(target)</span><br><span class="line"><span class="built_in">print</span>(target.decode())</span><br></pre></td></tr></table></figure>

<p>得到一串神奇 flag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:*D#O+_I3;`&#125;0NfP-=2/+Y&quot;_&gt;A8S6]L|4G;UHiA5mnol^k;#OhW2!UEJf0&quot;7?Dt5m&#123;CqE*AZr~$1(zW@TBXKL&amp;2r?+3kwxC90O&#x27;%&amp;PyVo~)&#x27;Q%Z@6b&#125;REKF[cgFe/-?I</span><br></pre></td></tr></table></figure>

<hr>
<p>PS. 本题解同样发表在<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-275414.htm">看雪论坛</a>，并有幸登上<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/_Qm4Xkv2lHNQJA44ebrgMg">看雪公众号</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">in1t</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://in1t.top/2022/12/04/KCTF-2022-%E7%A7%8B%E5%AD%A3%E8%B5%9B-%E7%AC%AC%E5%85%AB%E9%A2%98-%E5%95%86%E8%B4%B8%E5%BE%80%E6%9D%A5/">https://in1t.top/2022/12/04/KCTF-2022-秋季赛-第八题-商贸往来/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://in1t.top" target="_blank">in1t's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">逆向</a><a class="post-meta__tags" href="/tags/Writeup/">Writeup</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/kctf2022-autumn.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/12/RCTF-2022-RE-wp/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/rctf2022.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RCTF 2022 RE wp</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/14/justCTF-2022-AMXX/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/justctf2022.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">justCTF 2022 - AMXX</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/02/03/buuoj-逆向刷题之旅（三）/" title="buuoj 逆向刷题之旅（三）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/buuojre3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-03</div><div class="title">buuoj 逆向刷题之旅（三）</div></div></a></div><div><a href="/2022/06/14/justCTF-2022-AMXX/" title="justCTF 2022 - AMXX"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/justctf2022.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-14</div><div class="title">justCTF 2022 - AMXX</div></div></a></div><div><a href="/2020/11/28/buuoj-逆向刷题之旅（二）/" title="buuoj 逆向刷题之旅（二）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/buuojre2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="title">buuoj 逆向刷题之旅（二）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%AD%90"><span class="toc-number">1.</span> <span class="toc-text">引子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E4%B8%AD%E7%AA%A5%E8%B1%B9"><span class="toc-number">2.</span> <span class="toc-text">管中窥豹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%8F%B6%E9%9A%9C%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">一叶障目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%B1%E9%87%8D%E6%B0%B4%E5%A4%8D"><span class="toc-number">4.</span> <span class="toc-text">山重水复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text">第一次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.2.</span> <span class="toc-text">第二次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.3.</span> <span class="toc-text">第三次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.4.</span> <span class="toc-text">第四次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.5.</span> <span class="toc-text">第五次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%8A%A0%E5%AF%86"><span class="toc-number">4.6.</span> <span class="toc-text">第六次加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E6%AC%A1%E5%8A%A0%E5%AF%86%E5%8F%8A%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.7.</span> <span class="toc-text">第七次加密及校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%9B%E7%A0%96%E5%BC%95%E7%8E%89"><span class="toc-number">5.</span> <span class="toc-text">抛砖引玉</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%B3%E6%9A%97%E8%8A%B1%E6%98%8E"><span class="toc-number">6.</span> <span class="toc-text">柳暗花明</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover/kctf2022-autumn.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By in1t</div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-orange?style=flat&logo=bitdefender" title="主题采用butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-brightgreen?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);</script><div class="js-pjax"></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="/js/modify.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="💐,🌸,💮,🏵,🌹,🥀,🌺,🌻,🌼,🌷,🌱,🌲,🌳,🌴,🌵,🌾,🌿,☘,🍀,🍁,🍂,🍃,🍇,🍈,🍉,🍊,🍋,🍌,🍍,🍎,🍏,🍐,🍑,🍒,🍓,🥝,🍅,🥥,🥑,🍆,🥔,🥕,🌽,🌶,🥒,🥬,🥦,🧄,🧅,🍄,🥜,🌰,🍞,🥐,🥖,🥨,🥯,🥞,🧇,🧀,🍖,🍗,🥩,🥓,🍔,🍟,🍕,🌭,🥪,🌮,🌯,🥙,🧆,🥚,🍳,🥘,🍲,🥣,🥗,🍿,🧈,🧂,🥫,🍱,🍘,🍙,🍚,🍛,🍜,🍠,🍢,🍣,🍤,🍥,🥮,🍡,🥟,🥠,🥡,🦪,🍨,🍩,🍪,🎂,🍰,🧁,🥧,🍫,🍬,🍭,🍮,🍯,🍼,🥛,☕,🍵,🍶,🍾,🍷,🍹,🍻,🥂,🥃,🥤,🧃,🧉,🧊,🥢,🍽,🥄" data-fontsize="20px" data-random="false" async="async"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":20,"vOffset":-65},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>