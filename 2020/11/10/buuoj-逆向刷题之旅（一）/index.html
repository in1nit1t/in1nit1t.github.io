<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>buuoj 逆向刷题之旅（一） | in1t's blog</title><meta name="keywords" content="逆向,buuoj"><meta name="author" content="in1t"><meta name="copyright" content="in1t"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="彩笔来 buu 做题了 QAQ，每道做了的我都从不同角度为其添加了关键词，本文收录了 59 道题，多数为简单题">
<meta property="og:type" content="article">
<meta property="og:title" content="buuoj 逆向刷题之旅（一）">
<meta property="og:url" content="http://in1nit1t.github.io/2020/11/10/buuoj-%E9%80%86%E5%90%91%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89/index.html">
<meta property="og:site_name" content="in1t&#39;s blog">
<meta property="og:description" content="彩笔来 buu 做题了 QAQ，每道做了的我都从不同角度为其添加了关键词，本文收录了 59 道题，多数为简单题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://in1nit1t.github.io/img/cover/buuojre1.jpg">
<meta property="article:published_time" content="2020-11-10T10:42:32.000Z">
<meta property="article:modified_time" content="2021-07-07T08:27:37.367Z">
<meta property="article:author" content="in1t">
<meta property="article:tag" content="逆向">
<meta property="article:tag" content="buuoj">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://in1nit1t.github.io/img/cover/buuojre1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://in1nit1t.github.io/2020/11/10/buuoj-%E9%80%86%E5%90%91%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buuoj 逆向刷题之旅（一）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-07 16:27:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/buuojre1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">in1t's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">buuoj 逆向刷题之旅（一）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-10T10:42:32.000Z" title="发表于 2020-11-10 18:42:32">2020-11-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-07T08:27:37.367Z" title="更新于 2021-07-07 16:27:37">2021-07-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>彩笔来 buu 做题了 QAQ，每道做了的我都从不同角度为其添加了关键词，方便 ctrl + F 查找你感兴趣的内容（搜索时请勿区分大小写），持续更新中…</p>
<p>以下是本文涉及到的关键词：</p>
<ul>
<li>架构：x86, JVM, PVM</li>
<li>文件类型：exe, elf, apk, MachO, pyc, javascript, sys</li>
<li>考点：upx, java层, base64, maze, 图形界面, DOS, patch, sha1, md5, elf运行流程, 花指令, RSA, 恺撒密码, native层, 变种base64, .NET, 混淆, tea, Unity游戏, 反调试, go语言, 固件分析, xxtea, SMC, AES_ECB, 二叉树, 数独, vm虚拟机, z3, angr,  JsFuck混淆</li>
</ul>
<p>PS. 用到的 python 脚本运行环境<strong>除特殊标注外均为 python2</strong>，<strong>如果内容有误或者图片缺失，欢迎联系我修正</strong>。</p>
<p>剩下也没啥好说的了，送大家一首歌吧，歌名就叫 re</p>
<iframe frameborder="0" border="1"
    marginwidth="0" marginheight="0"
    width=100% height=105
    src="//music.163.com/outchain/player?type=2&id=570296030&auto=0&height=60">
</iframe>

<br>

<h3 id="easyre-x86-exe"><a href="#easyre-x86-exe" class="headerlink" title="easyre |x86,exe"></a>easyre |x86,exe</h3><p>shift + F12</p>
<br>

<h3 id="reverse1-x86-exe"><a href="#reverse1-x86-exe" class="headerlink" title="reverse1 |x86,exe"></a>reverse1 |x86,exe</h3><p>shift + F12：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/reverse1/1.png" alt="easyre"></p>
<p>查看交叉引用，找到关键函数 sub_1400118C0：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/reverse1/2.png" alt="reverse1"></p>
<p>上面的 for 循环将 Str2 中的 o 都替换成 0</p>
<br>

<h3 id="reverse2-x86-elf"><a href="#reverse2-x86-elf" class="headerlink" title="reverse2 |x86,elf"></a>reverse2 |x86,elf</h3><p>反编译 main：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/reverse2/1.png" alt="reverse2"></p>
<p>fork 创建了一个子进程将 flag 中的 i 和 r 都替换成 1</p>
<br>

<h3 id="内涵的软件-x86-exe"><a href="#内涵的软件-x86-exe" class="headerlink" title="内涵的软件 | x86,exe"></a>内涵的软件 | x86,exe</h3><p>shift + F12</p>
<br>

<h3 id="新年快乐-x86-exe-upx"><a href="#新年快乐-x86-exe-upx" class="headerlink" title="新年快乐 | x86,exe,upx"></a>新年快乐 | x86,exe,upx</h3><p>exe 被 upx 压缩，到 <a target="_blank" rel="noopener" href="https://upx.github.io/">网站</a> 下载upx，使用命令 <code>upx.exe -d xnkl.exe -o xnkl_unpack.exe</code> 解压</p>
<p>ida 打开 xnkl_unpack.exe，找到 main 函数:<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/1.png" alt="新年快乐"></p>
<br>

<h3 id="BJDCTF-2nd-guessgame-x86-exe"><a href="#BJDCTF-2nd-guessgame-x86-exe" class="headerlink" title="[BJDCTF 2nd]guessgame | x86,exe"></a>[BJDCTF 2nd]guessgame | x86,exe</h3><p>shift + F12</p>
<br>

<h3 id="helloword-JVM-apk-java层"><a href="#helloword-JVM-apk-java层" class="headerlink" title="helloword | JVM,apk,java层"></a>helloword | JVM,apk,java层</h3><p>jadx 打开类 com.example.helloword.MainActivity：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/helloword/1.png" alt="helloword"></p>
<br>

<h3 id="xor-x86-MachO"><a href="#xor-x86-MachO" class="headerlink" title="xor | x86,MachO"></a>xor | x86,MachO</h3><p>main 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/xor/1.png" alt="xor"></p>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rawData = <span class="string">&quot;66 0A 6B 0C 77 26 4F 2E 40 11 78 0D 5A 3B 55 11 70 19 46 1F 76 22 4D 23 44 0E 67 06 68 0F 47 32 4F&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">target = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> rawData]</span><br><span class="line"></span><br><span class="line">flag = [target[<span class="number">0</span>]] + [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">	flag[i] = target[i] ^ target[i-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, flag))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="reverse3-x86-exe-base64"><a href="#reverse3-x86-exe-base64" class="headerlink" title="reverse3 | x86,exe,base64"></a>reverse3 | x86,exe,base64</h3><p>找到 main_0 函数，根据函数行为还原部分变量及函数名：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/reverse3/1.png" alt="reverse3"></p>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">rawData = <span class="string">&quot;e3nifIH9b_C@n@dH&quot;</span></span><br><span class="line">target = <span class="built_in">map</span>(<span class="built_in">ord</span>, rawData)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)):</span><br><span class="line">	target[i] -= i</span><br><span class="line">src = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, target))</span><br><span class="line"><span class="built_in">print</span> base64.b64decode(src)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="不一样的flag-x86-exe-maze"><a href="#不一样的flag-x86-exe-maze" class="headerlink" title="不一样的flag | x86,exe,maze"></a>不一样的flag | x86,exe,maze</h3><p>迷宫题，main 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84flag/1.png" alt="不一样的flag"></p>
<p>一维化的迷宫是 *11110100001010000101111#，根据 main 函数的判断条件，可知二维状态下一行有 5 个元素，还原二维迷宫：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84flag/2.png" alt="不一样的flag"></p>
<p>将 上下左右 映射到 1234 去就得到 flag 了</p>
<p>PS. 这道题出得不严谨，考虑这样一种情况：在一个地方反复先下后上（或者反复左右横跳），然后再走到终点，依然显示顺序正确</p>
<br>

<h3 id="SimpleRev-x86-elf"><a href="#SimpleRev-x86-elf" class="headerlink" title="SimpleRev | x86,elf"></a>SimpleRev | x86,elf</h3><p>main 函数调用 Decry 函数，下面是对该函数的分析：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/SimpleRev/1.png" alt="SimpleRev"></p>
<p>采用爆破的方式获得 flag，脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;ADSFKNDCLS&quot;</span>.lower()</span><br><span class="line">key = <span class="built_in">map</span>(<span class="built_in">ord</span>, key)</span><br><span class="line">text = <span class="string">&quot;killshadow&quot;</span></span><br><span class="line">text = <span class="built_in">map</span>(<span class="built_in">ord</span>, text)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">charSet = string.uppercase + string.lowercase</span><br><span class="line">charSet = <span class="built_in">map</span>(<span class="built_in">ord</span>, charSet)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">	<span class="keyword">for</span> char <span class="keyword">in</span> charSet:</span><br><span class="line">		<span class="keyword">if</span> text[i] == (char - <span class="number">39</span> - key[i] + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">			flag += <span class="built_in">chr</span>(char)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Java逆向解密-JVM-java层"><a href="#Java逆向解密-JVM-java层" class="headerlink" title="Java逆向解密 | JVM,java层"></a>Java逆向解密 | JVM,java层</h3><p>jadx 打开：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Java%E9%80%86%E5%90%91%E8%A7%A3%E5%AF%86/1.png" alt="Java逆向解密"></p>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">encrypt = [<span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">148</span>, <span class="number">136</span>, <span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span>]</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> encrypt:</span><br><span class="line">	flag += <span class="built_in">chr</span>((e ^ <span class="number">32</span>) - <span class="built_in">ord</span>(<span class="string">&#x27;@&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="刮开有奖-x86-exe-图形界面-base64"><a href="#刮开有奖-x86-exe-图形界面-base64" class="headerlink" title="刮开有奖 | x86,exe,图形界面,base64"></a>刮开有奖 | x86,exe,图形界面,base64</h3><p>ida 打开……好家伙，又逮到一个不用框架写图形化界面的，想办法干他一炮！</p>
<p>WinMain 中可以看到该程序就是弹一个对话框，对话框对应的函数是 DialogFunc：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/1.png" alt="刮开有奖"></p>
<p>DialogFunc 大致的逻辑就是从一个输入框中读取输入，经过一些操作后与特定的值比较：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/2.png" alt="刮开有奖"></p>
<p>但是运行起来发现找不到应有的输入框和按钮，只有一张图……当我 Resource Hacker 吃素的吗？不能惯着他，打开 RH，exe 拖进去，Dialog -&gt; 103，弄他：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/3.png" alt="刮开有奖"></p>
<p>修改后：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/4.png" alt="刮开有奖"></p>
<p>File -&gt; Save As，另存为 2.exe，再运行：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/5.png" alt="刮开有奖"></p>
<p>输入的问题解决了，接下来细看代码逻辑，遇到的第一个难关是 sub_4010F0：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/6.png" alt="刮开有奖"></p>
<p>这个函数看起来有点麻烦，还有递归的要素在里面，反正就是对 v7 开始的 10 个整数进行变换。两条路 —— 要么伪代码复制出来写个 C 跑一下，要么动态调试。这我能惯着 Visual Studio？上 OD</p>
<p>重定位一波 <code>call sub_4010F0</code> 指令的内存地址，下个断，输入框随便整个 8 位数。断下来在数据窗口中跟随 ecx ：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/7.png" alt="刮开有奖"></p>
<p>步过，再看:</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/8.png" alt="刮开有奖"></p>
<p>关闭 OD，继续怼 ida：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/9.png" alt="刮开有奖"></p>
<p>下面的判断语句中要求 <code>v4 = &quot;ak1w&quot;</code>，<code>v5 = &quot;V1Ax&quot;</code>，那 flag[2] ~ flag[7] 都知道了。再往下看：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/10.png" alt="刮开有奖"></p>
<p>现在的 v7 和 v11 经过 sub_4010F0 的变换已经变成了 ‘3’ 和 ‘J’，OK 游戏结束：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">flag = [<span class="string">&#x27;&#x27;</span>] * <span class="number">8</span></span><br><span class="line">v4 = <span class="string">&quot;ak1w&quot;</span></span><br><span class="line">v5 = <span class="string">&quot;V1Ax&quot;</span></span><br><span class="line"></span><br><span class="line">t1 = b64decode(v4)</span><br><span class="line">flag[<span class="number">5</span>] = t1[<span class="number">0</span>]</span><br><span class="line">flag[<span class="number">7</span>] = t1[<span class="number">2</span>]</span><br><span class="line">flag[<span class="number">6</span>] = t1[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">t2 = b64decode(v5)</span><br><span class="line">flag[<span class="number">3</span>] = t2[<span class="number">1</span>]</span><br><span class="line">flag[<span class="number">2</span>] = t2[<span class="number">0</span>]</span><br><span class="line">flag[<span class="number">4</span>] = t2[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag[<span class="number">0</span>] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;3&#x27;</span>) + <span class="number">34</span>)</span><br><span class="line">flag[<span class="number">1</span>] = <span class="string">&#x27;J&#x27;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<p>芜湖🛫：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/11.png" alt="刮开有奖"></p>
<br>

<h3 id="BJDCTF-2nd-8086-x86-exe-DOS"><a href="#BJDCTF-2nd-8086-x86-exe-DOS" class="headerlink" title="[BJDCTF 2nd]8086 | x86,exe,DOS"></a>[BJDCTF 2nd]8086 | x86,exe,DOS</h3><p>MS DOS 的程序我是没想到的……ida 打开，因为一个 jmp 死循环导致 ida 不识别剩下的代码，强转一下：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2nd8086/1.png" alt="BJDCTF2nd8086"></p>
<p>逻辑很简单:</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2nd8086/2.png" alt="BJDCTF2nd8086"></p>
<p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">encode = <span class="string">&quot;]U[du~|t@&#123;z@wj.&#125;.~q@gjz&#123;z@wzqW~/b;&quot;</span></span><br><span class="line">encode = <span class="built_in">map</span>(<span class="built_in">ord</span>, encode)</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> encode:</span><br><span class="line">	flag.append(<span class="built_in">chr</span>(char ^ <span class="number">0x1F</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="GKCTF2020-Check-1n-x86-exe"><a href="#GKCTF2020-Check-1n-x86-exe" class="headerlink" title="[GKCTF2020]Check_1n | x86,exe"></a>[GKCTF2020]Check_1n | x86,exe</h3><p>PS. 绝了这题作者，真有精力嗷，主办方是帮你把下个月的花呗还完了还是咋的……</p>
<p>开机让输密码，ida shift + F12，查找字符串 “密码错误” 的交叉引用，找到函数 sub_404DF0，往上找找看到密码 HelloWorld:</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GKCTF2020Check_1n/1.png" alt="GKCTF2020Check_1n"></p>
<p>访问桌面上的 flag 文件，将得到的 base64 串解码，得到 Why don’t you try the magic brick game，那就玩一下打砖块，不用动等他死了上方就会出现 flag</p>
<br>

<h3 id="findit-JVM-apk-java层"><a href="#findit-JVM-apk-java层" class="headerlink" title="findit | JVM,apk,java层"></a>findit | JVM,apk,java层</h3><p>jadx 打开：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/findit/1.png" alt="findit"></p>
<p>变量 b 拼接起来是 pvkq{m164675262033l4m49lnp7p9mnk28k75}</p>
<p>不用想了，无脑 <a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/kaisamima.php">凯撒解密</a>，位移为 10</p>
<br>

<h3 id="GXYCTF2019-luck-guy-x86-elf-patch"><a href="#GXYCTF2019-luck-guy-x86-elf-patch" class="headerlink" title="[GXYCTF2019]luck_guy | x86,elf,patch"></a>[GXYCTF2019]luck_guy | x86,elf,patch</h3><p>关键函数 get_flag：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/1.png" alt="GXYCTF2019luck_guy"></p>
<p>经过分析，得知当执行流依次经过 4、5、1 后会输出正确的 flag。两条路 —— 脚本/patch，那我能惯着 python 吗，patch 安排！</p>
<p>patch 点 1：先去到 case4</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/2.png" alt="GXYCTF2019luck_guy"></p>
<p>patch 点 2：接着执行 case5</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/3.png" alt="GXYCTF2019luck_guy"></p>
<p>patch 点 3：case5 结束后跳转到 case1</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/4.png" alt="GXYCTF2019luck_guy"></p>
<p>patch 点 4：case1 结束后退出函数</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/5.png" alt="GXYCTF2019luck_guy"></p>
<p>F5 一下可以看到，现在的执行流是正确的：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GXYCTF2019luck_guy/6.png" alt="GXYCTF2019luck_guy"></p>
<p>放到 linux 下去跑就能出 flag（等待输入那里输一个2就行）</p>
<br>

<h3 id="简单注册器-JVM-apk-java层"><a href="#简单注册器-JVM-apk-java层" class="headerlink" title="简单注册器 | JVM,apk,java层"></a>简单注册器 | JVM,apk,java层</h3><p>jadx 打开，逻辑很简单：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%AE%80%E5%8D%95%E6%B3%A8%E5%86%8C%E5%99%A8/1.png" alt="简单注册器"></p>
<p>直接把生成 flag 的部分拿出来改一下吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="string">&quot;dd2940c04462b4dd7c450528835cca15&quot;</span></span><br><span class="line">x = <span class="built_in">map</span>(<span class="built_in">ord</span>, x)</span><br><span class="line">x[<span class="number">2</span>]  = ((x[<span class="number">2</span>] + x[<span class="number">3</span>]) - <span class="number">50</span>)</span><br><span class="line">x[<span class="number">4</span>]  = ((x[<span class="number">2</span>] + x[<span class="number">5</span>]) - <span class="number">48</span>)</span><br><span class="line">x[<span class="number">30</span>] = ((x[<span class="number">31</span>] + x[<span class="number">9</span>]) - <span class="number">48</span>)</span><br><span class="line">x[<span class="number">14</span>] = ((x[<span class="number">27</span>] + x[<span class="number">28</span>]) - <span class="number">97</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	tmp = x[<span class="number">31</span> - i]</span><br><span class="line">	x[<span class="number">31</span> - i] = x[i]</span><br><span class="line">	x[i] = tmp</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, x))</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="rsa-rsa"><a href="#rsa-rsa" class="headerlink" title="rsa | rsa"></a>rsa | rsa</h3><p>额，纯密码学的题，走错分区了吧老哥，题解见 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30607659/article/details/101533319">链接</a></p>
<br>

<h3 id="GWCTF-2019-pyre-PVM-pyc"><a href="#GWCTF-2019-pyre-PVM-pyc" class="headerlink" title="[GWCTF 2019]pyre | PVM,pyc"></a>[GWCTF 2019]pyre | PVM,pyc</h3><p>用 uncompyle6 或者 <a target="_blank" rel="noopener" href="https://tool.lu/pyc/">在线网站</a> 反编译 pyc 文件，得到 python 源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Welcome to Re World!&#x27;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Your input1 is your flag~&#x27;</span></span><br><span class="line">l = <span class="built_in">len</span>(input1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    num = ((input1[i] + i) % <span class="number">128</span> + <span class="number">128</span>) % <span class="number">128</span></span><br><span class="line">    code += num</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="number">1</span>):</span><br><span class="line">    code[i] = code[i] ^ code[i + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> code</span><br><span class="line">code = [<span class="string">&#x27;\x1f&#x27;</span>, <span class="string">&#x27;\x12&#x27;</span>, <span class="string">&#x27;\x1d&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;\x06&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;\x14&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;\x1b&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;\x13&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>不想想了，爆破吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">code = [<span class="string">&#x27;\x1f&#x27;</span>, <span class="string">&#x27;\x12&#x27;</span>, <span class="string">&#x27;\x1d&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;\x06&#x27;</span>, </span><br><span class="line">		<span class="string">&#x27;\x14&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;\x1b&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, </span><br><span class="line">		<span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;\x13&#x27;</span>]</span><br><span class="line">code = <span class="built_in">map</span>(<span class="built_in">ord</span>, code)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(code) - <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">	code[i] ^= code[i+<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(code)):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">		<span class="keyword">if</span> code[i] == ((j + i) % <span class="number">128</span> + <span class="number">128</span>) % <span class="number">128</span>:</span><br><span class="line">			flag += <span class="built_in">chr</span>(j)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="CrackRTF-x86-exe-sha1-md5"><a href="#CrackRTF-x86-exe-sha1-md5" class="headerlink" title="CrackRTF | x86,exe,sha1,md5"></a>CrackRTF | x86,exe,sha1,md5</h3><p>main_0 函数检查第一个输入的部分：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/1.png" alt="CrackRTF"></p>
<p>如何判断 sub_40100A 是 sha1 哈希函数呢，点进去发现它调用 sub_401230，继续跟进：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/2.png" alt="CrackRTF"></p>
<p>根据 windows API 的尿性，CryptCreateHash 函数的第二个参数应该用来指定 hash 的类型。在 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/wincrypt/nf-wincrypt-cryptcreatehash?f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(CryptCreateHash);k(DevLang-C%252B%252B);k(TargetOS-Windows)%26rd%3Dtrue">MSDN 文档</a> 中查找该函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/3.png" alt="CrackRTF"></p>
<p>点 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id">ALG_ID</a> 进去查找 0x8004：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/4.png" alt="CrackRTF"></p>
<p>那密码 1 就能得到了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sha1Encode</span>(<span class="params">plain</span>):</span></span><br><span class="line">	sha = hashlib.sha1(plain.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">	<span class="keyword">return</span> sha.hexdigest().upper()</span><br><span class="line"></span><br><span class="line">passwd1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>, <span class="number">1000000</span>):</span><br><span class="line">	plain = <span class="built_in">str</span>(i) + <span class="string">&quot;@DBApp&quot;</span></span><br><span class="line">	<span class="keyword">if</span> sha1Encode(plain) == <span class="string">&quot;6E32D0943418C2C33385BC35A1470250DD8923A9&quot;</span>:</span><br><span class="line">		passwd1 = <span class="built_in">str</span>(i)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> passwd1</span><br><span class="line"><span class="comment"># 123321</span></span><br></pre></td></tr></table></figure>

<p>第二次输入检查：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/5.png" alt="CrackRTF"></p>
<p>同理可以确定 sub_401019 为 md5 哈希函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/6.png" alt="CrackRTF"></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/CrackRTF/7.png" alt="CrackRTF"></p>
<p>这次密码就有点难爆了，不像密码 1 暗示你它是一个 6 位整数，这里需要考虑所有可打印字符。使用脚本可能会爆很久，所以我选择使用工具 hashcat 来爆破，得到密码 2 为 <code>~!3a@0</code></p>
<p>乖乖将这俩密码依次输入程序可以得到一个 dbapp.rtf，打开就是 flag</p>
<br>

<h3 id="BJDCTF2020-JustRE-x86-exe-图形界面"><a href="#BJDCTF2020-JustRE-x86-exe-图形界面" class="headerlink" title="[BJDCTF2020]JustRE | x86,exe,图形界面"></a>[BJDCTF2020]JustRE | x86,exe,图形界面</h3><p>又是个不用框架写图形界面的，WinMain 里调用 sub_4010C0 注册 RE2 类，对应的窗体函数是 sub_4011C0。</p>
<p>Resource Hacker 查看 “测试你的手速” 对话框的资源号为 129，在 sub_4011C0 中找到对应的处理函数是 DialogFunc：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020JustRE/1.png" alt="BJDCTF2020JustRE"></p>
<p>查看 DialogFunc：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020JustRE/2.png" alt="BJDCTF2020JustRE"></p>
<br>

<h3 id="2019红帽杯-easyRE-x86-elf-elf运行流程"><a href="#2019红帽杯-easyRE-x86-elf-elf运行流程" class="headerlink" title="[2019红帽杯]easyRE | x86,elf,elf运行流程"></a>[2019红帽杯]easyRE | x86,elf,elf运行流程</h3><p>shift + F12，查找 “You found me!!!” 的交叉引用，找到 sub_4009C6。第一部分：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/1.png" alt="2019红帽杯easyRE"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">target = [<span class="number">0</span>] * <span class="number">36</span></span><br><span class="line">target[<span class="number">0</span>] = <span class="number">73</span></span><br><span class="line">target[<span class="number">1</span>] = <span class="number">111</span></span><br><span class="line">target[<span class="number">2</span>] = <span class="number">100</span></span><br><span class="line">target[<span class="number">3</span>] = <span class="number">108</span></span><br><span class="line">target[<span class="number">4</span>] = <span class="number">62</span></span><br><span class="line">target[<span class="number">5</span>] = <span class="number">81</span></span><br><span class="line">target[<span class="number">6</span>] = <span class="number">110</span></span><br><span class="line">target[<span class="number">7</span>] = <span class="number">98</span></span><br><span class="line">target[<span class="number">8</span>] = <span class="number">40</span></span><br><span class="line">target[<span class="number">9</span>] = <span class="number">111</span></span><br><span class="line">target[<span class="number">10</span>] = <span class="number">99</span></span><br><span class="line">target[<span class="number">11</span>] = <span class="number">121</span></span><br><span class="line">target[<span class="number">12</span>] = <span class="number">127</span></span><br><span class="line">target[<span class="number">13</span>] = <span class="number">121</span></span><br><span class="line">target[<span class="number">14</span>] = <span class="number">46</span></span><br><span class="line">target[<span class="number">15</span>] = <span class="number">105</span></span><br><span class="line">target[<span class="number">16</span>] = <span class="number">127</span></span><br><span class="line">target[<span class="number">17</span>] = <span class="number">100</span></span><br><span class="line">target[<span class="number">18</span>] = <span class="number">96</span></span><br><span class="line">target[<span class="number">19</span>] = <span class="number">51</span></span><br><span class="line">target[<span class="number">20</span>] = <span class="number">119</span></span><br><span class="line">target[<span class="number">21</span>] = <span class="number">125</span></span><br><span class="line">target[<span class="number">22</span>] = <span class="number">119</span></span><br><span class="line">target[<span class="number">23</span>] = <span class="number">101</span></span><br><span class="line">target[<span class="number">24</span>] = <span class="number">107</span></span><br><span class="line">target[<span class="number">25</span>] = <span class="number">57</span></span><br><span class="line">target[<span class="number">26</span>] = <span class="number">123</span></span><br><span class="line">target[<span class="number">27</span>] = <span class="number">105</span></span><br><span class="line">target[<span class="number">28</span>] = <span class="number">121</span></span><br><span class="line">target[<span class="number">29</span>] = <span class="number">61</span></span><br><span class="line">target[<span class="number">30</span>] = <span class="number">126</span></span><br><span class="line">target[<span class="number">31</span>] = <span class="number">121</span></span><br><span class="line">target[<span class="number">32</span>] = <span class="number">76</span></span><br><span class="line">target[<span class="number">33</span>] = <span class="number">64</span></span><br><span class="line">target[<span class="number">34</span>] = <span class="number">69</span></span><br><span class="line">target[<span class="number">35</span>] = <span class="number">67</span></span><br><span class="line"></span><br><span class="line">input1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> idx, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(target):</span><br><span class="line">	input1 += <span class="built_in">chr</span>(idx ^ value)</span><br><span class="line"><span class="built_in">print</span> input1</span><br></pre></td></tr></table></figure>

<p>得到的输出是 Info:The first four chars are `flag`。第二部分：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/2.png" alt="2019红帽杯easyRE"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ==&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">	target = base64.b64decode(target)</span><br><span class="line"><span class="built_in">print</span> target</span><br></pre></td></tr></table></figure>

<p>得到输出 <a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-254172.htm">[原创]看雪CTF从入门到存活（六）主动防御 </a>，访问该网站可以在评论区找到其他选手发的 flag。不过出题人的本意不是这样的，在 elf 中可以找到计算 flag 的函数。该函数在 main 函数运行结束后的 __libc_csu_fini 函数中被调用。</p>
<p>众  所  周  知，elf 从 start 函数开始执行（由 Entry point 指定），然后执行顺序是 __libc_start_main -&gt; __libc_csu_init -&gt; _init_array 中的函数 -&gt; main -&gt; __libc_csu_fini -&gt; _fini_array 中的函数。</p>
<p>这道题的 start 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/3.png" alt="2019红帽杯easyRE"></p>
<p>_init_array 地址可以在 __libc_csu_init 函数中找到：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/4.png" alt="2019红帽杯easyRE"></p>
<p>翻一翻 _init_array 和 _fini_array 中的函数，每个都点过去 F5 看一下：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/5.png" alt="2019红帽杯easyRE"></p>
<p>_fini_array 的第二个函数指针 sub_400D35 最为可疑：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/2019%E7%BA%A2%E5%B8%BD%E6%9D%AFeasyRE/6.png" alt="2019红帽杯easyRE"></p>
<p>结合之前得到的信息 Info:The first four chars are `flag`，不难推测 v8 这个四字节变量的值要拿 byte_6CC0A0 的前四字节来与 “flag” 逐字节异或。解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;40 35 20 56 5D 18 22 45 17 2F 24 6E 62 3C 27 54 48 6C 24 6E 72 3C 32 45 5B&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">target = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> target]</span><br><span class="line"></span><br><span class="line">xor = <span class="built_in">map</span>(<span class="built_in">ord</span>, <span class="string">&quot;flag&quot;</span>)</span><br><span class="line">key = [<span class="number">0</span>] * <span class="number">4</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">	key[i] = xor[i] ^ target[i]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)):</span><br><span class="line">	flag += <span class="built_in">chr</span>(key[i%<span class="number">4</span>] ^ target[i])</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Youngter-drive-x86-exe-upx-花指令"><a href="#Youngter-drive-x86-exe-upx-花指令" class="headerlink" title="Youngter-drive | x86,exe,upx,花指令"></a>Youngter-drive | x86,exe,upx,花指令</h3><p>PS. 这题出的有问题，off_418004 字符数组长度应该为 30，少的最后那个字符是 ‘y’</p>
<p>先 <code>upx.exe -d</code> 对 exe 进行解压，ida 打开，发现这玩意儿还整了个 TLS 回调来检测调试器，我想说原 exe 我都运行不起来……看看 main_0 函数的逻辑吧：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/1.png" alt="Youngter-drive"></p>
<p>StartAddress 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/2.png" alt="Youngter-drive"></p>
<p>sub_41119F 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/3.png" alt="Youngter-drive"></p>
<p>为啥上面两张图片的分辨率不一样呢？那是因为亲爱的学校又双叒叕停电了，台式机直接暴毙，只能换成笔记本，我 tm***</p>
<p>从这俩函数的行为可以判断出 StartAddress 与 sub_41119F 将会交替执行，且线程 1 会先拿到锁（信号量与锁机制）。再来研究一下 StartAddress 中调用的 sub_41112C，这个函数又调用了 sub_411940，而 sub_411940 因为添加了花指令导致 ida 无法反编译：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/4.png" alt="Youngter-drive"></p>
<p>找找是哪里出问题了，Options -&gt; General 打开栈指针、显示字节码：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/5.png" alt="Youngter-drive"></p>
<p>找到导致 ida 栈跟踪分析出错的花指令：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/6.png" alt="Youngter-drive"></p>
<p>将 <code>add esp, 8</code> nop 掉就可以愉快 F5 了（当然也可以 Alt + K 调整栈指针达到栈平衡）：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/7.png" alt="Youngter-drive"></p>
<p>反编译：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Youngter-drive/8.png" alt="Youngter-drive"></p>
<p>这个函数干的事情就是把输入的大写字母替换成 off_418000[0] 字符数组中的小写字母，把输入的小写字母替换成 off_418000[0] 字符数组中的大写字母，而且是隔一个字符处理一次（上面分析过了）</p>
<p>最后在 sub_411190 -&gt; sub_411880 函数中判断处理后的输入与 off_418004 是否逐字节相等，然而这里题目出错了，off_418004 字符数组长度应该为 30，少的那个字符是 ‘y’，上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;TOiZiZtOrYaToUwPnToBsOaOapsyS&quot;</span> + <span class="string">&#x27;y&#x27;</span></span><br><span class="line">table = <span class="string">&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;</span></span><br><span class="line">target = <span class="built_in">map</span>(<span class="built_in">ord</span>, target)</span><br><span class="line">table = <span class="built_in">map</span>(<span class="built_in">ord</span>, table)</span><br><span class="line"></span><br><span class="line">flag = [<span class="string">&#x27;&#x27;</span>] * <span class="built_in">len</span>(target)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">	<span class="keyword">if</span> i % <span class="number">2</span>:</span><br><span class="line">		<span class="keyword">if</span> target[i] &lt; <span class="number">97</span>:</span><br><span class="line">			flag[i] = <span class="built_in">chr</span>(table.index(target[i]) + <span class="number">96</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			flag[i] = <span class="built_in">chr</span>(table.index(target[i]) + <span class="number">38</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		flag[i] = <span class="built_in">chr</span>(target[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ACTF新生赛2020-easyre-x86-exe-upx"><a href="#ACTF新生赛2020-easyre-x86-exe-upx" class="headerlink" title="[ACTF新生赛2020]easyre | x86,exe,upx"></a>[ACTF新生赛2020]easyre | x86,exe,upx</h3><p><code>upx.exe -d</code> 对 exe 进行解压，ida 打开找到 main 函数，逻辑很简单：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020easyre/1.png" alt="ACTF新生赛2020easyre"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">&quot;7E 7D 7C 7B 7A 79 78 77 76 75 74 73 72 71 70 6F 6E 6D 6C 6B 6A 69 68 67 66 65 64 63 62 61 60 5F 5E 5D 5C 5B 5A 59 58 57 56 55 54 53 52 51 50 4F 4E 4D 4C 4B 4A 49 48 47 46 45 44 43 42 41 40 3F 3E 3D 3C 3B 3A 39 38 37 36 35 34 33 32 31 30 2F 2E 2D 2C 2B 2A 29 28 27 26 25 24 23 20 21 22 00&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">table = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> table]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0</span>] * <span class="number">12</span></span><br><span class="line">key[<span class="number">0</span>] = <span class="number">42</span></span><br><span class="line">key[<span class="number">1</span>] = <span class="number">70</span></span><br><span class="line">key[<span class="number">2</span>] = <span class="number">39</span></span><br><span class="line">key[<span class="number">3</span>] = <span class="number">34</span></span><br><span class="line">key[<span class="number">4</span>] = <span class="number">78</span></span><br><span class="line">key[<span class="number">5</span>] = <span class="number">44</span></span><br><span class="line">key[<span class="number">6</span>] = <span class="number">34</span></span><br><span class="line">key[<span class="number">7</span>] = <span class="number">40</span></span><br><span class="line">key[<span class="number">8</span>] = <span class="number">73</span></span><br><span class="line">key[<span class="number">9</span>] = <span class="number">63</span></span><br><span class="line">key[<span class="number">10</span>] = <span class="number">43</span></span><br><span class="line">key[<span class="number">11</span>] = <span class="number">64</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">list</span>(<span class="string">&quot;ACTF&#123;&quot;</span>) + [<span class="string">&#x27;&#x27;</span>] * <span class="number">12</span> + [<span class="string">&#x27;&#125;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">	flag[<span class="number">5</span>+i] = <span class="built_in">chr</span>(table.index(key[i]) + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="相册-JVM-apk-native层"><a href="#相册-JVM-apk-native层" class="headerlink" title="相册 | JVM,apk,native层"></a>相册 | JVM,apk,native层</h3><p>Android Killer 打开，得知入口类是 cn.baidujiayuan.ver5304.C1：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%9B%B8%E5%86%8C/1.png" alt="相册"></p>
<p>jadx 打开看看该类的 onCreate 方法：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%9B%B8%E5%86%8C/2.png" alt="相册"></p>
<p>A2、M2、C2 这几个类都比较可疑，题目让找 email 地址，就 C2 沾点边了：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%9B%B8%E5%86%8C/3.png" alt="相册"></p>
<p>右键跳到 NativeMethod 的声明处：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%9B%B8%E5%86%8C/4.png" alt="相册"></p>
<p>都是 native 层的方法，那就把 so 库拿出来（apk 后缀改成 zip，解压后 so 库在 lib 目录下），这里只有一个 arm 32 位的 libcore.so。ida 打开，找到方法 Java_com_net_cn_NativeMethod_m（JNI 开发编译时会在方法名前加上类的路径），该方法返回一个 base64 字符串：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%9B%B8%E5%86%8C/5.png" alt="相册"></p>
<p>base64 解码一下就是 flag</p>
<br>

<h3 id="SUCTF2019-SignIn-x86-elf-RSA"><a href="#SUCTF2019-SignIn-x86-elf-RSA" class="headerlink" title="[SUCTF2019]SignIn | x86,elf,RSA"></a>[SUCTF2019]SignIn | x86,elf,RSA</h3><p>main 函数逻辑：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/SUCTF2019SignIn/1.png" alt="SUCTF2019SignIn"></p>
<p>用到了一些 gmp 大数运算的函数：</p>
<ul>
<li>gmpz_init_set_str(buffer, str, radix) ：将进制为 radix 的 str 表示的数存到 buffer 中去</li>
<li>gmpz_powm(x, y, z)：return x**y % z</li>
</ul>
<p>经典 RSA 加密，把 mod 分解成 p 和 q，用 gmpy2 库解得明文 output（<strong>python3 运行</strong>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">282164587459512124844245113950593348271</span></span><br><span class="line">q = <span class="number">366669102002966856876605669837014229419</span></span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">c = <span class="built_in">int</span>(<span class="string">&quot;ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35&quot;</span>, <span class="number">16</span>)</span><br><span class="line">plain = <span class="built_in">pow</span>(c, d, p * q)</span><br><span class="line">output = <span class="string">&quot;%x&quot;</span> % plain</span><br><span class="line"><span class="built_in">print</span>(output)</span><br><span class="line"><span class="comment"># 73756374667b50776e5f405f68756e647265645f79656172737d</span></span><br></pre></td></tr></table></figure>

<p>output 是经过 Encode 函数编码过的，该函数每次取来输入的一个字节，高 4 bit 和低 4 bit 分别到 byte_202010 字符数组中去映射为新的字符，将输入的 32 字节扩展为 64 字节的 output：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/SUCTF2019SignIn/2.png" alt="SUCTF2019SignIn"></p>
<p>逆回去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">output = <span class="string">&quot;73756374667b50776e5f405f68756e647265645f79656172737d&quot;</span></span><br><span class="line">flag = [<span class="string">&#x27;&#x27;</span>] * (<span class="built_in">len</span>(output) // <span class="number">2</span>)</span><br><span class="line">mapTable = <span class="string">&quot;30 31 32 33 34 35 36 37 38 39 61 62 63 64 65 66&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">mapTable = [<span class="built_in">chr</span>(<span class="built_in">int</span>(i, <span class="number">16</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> mapTable]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(output), <span class="number">2</span>):</span><br><span class="line">	high4Bit = mapTable.index(output[i])</span><br><span class="line">	low4Bit  = mapTable.index(output[i+<span class="number">1</span>])</span><br><span class="line">	curByte  = high4Bit &lt;&lt; <span class="number">4</span> | low4Bit</span><br><span class="line">	flag[i//<span class="number">2</span>] = <span class="built_in">chr</span>(curByte)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ACTF新生赛2020-rome-x86-exe-恺撒密码"><a href="#ACTF新生赛2020-rome-x86-exe-恺撒密码" class="headerlink" title="[ACTF新生赛2020]rome | x86,exe,恺撒密码"></a>[ACTF新生赛2020]rome | x86,exe,恺撒密码</h3><p>恺撒密码，逻辑简单：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020rome/1.png" alt="ACTF新生赛2020rome"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">target = [<span class="number">0</span>] * <span class="number">16</span></span><br><span class="line">target[<span class="number">0</span>] = <span class="number">81</span></span><br><span class="line">target[<span class="number">1</span>] = <span class="number">115</span></span><br><span class="line">target[<span class="number">2</span>] = <span class="number">119</span></span><br><span class="line">target[<span class="number">3</span>] = <span class="number">51</span></span><br><span class="line">target[<span class="number">4</span>] = <span class="number">115</span></span><br><span class="line">target[<span class="number">5</span>] = <span class="number">106</span></span><br><span class="line">target[<span class="number">6</span>] = <span class="number">95</span></span><br><span class="line">target[<span class="number">7</span>] = <span class="number">108</span></span><br><span class="line">target[<span class="number">8</span>] = <span class="number">122</span></span><br><span class="line">target[<span class="number">9</span>] = <span class="number">52</span></span><br><span class="line">target[<span class="number">10</span>] = <span class="number">95</span></span><br><span class="line">target[<span class="number">11</span>] = <span class="number">85</span></span><br><span class="line">target[<span class="number">12</span>] = <span class="number">106</span></span><br><span class="line">target[<span class="number">13</span>] = <span class="number">119</span></span><br><span class="line">target[<span class="number">14</span>] = <span class="number">64</span></span><br><span class="line">target[<span class="number">15</span>] = <span class="number">108</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">list</span>(<span class="string">&quot;ACTF&#123;&quot;</span>) + [<span class="string">&#x27;&#x27;</span>] * <span class="number">16</span> + [<span class="string">&#x27;&#125;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= target[i] &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> string.uppercase:</span><br><span class="line">			<span class="keyword">if</span> target[i] == (<span class="built_in">ord</span>(j) - <span class="number">51</span>) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>):</span><br><span class="line">				flag[i+<span class="number">5</span>] = j</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= target[i] &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> string.lowercase:</span><br><span class="line">			<span class="keyword">if</span> target[i] == (<span class="built_in">ord</span>(j) - <span class="number">79</span>) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">				flag[i+<span class="number">5</span>] = j</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		flag[i+<span class="number">5</span>] = <span class="built_in">chr</span>(target[i])</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="GUET-CTF2019-re-x86-elf-upx"><a href="#GUET-CTF2019-re-x86-elf-upx" class="headerlink" title="[GUET-CTF2019]re | x86,elf,upx"></a>[GUET-CTF2019]re | x86,elf,upx</h3><p>PS. 题目有误，flag[6] = ‘1’</p>
<p>upx 解压以后，ida 打开，shift + F12 查找 “input your flag” 字符串的交叉引用，找到 main 函数（或者可以通过 start 函数直接找），逻辑很简单：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUET-CTF2019re/1.png" alt="GUET-CTF2019re"></p>
<p>Check 函数对输入的每一字节进行检查，除回去就能得到 flag 了，这里题目少了一个条件导致 flag[6] 无法确定，经尝试后 flag[6] = ‘1’：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">flag[<span class="number">0</span>] = <span class="number">166163712</span> / <span class="number">1629056</span></span><br><span class="line">flag[<span class="number">1</span>] = <span class="number">731332800</span> / <span class="number">6771600</span></span><br><span class="line">flag[<span class="number">2</span>] = <span class="number">357245568</span> / <span class="number">3682944</span></span><br><span class="line">flag[<span class="number">3</span>] = <span class="number">1074393000</span> / <span class="number">10431000</span></span><br><span class="line">flag[<span class="number">4</span>] = <span class="number">489211344</span> / <span class="number">3977328</span></span><br><span class="line">flag[<span class="number">5</span>] = <span class="number">518971936</span> / <span class="number">5138336</span></span><br><span class="line">flag[<span class="number">6</span>] = <span class="built_in">ord</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">flag[<span class="number">7</span>] = <span class="number">406741500</span> / <span class="number">7532250</span></span><br><span class="line">flag[<span class="number">8</span>] = <span class="number">294236496</span> / <span class="number">5551632</span></span><br><span class="line">flag[<span class="number">9</span>] = <span class="number">177305856</span> / <span class="number">3409728</span></span><br><span class="line">flag[<span class="number">10</span>] = <span class="number">650683500</span> / <span class="number">13013670</span></span><br><span class="line">flag[<span class="number">11</span>] = <span class="number">298351053</span> / <span class="number">6088797</span></span><br><span class="line">flag[<span class="number">12</span>] = <span class="number">386348487</span> / <span class="number">7884663</span></span><br><span class="line">flag[<span class="number">13</span>] = <span class="number">438258597</span> / <span class="number">8944053</span></span><br><span class="line">flag[<span class="number">14</span>] = <span class="number">249527520</span> / <span class="number">5198490</span></span><br><span class="line">flag[<span class="number">15</span>] = <span class="number">445362764</span> / <span class="number">4544518</span></span><br><span class="line">flag[<span class="number">17</span>] = <span class="number">174988800</span> / <span class="number">3645600</span></span><br><span class="line">flag[<span class="number">16</span>] = <span class="number">981182160</span> / <span class="number">10115280</span></span><br><span class="line">flag[<span class="number">18</span>] = <span class="number">493042704</span> / <span class="number">9667504</span></span><br><span class="line">flag[<span class="number">19</span>] = <span class="number">257493600</span> / <span class="number">5364450</span></span><br><span class="line">flag[<span class="number">20</span>] = <span class="number">767478780</span> / <span class="number">13464540</span></span><br><span class="line">flag[<span class="number">21</span>] = <span class="number">312840624</span> / <span class="number">5488432</span></span><br><span class="line">flag[<span class="number">22</span>] = <span class="number">1404511500</span> / <span class="number">14479500</span></span><br><span class="line">flag[<span class="number">23</span>] = <span class="number">316139670</span> / <span class="number">6451830</span></span><br><span class="line">flag[<span class="number">24</span>] = <span class="number">619005024</span> / <span class="number">6252576</span></span><br><span class="line">flag[<span class="number">25</span>] = <span class="number">372641472</span> / <span class="number">7763364</span></span><br><span class="line">flag[<span class="number">26</span>] = <span class="number">373693320</span> / <span class="number">7327320</span></span><br><span class="line">flag[<span class="number">27</span>] = <span class="number">498266640</span> / <span class="number">8741520</span></span><br><span class="line">flag[<span class="number">28</span>] = <span class="number">452465676</span> / <span class="number">8871876</span></span><br><span class="line">flag[<span class="number">29</span>] = <span class="number">208422720</span> / <span class="number">4086720</span></span><br><span class="line">flag[<span class="number">30</span>] = <span class="number">515592000</span> / <span class="number">9374400</span></span><br><span class="line">flag[<span class="number">31</span>] = <span class="number">719890500</span> / <span class="number">5759124</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">map</span>(<span class="built_in">chr</span>, flag)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="FlareOn4-login-javascript"><a href="#FlareOn4-login-javascript" class="headerlink" title="[FlareOn4]login | javascript"></a>[FlareOn4]login | javascript</h3><p>又是一个走错片场的题目，文本编辑器打开 html，可以看到一段 javascript 写的检查 flag 的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;prompt&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> flag = <span class="built_in">document</span>.getElementById(<span class="string">&quot;flag&quot;</span>).value;</span><br><span class="line">	<span class="keyword">var</span> rotFlag = flag.replace(<span class="regexp">/[a-zA-Z]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode((c &lt;= <span class="string">&quot;Z&quot;</span> ? <span class="number">90</span> : <span class="number">122</span>) &gt;= (c = c.charCodeAt(<span class="number">0</span>) + <span class="number">13</span>) ? c : c - <span class="number">26</span>);&#125;);</span><br><span class="line">	<span class="keyword">if</span> (<span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span> == rotFlag) &#123;</span><br><span class="line">		alert(<span class="string">&quot;Correct flag!&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		alert(<span class="string">&quot;Incorrect flag, rot again&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用正则表达式来匹配所有大小写，将其 “右移” 13 位，妥妥的恺撒加密，懒得写脚本了，上 <a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/kaisamima.php">网站</a></p>
<br>

<h3 id="V-amp-N2020-公开赛-strangeCpp-x86-exe"><a href="#V-amp-N2020-公开赛-strangeCpp-x86-exe" class="headerlink" title="[V&amp;N2020 公开赛]strangeCpp | x86,exe"></a>[V&amp;N2020 公开赛]strangeCpp | x86,exe</h3><p>shift +F12，查找字符串 “flag{…}” 的交叉引用，找到函数 sub_140013AA0，开头有一串 putchar 输出 welcome 的地方：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/VN2020%E5%85%AC%E5%BC%80%E8%B5%9BstrangeCpp/1.png" alt="VN2020公开赛strangeCpp"></p>
<p>随便点一个 byte_… 跟过去，可以发现一个长度为 17 的可疑字符数组：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/VN2020%E5%85%AC%E5%BC%80%E8%B5%9BstrangeCpp/2.png" alt="VN2020公开赛strangeCpp"></p>
<p>查找交叉引用，找到关键函数 sub_140013580：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/VN2020%E5%85%AC%E5%BC%80%E8%B5%9BstrangeCpp/3.png" alt="VN2020公开赛strangeCpp"></p>
<p>通过 <code>result == 607052314</code>，与逆向 sub_140011384 函数可以确定 key 的值，sub_140011384 逻辑如下：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/VN2020%E5%85%AC%E5%BC%80%E8%B5%9BstrangeCpp/4.png" alt="VN2020公开赛strangeCpp"></p>
<p>爆破呗，因为 python 的 int 类型没有位数限制，在左移 8 位和乘 291 时都不存在截断和溢出，所以需要手动给他截断一下（&amp; 0xFFFFFFFF）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14549744</span>):</span><br><span class="line">	<span class="keyword">if</span> ((i &lt;&lt; <span class="number">8</span>) ^ (i &gt;&gt; <span class="number">12</span>)) * <span class="number">291</span> &amp; <span class="number">0xFFFFFFFF</span> == <span class="number">607052314</span>:</span><br><span class="line">		key = i</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Key: &quot;</span> + <span class="built_in">str</span>(key)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">table = <span class="string">&quot;26 2C 21 27 3B 0D 04 75 68 34 28 25 0E 35 2D 69 3D&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">table = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> table]</span><br><span class="line"></span><br><span class="line">flag = [<span class="string">&#x27;&#x27;</span>] * <span class="built_in">len</span>(table)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(table)):</span><br><span class="line">	flag[i] = <span class="built_in">chr</span>(table[i] ^ key &amp; <span class="number">0xFF</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(flag)</span><br></pre></td></tr></table></figure>

<p>输出为</p>
<ul>
<li>Key: 123456</li>
<li>flag{MD5(theNum)}</li>
</ul>
<p>md5 一下 key 就是 flag 了</p>
<br>

<h3 id="BJDCTF2020-easy-x86-exe-patch"><a href="#BJDCTF2020-easy-x86-exe-patch" class="headerlink" title="[BJDCTF2020]easy | x86,exe,patch"></a>[BJDCTF2020]easy | x86,exe,patch</h3><p>main 函数啥事没干，函数列表里翻一翻，找到一个可疑函数 ques。分析后发现该函数不要求输入，却在不停输出，那就在 main 里 patch 一下，让执行流顺路执行该函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020easy/1.png" alt="BJDCTF2020easy"></p>
<p>运行一下得到 flag：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020easy/2.png" alt="BJDCTF2020easy"></p>
<p>不 patch 也是可以的，exe 也没有开基址重定位，OD 动态调试时直接修改 eip 到该函数即可</p>
<br>

<h3 id="ACTF新生赛2020-usualCrypt-x86-exe-变种base64"><a href="#ACTF新生赛2020-usualCrypt-x86-exe-变种base64" class="headerlink" title="[ACTF新生赛2020]usualCrypt | x86,exe,变种base64"></a>[ACTF新生赛2020]usualCrypt | x86,exe,变种base64</h3><p>main 函数逻辑很简单，就是将输入丢到 sub_401080 函数处理，结果与 byte_40E0E4 字符数组逐字节比较。</p>
<p>sub_401080 函数主体是个 base64 编码，这一点从编码表 byte_40E0A0 不难看出。但是在编码开始前，该函数调用了 sub_401000 对编码表进行了变换，OD 可以调出来：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020usualCrypt/1.png" alt="ACTF新生赛2020usualCrypt"></p>
<p>编码结束后，调用 sub_401030 对编码的结果进行大小写的翻转：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020usualCrypt/2.png" alt="ACTF新生赛2020usualCrypt"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">old_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">new_table = <span class="string">&quot;ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">target = <span class="string">&quot;zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9&quot;</span></span><br><span class="line"></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> target:</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;a&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">		tmp = <span class="built_in">ord</span>(i) - <span class="number">32</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="string">&#x27;A&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">		tmp = <span class="built_in">ord</span>(i) + <span class="number">32</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		tmp = <span class="built_in">ord</span>(i)</span><br><span class="line">	res += <span class="built_in">chr</span>(tmp)</span><br><span class="line"></span><br><span class="line">general = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	general += old_table[new_table.find(i)]</span><br><span class="line"><span class="built_in">print</span> base64.b64decode(general)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="V-amp-N2020-公开赛-CSRe-x86-exe-NET-混淆"><a href="#V-amp-N2020-公开赛-CSRe-x86-exe-NET-混淆" class="headerlink" title="[V&amp;N2020 公开赛]CSRe | x86,exe,.NET,混淆"></a>[V&amp;N2020 公开赛]CSRe | x86,exe,.NET,混淆</h3><p>怎么看出有混淆的呢？用 Reflector 打开后发现类名都是不可见字符，还有一堆莫名其妙的计算函数，经验告诉我它被混淆了，当然也可以用诸如 Exeinfo PE 这样的工具来检查</p>
<p>.NET 框架的程序去混淆需要用到 <strong>de4dot</strong>，你可以在 <a target="_blank" rel="noopener" href="https://github.com/de4dot/de4dot">github</a> 下载源码来编译最新版，也可以下载别人已经编译好的 <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1045680-1-1.html">稍旧一些的版本</a>，使用方法就是 <code>de4dot.exe xxx.exe</code>，会在当前目录下生成 xxx-cleaned.exe</p>
<p>去混淆后再用 Reflector 打开，找到 main 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/VN2020%E5%85%AC%E5%BC%80%E8%B5%9BCSRe/1.png" alt="VN2020公开赛CSRe"></p>
<p>两个 sha1 拿去网站一查，一个是 314159，另一个是 return，所以 str 和 str2 分别是 1415 和 turn</p>
<br>

<h3 id="MRCTF2020-Transform-x86-exe"><a href="#MRCTF2020-Transform-x86-exe" class="headerlink" title="[MRCTF2020]Transform | x86,exe"></a>[MRCTF2020]Transform | x86,exe</h3><p>main 逻辑挺简单的，直接上脚本吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;67 79 7B 7F 75 2B 3C 52 53 79 57 5E 5D 42 7B 2D 2A 66 42 7E 4C 57 79 41 6B 7E 65 3C 5C 45 6F 62 4D&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">target = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> target]</span><br><span class="line">table = [<span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">24</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">3</span>, <span class="number">17</span>, <span class="number">32</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">30</span>, <span class="number">27</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">2</span>, <span class="number">25</span>, <span class="number">5</span>, <span class="number">31</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">14</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag = [<span class="number">0</span>] * <span class="number">33</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">	flag[table[i]] = table[i] ^ target[i]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, flag))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="GWCTF-2019-xxor-x86-elf-tea"><a href="#GWCTF-2019-xxor-x86-elf-tea" class="headerlink" title="[GWCTF 2019]xxor | x86,elf,tea"></a>[GWCTF 2019]xxor | x86,elf,tea</h3><p>main 函数分析并还原符号：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GWCTF2019xxor/1.png" alt="GWCTF2019xxor"></p>
<p>普通 tea 解密很简单，完全反过来就行（C++ 32位）：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TeaDecode</span><span class="params">(<span class="keyword">unsigned</span>* cipher, <span class="keyword">unsigned</span>* key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum&#123; <span class="number">0x458BCD42</span> * <span class="number">64</span> &#125;;</span><br><span class="line">	<span class="keyword">unsigned</span> lowWord = *cipher;</span><br><span class="line">	<span class="keyword">unsigned</span> highWord = cipher[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		highWord -= (lowWord + sum + <span class="number">20</span>) ^ ((lowWord &lt;&lt; <span class="number">6</span>) + key[<span class="number">2</span>]) ^ ((lowWord &gt;&gt; <span class="number">9</span>) + key[<span class="number">3</span>]) ^ <span class="number">0x10</span>;</span><br><span class="line">		lowWord -= (highWord + sum + <span class="number">11</span>) ^ ((highWord &lt;&lt; <span class="number">6</span>) + *key) ^ ((highWord &gt;&gt; <span class="number">9</span>) + key[<span class="number">1</span>]) ^ <span class="number">0x20</span>;</span><br><span class="line">		sum -= <span class="number">0x458BCD42</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	*cipher = lowWord;</span><br><span class="line">	cipher[<span class="number">1</span>] = highWord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Check 函数解一个三元一次方程组（注意溢出与截断）：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GWCTF2019xxor/2.png" alt="GWCTF2019xxor"></p>
<p>有：</p>
<ul>
<li>target[2] = 3774025685</li>
<li>target[3] = 1548802262</li>
<li>target[4] = 2652626477</li>
</ul>
<p>脚本（C++ 32位）：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> target[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">	target[<span class="number">2</span>] = <span class="number">3774025685</span>;</span><br><span class="line">	target[<span class="number">3</span>] = <span class="number">1548802262</span>;</span><br><span class="line">	target[<span class="number">4</span>] = <span class="number">2652626477</span>;</span><br><span class="line"></span><br><span class="line">	target[<span class="number">0</span>] = <span class="number">0xDF48EF7E</span>;</span><br><span class="line">	target[<span class="number">5</span>] = <span class="number">0x84F30420</span>;</span><br><span class="line">	target[<span class="number">1</span>] = <span class="number">0x20CAACF4</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> key[]&#123; <span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> &#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">		<span class="built_in">TeaDecode</span>(target + i, key);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">unsigned</span> i : target) &#123;</span><br><span class="line">		std::cout &lt;&lt; std::hex &lt;&lt; i;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出为 666c61677b72655f69735f6772656174217d，python2 中 decode(“hex”) 一下得到 flag</p>
<br>

<h3 id="HDCTF2019-Maze-x86-exe-upx-maze"><a href="#HDCTF2019-Maze-x86-exe-upx-maze" class="headerlink" title="[HDCTF2019]Maze | x86,exe,upx,maze"></a>[HDCTF2019]Maze | x86,exe,upx,maze</h3><p>upx 解压缩后，main 函数由于存在花指令，导致 ida 无法解析：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/1.png" alt="HDCTF2019Maze"></p>
<p>Undefine 以后将 0xE8 nop 掉</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/2.png" alt="HDCTF2019Maze"></p>
<p>在 0x90 处按 ‘c’ 将数据强转成代码，之后在 main 函数开始处按 ‘p’ 形成函数，就可以 F5 了：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/3.png" alt="HDCTF2019Maze"></p>
<p>反编译：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/4.png" alt="HDCTF2019Maze"></p>
<p>由于没有对迷宫的点是否可以通行进行判断，所以存在很多种路径都输出答案正确的情况</p>
<p>shift + F12 可以找到长度为 70 的迷宫：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/5.png" alt="HDCTF2019Maze"></p>
<p>当顶边 * 侧边为 10 * 7 时，满足终点在 (5，-4) 的要求，还原二维迷宫：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/HDCTF2019Maze/6.png" alt="HDCTF2019Maze"></p>
<p>所以正确的路径为 ssaaasaassdddw</p>
<br>

<h3 id="BJDCTF2020-BJD-hamburger-competition-x86-exe-NET-Unity游戏"><a href="#BJDCTF2020-BJD-hamburger-competition-x86-exe-NET-Unity游戏" class="headerlink" title="[BJDCTF2020]BJD hamburger competition | x86,exe,.NET,Unity游戏"></a>[BJDCTF2020]BJD hamburger competition | x86,exe,.NET,Unity游戏</h3><p>作者脑洞可以嗷。玩过 Unity 游戏开发的应该清楚，生成游戏时，开发者写的所有 C# 类会被整合编译到 <strong>Assembly-CSharp.dll</strong> 里，该动态链接库所在的路径是 xxx_Data\Managed，其中 xxx 为游戏名。</p>
<p>这题的 dll 就在 BJD hamburger competition_Data\Managed 目录下，Reflector 打开该 dll，在 ButtonSpawnFruit 类中找到 Spawn 方法：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020BJDhamburgercompetition/1.png" alt="BJDCTF2020BJDhamburgercompetition"></p>
<p>网站上查下这个 sha1，得到 1001，先看看他写的 Md5：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/BJDCTF2020BJDhamburgercompetition/2.png" alt="BJDCTF2020BJDhamburgercompetition"></p>
<p>那就取 1001 的 md5 大写前 20 个字符作为 flag</p>
<br>

<h3 id="WUSTCTF2020-level1-x86-elf"><a href="#WUSTCTF2020-level1-x86-elf" class="headerlink" title="[WUSTCTF2020]level1 | x86,elf"></a>[WUSTCTF2020]level1 | x86,elf</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read().split(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">data = <span class="built_in">map</span>(<span class="built_in">int</span>, data)</span><br><span class="line">data = [<span class="number">0</span>] + data</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">20</span>):</span><br><span class="line">	<span class="keyword">if</span> i &amp; <span class="number">1</span>:</span><br><span class="line">		flag += <span class="built_in">chr</span>(data[i] &gt;&gt; i)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		flag += <span class="built_in">chr</span>(data[i] / i)</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="WUSTCTF2020-level2-x86-elf-upx"><a href="#WUSTCTF2020-level2-x86-elf-upx" class="headerlink" title="[WUSTCTF2020]level2 | x86,elf,upx"></a>[WUSTCTF2020]level2 | x86,elf,upx</h3><p>upx 解压缩后，main 函数的汇编中可以看到 flag</p>
<br>

<h3 id="crackMe-x86-exe-反调试"><a href="#crackMe-x86-exe-反调试" class="headerlink" title="crackMe | x86,exe,反调试"></a>crackMe | x86,exe,反调试</h3><p>整理一下 main 函数的逻辑，根据各变量、函数行为给他们加符号：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/1.png" alt="crackMe"></p>
<p>CheckValid 函数基本没啥用，用来检测输入长度和输入字符的合法性，PreparePrint 函数准备输出，Congratulation 存放在 v7，失败的字符串存放在 v5。PrepareTable 函数通过输入的 user 来变换加密表，该函数可以通过 python 模拟：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PrepareTable</span>(<span class="params">user</span>):</span></span><br><span class="line">	user  = <span class="built_in">map</span>(<span class="built_in">ord</span>, user)</span><br><span class="line">	table = <span class="built_in">range</span>(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">	v5, v9, v6 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> v5 &lt; <span class="number">256</span>:</span><br><span class="line">		v3 = table[v5]</span><br><span class="line">		v9 = (v9 + v3 + user[v6 % <span class="built_in">len</span>(user)]) &amp; <span class="number">0xFF</span></span><br><span class="line">		v4 = table[v9]</span><br><span class="line">		table[v9] = v3</span><br><span class="line">		table[v5] = v4</span><br><span class="line">		v5 += <span class="number">1</span></span><br><span class="line">		v6 += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line">userName = <span class="string">&quot;welcomebeijing&quot;</span></span><br><span class="line">table = PrepareTable(userName)</span><br></pre></td></tr></table></figure>

<p>CheckPassword 函数里面有三处反调试，检测到有调试痕迹时，会进入误导的分支：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/2.png" alt="crackMe"></p>
<p>把它们 patch 掉以后，先来看上面的 while 循环：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/3.png" alt="crackMe"></p>
<p>好麻烦，不想静态分析了，上 OD 吧，密码一栏输 1234abcdABCD，等 while 跳出看看 v15 里的值：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/4.png" alt="crackMe"></p>
<p>可以看到 12 个字符变成了 6 个字节，每两个字符凑成一个字节。下一个 while 循环：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/5.png" alt="crackMe"></p>
<p>其中 sub_401710 函数经过动态调试后发现不会对 target 数组或者 user 产生任何影响，该循环干的事就是给长度为 8 的 target 数组赋值，每次赋值一字节，根据上一个 while 循环可以推出输入的密码长度为 16。</p>
<p>最后的 sub_401470 函数用来检查 target 数组是否满足要求：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/6.png" alt="crackMe"></p>
<p>该函数对 target 数组进行逐字节检查：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/crackMe/7.png" alt="crackMe"></p>
<p>需要注意，在检查 target[5] 时存在反调试的混淆信息。由此函数可得 target = [100, 98, 97, 112, 112, 115, 101, 99]，再逆一下第二个 while 循环即可得到 password，完整脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PrepareTable</span>(<span class="params">user</span>):</span></span><br><span class="line">	user  = <span class="built_in">map</span>(<span class="built_in">ord</span>, user)</span><br><span class="line">	table = <span class="built_in">range</span>(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">	v5, v9, v6 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> v5 &lt; <span class="number">256</span>:</span><br><span class="line">		v3 = table[v5]</span><br><span class="line">		v9 = (v9 + v3 + user[v6 % <span class="built_in">len</span>(user)]) &amp; <span class="number">0xFF</span></span><br><span class="line">		v4 = table[v9]</span><br><span class="line">		table[v9] = v3</span><br><span class="line">		table[v5] = v4</span><br><span class="line">		v5 += <span class="number">1</span></span><br><span class="line">		v6 += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line">userName = <span class="string">&quot;welcomebeijing&quot;</span></span><br><span class="line">table = PrepareTable(userName)</span><br><span class="line"></span><br><span class="line">target = [<span class="number">100</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">112</span>, <span class="number">112</span>, <span class="number">115</span>, <span class="number">101</span>, <span class="number">99</span>]</span><br><span class="line"></span><br><span class="line">password = <span class="string">&#x27;&#x27;</span></span><br><span class="line">v12, v13, v3, v4 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">	v13 += <span class="number">1</span></span><br><span class="line">	v12 = (v12 + table[v13]) &amp; <span class="number">0xFF</span></span><br><span class="line">	v3 = table[v13]</span><br><span class="line">	v4 = table[v12]</span><br><span class="line">	table[v12] = v3</span><br><span class="line">	table[v13] = v4</span><br><span class="line">	password += <span class="string">&quot;%02x&quot;</span> % (target[i] ^ table[(v3 + v4) &amp; <span class="number">0xFF</span>])</span><br><span class="line"><span class="built_in">print</span> password</span><br></pre></td></tr></table></figure>

<br>

<h3 id="FlareOn4-IgniteMe-x86-exe"><a href="#FlareOn4-IgniteMe-x86-exe" class="headerlink" title="[FlareOn4]IgniteMe | x86,exe"></a>[FlareOn4]IgniteMe | x86,exe</h3><p>莫得 main 函数，所有事情都在 start 函数做完，根据函数行为补一下符号：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/FlareOn4IgniteMe/1.png" alt="FlareOn4IgniteMe"></p>
<p>GetInput 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/FlareOn4IgniteMe/2.png" alt="FlareOn4IgniteMe"></p>
<p>CheckInput：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/FlareOn4IgniteMe/3.png" alt="FlareOn4IgniteMe"></p>
<p>sub_401000 函数返回一个 key 用于下面异或，该值可以静态分析，也可以动态调试，exe 没有开重定位。逻辑都很简单，直接上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;0D 26 49 45 2A 17 78 44 2B 6C 5D 5E 45 12 2F 17 2B 44 6F 6E 56 09 5F 45 47 73 26 0A 0D 13 17 48 42 01 40 4D 0C 02 69&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">target = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> target]</span><br><span class="line"></span><br><span class="line">flag = [<span class="number">0</span>] * <span class="number">0x27</span></span><br><span class="line">key = <span class="number">0x700004</span> &amp; <span class="number">0xFF</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">	flag[i] = target[i] ^ key</span><br><span class="line">	key = flag[i]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, flag))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="MRCTF2020-Xor-x86-exe"><a href="#MRCTF2020-Xor-x86-exe" class="headerlink" title="[MRCTF2020]Xor | x86,exe"></a>[MRCTF2020]Xor | x86,exe</h3><p>shift + F12，查找字符串 “Give Me Your Flag String” 的交叉引用，找到 sub_401090，其实这就是 main 函数。F5 发现报错 —— call analysis failed，这个错一般是 ida 无法正确识别 <strong>函数参数个数</strong> 或 <strong>函数调用约定</strong> 导致的。尤其是调用如 printf、scanf 这些参数个数可变的函数函数时，ida 会出现这样的错误。</p>
<p>出现这种情况需要看 <strong>output window</strong>，通过 log 信息知道是哪句调用分析失败了：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/MRCTF2020Xor/1.png" alt="MRCTF2020Xor"></p>
<p>这里是地址 0x401095 处的调用分析失败了，此地址处调用了 sub_401020：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/MRCTF2020Xor/2.png" alt="MRCTF2020Xor"></p>
<p>双击跟过去 F5 一下，让 ida 睁大眼睛好好看看这个函数，再回到 sub_401090，此时就可以 F5 了。其他题目如果做到这步还不能 F5，就需要人工干预，将光标放在函数头的位置按 ‘Y’ 强行修改参数个数或参数类型</p>
<p>F5 后事情就变得简单了，直接贴脚本了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;4D 53 41 57 42 7E 46 58 5A 3A 4A 3A 60 74 51 4A 22 4E 40 20 62 70 64 64 7D 38 67&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">target = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> target]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target)):</span><br><span class="line">	flag += <span class="built_in">chr</span>(i ^ target[i])</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="GKCTF2020-BabyDriver-x86-sys-maze"><a href="#GKCTF2020-BabyDriver-x86-sys-maze" class="headerlink" title="[GKCTF2020]BabyDriver | x86,sys,maze"></a>[GKCTF2020]BabyDriver | x86,sys,maze</h3><p>拿到手是个驱动，想运行起来的话需要改注册表并把文件放到系统文件夹，然后重启……还好静态分析起来不难</p>
<p>shift + F12 查找字符串 “success! flag is flag{md5(input)}” 的交叉引用，找到函数 sub_140001380。经过分析补上一些符号：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001380</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> currentPos; <span class="comment">// ecx</span></span><br><span class="line">  __int16 *v6; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v7; <span class="comment">// rbp</span></span><br><span class="line">  __int16 v8; <span class="comment">// dx</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// dl</span></span><br><span class="line">  CHAR *v10; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  v2 = a2;</span><br><span class="line">  <span class="keyword">if</span> ( *(a2 + <span class="number">48</span>) &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = *(a2 + <span class="number">24</span>);</span><br><span class="line">    v4 = *(a2 + <span class="number">56</span>) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      currentPos = Position;</span><br><span class="line">      v6 = (v3 + <span class="number">2</span>);</span><br><span class="line">      v7 = v4;</span><br><span class="line">      <span class="keyword">while</span> ( *(v3 + <span class="number">4</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_28:</span><br><span class="line">        v6 += <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !--v7 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_29;</span><br><span class="line">      &#125;</span><br><span class="line">      maze[currentPos] = <span class="string">&#x27;.&#x27;</span>;                   <span class="comment">// 道路</span></span><br><span class="line">      v8 = *v6;</span><br><span class="line">      <span class="keyword">if</span> ( *v6 == <span class="number">23</span> )                          <span class="comment">// up</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( currentPos &amp; <span class="number">0xFFFFFFF0</span> )          <span class="comment">// 到达上边界</span></span><br><span class="line">        &#123;</span><br><span class="line">          currentPos -= <span class="number">16</span>;                  	<span class="comment">// 由此可知一行 16 个字符</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">        &#125;</span><br><span class="line">        currentPos += <span class="number">208</span>;</span><br><span class="line">        Position = currentPos;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">37</span> )                           <span class="comment">// down</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (currentPos &amp; <span class="number">0xFFFFFFF0</span>) != <span class="number">208</span> ) <span class="comment">// 到达下边界</span></span><br><span class="line">        &#123;</span><br><span class="line">          currentPos += <span class="number">16</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">        &#125;</span><br><span class="line">        currentPos -= <span class="number">208</span>;</span><br><span class="line">        Position = currentPos;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">36</span> )                           <span class="comment">// left</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( currentPos &amp; <span class="number">0xF</span> )                 <span class="comment">// 到达左边界</span></span><br><span class="line">        &#123;</span><br><span class="line">          --currentPos;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">        &#125;</span><br><span class="line">        currentPos += <span class="number">15</span>;</span><br><span class="line">        Position = currentPos;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 != <span class="number">38</span> )                           <span class="comment">// right</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">      <span class="keyword">if</span> ( (currentPos &amp; <span class="number">0xF</span>) == <span class="number">15</span> )           <span class="comment">// 到达右边界</span></span><br><span class="line">        currentPos -= <span class="number">15</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        ++currentPos;</span><br><span class="line">LABEL_21:</span><br><span class="line">      Position = currentPos;</span><br><span class="line">LABEL_22:</span><br><span class="line">      v9 = maze[currentPos];</span><br><span class="line">      <span class="keyword">if</span> ( v9 == <span class="string">&#x27;*&#x27;</span> )                          <span class="comment">// 墙壁</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = <span class="string">&quot;failed!\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v9 != <span class="string">&#x27;#&#x27;</span> )                        <span class="comment">// 终点</span></span><br><span class="line">        &#123;</span><br><span class="line">LABEL_27:</span><br><span class="line">          maze[currentPos] = <span class="string">&#x27;o&#x27;</span>;               <span class="comment">// 起点</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_28;</span><br><span class="line">        &#125;</span><br><span class="line">        v10 = <span class="string">&quot;success! flag is flag&#123;md5(v3)&#125;\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Position = <span class="number">16</span>;</span><br><span class="line">      DbgPrint(v10);</span><br><span class="line">      currentPos = Position;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_29:</span><br><span class="line">  <span class="keyword">if</span> ( *(v2 + <span class="number">65</span>) )</span><br><span class="line">    *(*(v2 + <span class="number">184</span>) + <span class="number">3</span>i64) |= <span class="number">1u</span>;</span><br><span class="line">  <span class="keyword">return</span> *(v2 + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现的功能是监听键盘按键，从而控制目标在迷宫中的移动，maze 拿出来处理一下：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GKCTF2020BabyDriver/1.png" alt="GKCTF2020BabyDriver"></p>
<p>需要注意的是，驱动判断按键用的是键盘扫描码，可以在 <a target="_blank" rel="noopener" href="https://www.supfree.net/search.asp?id=6386">网站</a> 查询，37 和 38 分别对应 K 和 L，将之前的路径替换一下，再 md5：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;RDDDRRDRDDDRRRDDDRRRRRR&quot;</span></span><br><span class="line">path = path.replace(<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">path = path.replace(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;K&#x27;</span>)</span><br><span class="line">md5 = hashlib.md5(path)</span><br><span class="line"><span class="built_in">print</span> md5.hexdigest()</span><br></pre></td></tr></table></figure>

<br>

<h3 id="firmware-固件分析-upx"><a href="#firmware-固件分析-upx" class="headerlink" title="firmware | 固件分析,upx"></a>firmware | 固件分析,upx</h3><p>拿到一个路由器固件，<code>binwalk -e</code> 分离得到一个压缩的文件系统 <strong>120200.squashfs</strong> ：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/firmware/1.png" alt="firmware"></p>
<p>需要用到 <a target="_blank" rel="noopener" href="https://github.com/mirror/firmware-mod-kit.git">firmware-mod-kit</a> 解压，安装方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git build-essential zlib1g-dev liblzma-dev python-magic</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/mirror/firmware-mod-kit.git</span><br><span class="line"><span class="built_in">cd</span> firmware-mod-kit/src</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure>

<p>使用指令 <code>./unsquashfs_all.sh 120200.squashfs</code> 解压文件系统，得到文件夹 <strong>squashfs-root</strong>，翻一下里面的文件，在 tmp 目录下发现可执行文件 backdoor，且被 upx 压缩了。upx 解压后 ida 打开，找到 initConnection 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/firmware/2.png" alt="firmware"></p>
<p>commServer 是 echo.byethost51.com，端口为 36667</p>
<br>

<h3 id="MRCTF2020-hello-world-go-x86-elf-go语言"><a href="#MRCTF2020-hello-world-go-x86-elf-go语言" class="headerlink" title="[MRCTF2020]hello_world_go | x86,elf,go语言"></a>[MRCTF2020]hello_world_go | x86,elf,go语言</h3><p>main.main 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/MRCTF2020hello_world_go/1.png" alt="MRCTF2020hello_world_go"></p>
<p>unk_4D3C58 即为 flag</p>
<br>

<h3 id="FlareOn6-Overlong-x86-exe-patch"><a href="#FlareOn6-Overlong-x86-exe-patch" class="headerlink" title="[FlareOn6]Overlong | x86,exe,patch"></a>[FlareOn6]Overlong | x86,exe,patch</h3><p>start 函数里弹了一个对话框，对话框的内容由 PrepareText 函数处理：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/FlareOn6Overlong/1.png" alt="FlareOn6Overlong"></p>
<p>将第三个参数 patch 成 127 再运行就能得到 flag（或者动态调试把传参修改一下）</p>
<br>

<h3 id="WUSTCTF2020-level3-x86-elf-elf运行流程"><a href="#WUSTCTF2020-level3-x86-elf-elf运行流程" class="headerlink" title="[WUSTCTF2020]level3 | x86,elf,elf运行流程"></a>[WUSTCTF2020]level3 | x86,elf,elf运行流程</h3><p>main 函数逻辑清晰，要求对 d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD== 进行 base64 解密。但是在 main 函数执行前，base 编码表被函数 O_OLookAtYou 做了手脚，该函数在 _init_array 数组中，会在 main 函数之前被执行：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/WUSTCTF2020level3/1.png" alt="WUSTCTF2020level3"></p>
<p>elf 运行流程详见本文 <strong>[2019红帽杯]easyRE</strong> writeup</p>
<p>动态调试将新的编码表拿出来：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/WUSTCTF2020level3/2.png" alt="WUSTCTF2020level3"></p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">old_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">new_table = <span class="string">&quot;TSRQPONMLKJIHGFEDCBAUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line"></span><br><span class="line">general = <span class="string">&#x27;&#x27;</span></span><br><span class="line">target = <span class="string">&quot;d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> target :</span><br><span class="line">	general += old_table[new_table.find(i)]</span><br><span class="line"><span class="built_in">print</span> base64.b64decode(general)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="WUSTCTF2020-Cr0ssfun-x86-elf"><a href="#WUSTCTF2020-Cr0ssfun-x86-elf" class="headerlink" title="[WUSTCTF2020]Cr0ssfun | x86,elf"></a>[WUSTCTF2020]Cr0ssfun | x86,elf</h3><p>check 函数对 flag 的每个字符进行判断，提出来拼在一起就可以了，使用 sublime 的正则替换功能会高效很多</p>
<br>

<h3 id="GXYCTF2019-simple-CPP-x86-exe-反调试"><a href="#GXYCTF2019-simple-CPP-x86-exe-反调试" class="headerlink" title="[GXYCTF2019]simple CPP | x86,exe,反调试"></a>[GXYCTF2019]simple CPP | x86,exe,反调试</h3><p>晚点再写~</p>
<br>

<h3 id="2019红帽杯-xx-x86-exe-xxtea"><a href="#2019红帽杯-xx-x86-exe-xxtea" class="headerlink" title="[2019红帽杯]xx | x86,exe,xxtea"></a>[2019红帽杯]xx | x86,exe,xxtea</h3><p>PS. 本题所有脚本语言环境为 C/C++</p>
<p>sub_1400011A0 是 main 函数（通过字符串交叉引用找到），干了几件事：</p>
<ul>
<li>输入 19 个字符</li>
<li>前 4 个字符作为 key</li>
<li>调用 sub_140001AB0 函数（xxtea_encode）加密输入，密钥为 key，加密结果记为 r1</li>
<li>轮换加密 r1，加密结果记为 r2</li>
<li>for 循环从 r2 第三个字符开始逐字节异或加密 r2，加密结果记为 r3</li>
<li>r3 应该与一个长度为 24 字节的数组逐字节相等，输出 You win</li>
</ul>
<p>r2 加密到 r3 的逻辑用 C 可以写作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encode3</span><span class="params">(<span class="keyword">char</span>* input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">24</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (i / <span class="number">3</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">char</span> tmp = input[i];</span><br><span class="line">			<span class="keyword">do</span></span><br><span class="line">			&#123;</span><br><span class="line">				tmp ^= input[idx++];</span><br><span class="line">			&#125; <span class="keyword">while</span> (idx &lt; i / <span class="number">3</span>);</span><br><span class="line">			input[i] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>故r3 还原 r2：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decode3</span><span class="params">(<span class="keyword">char</span>* input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">23</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">int</span> idx = i / <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (i / <span class="number">3</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">char</span> tmp = input[i];</span><br><span class="line">			<span class="keyword">do</span></span><br><span class="line">			&#123;</span><br><span class="line">				tmp ^= input[idx--];</span><br><span class="line">			&#125; <span class="keyword">while</span> (idx &gt;= <span class="number">0</span>);</span><br><span class="line">			input[i] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>r1 到 r2 的轮换加密 F5 反编译得很清楚，下面是 r2 还原 r1：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decode2</span><span class="params">(<span class="keyword">char</span>* cipher, <span class="keyword">char</span>* plain)</span> </span>&#123;</span><br><span class="line">	plain[<span class="number">2</span>] = cipher[<span class="number">0</span>];</span><br><span class="line">	plain[<span class="number">0</span>] = cipher[<span class="number">1</span>];</span><br><span class="line">	plain[<span class="number">3</span>] = cipher[<span class="number">2</span>];</span><br><span class="line">	plain[<span class="number">1</span>] = cipher[<span class="number">3</span>];</span><br><span class="line">	plain[<span class="number">6</span>] = cipher[<span class="number">4</span>];</span><br><span class="line">	plain[<span class="number">4</span>] = cipher[<span class="number">5</span>];</span><br><span class="line">	plain[<span class="number">7</span>] = cipher[<span class="number">6</span>];</span><br><span class="line">	plain[<span class="number">5</span>] = cipher[<span class="number">7</span>];</span><br><span class="line">	plain[<span class="number">10</span>] = cipher[<span class="number">8</span>];</span><br><span class="line">	plain[<span class="number">8</span>] = cipher[<span class="number">9</span>];</span><br><span class="line">	plain[<span class="number">11</span>] = cipher[<span class="number">10</span>];</span><br><span class="line">	plain[<span class="number">9</span>] = cipher[<span class="number">11</span>];</span><br><span class="line">	plain[<span class="number">14</span>] = cipher[<span class="number">12</span>];</span><br><span class="line">	plain[<span class="number">12</span>] = cipher[<span class="number">13</span>];</span><br><span class="line">	plain[<span class="number">15</span>] = cipher[<span class="number">14</span>];</span><br><span class="line">	plain[<span class="number">13</span>] = cipher[<span class="number">15</span>];</span><br><span class="line">	plain[<span class="number">18</span>] = cipher[<span class="number">16</span>];</span><br><span class="line">	plain[<span class="number">16</span>] = cipher[<span class="number">17</span>];</span><br><span class="line">	plain[<span class="number">19</span>] = cipher[<span class="number">18</span>];</span><br><span class="line">	plain[<span class="number">17</span>] = cipher[<span class="number">19</span>];</span><br><span class="line">	plain[<span class="number">22</span>] = cipher[<span class="number">20</span>];</span><br><span class="line">	plain[<span class="number">20</span>] = cipher[<span class="number">21</span>];</span><br><span class="line">	plain[<span class="number">23</span>] = cipher[<span class="number">22</span>];</span><br><span class="line">	plain[<span class="number">21</span>] = cipher[<span class="number">23</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>r1 到明文输入的解密需要 xxtea_decode，这里我使用了别人写好的项目 <a target="_blank" rel="noopener" href="https://github.com/xxtea/xxtea-c">github xxtea</a>，VS 里导入就能用了。key 因为取的是开头 4 个字符，所以直接猜 “flag”，下面是解密脚本的 main 函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;xxtea.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// r3 -&gt; r2</span></span><br><span class="line">	<span class="keyword">char</span> r3[]&#123; <span class="number">0xCE</span>, <span class="number">0xBC</span>, <span class="number">0x40</span>, <span class="number">0x6B</span>, <span class="number">0x7C</span>, <span class="number">0x3A</span>, <span class="number">0x95</span>, <span class="number">0xC0</span>, <span class="number">0xEF</span>, <span class="number">0x9B</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x91</span>, <span class="number">0xF7</span>, <span class="number">0x02</span>, <span class="number">0x35</span>, <span class="number">0x23</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, <span class="number">0xC8</span>, <span class="number">0xE7</span>, <span class="number">0x56</span>, <span class="number">0x56</span>, <span class="number">0xFA</span> &#125;;</span><br><span class="line">	Decode3(r3);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// r2 -&gt; r1</span></span><br><span class="line">	<span class="keyword">char</span> r1[<span class="number">24</span>];</span><br><span class="line">	Decode2(r3, r1);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// r1 -&gt; 明文</span></span><br><span class="line">	<span class="keyword">size_t</span> len = <span class="number">24</span>;</span><br><span class="line">	<span class="keyword">char</span> key[] = &#123; <span class="string">&quot;flag&quot;</span> &#125;;</span><br><span class="line">	<span class="keyword">char</span>* plain = (<span class="keyword">char</span> *)xxtea_decrypt(r1, len, key, &amp;len);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; plain &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ACTF新生赛2020-Oruga-x86-elf-maze"><a href="#ACTF新生赛2020-Oruga-x86-elf-maze" class="headerlink" title="[ACTF新生赛2020]Oruga | x86,elf,maze"></a>[ACTF新生赛2020]Oruga | x86,elf,maze</h3><p>main 函数前面在检查输入前 5 个字符是不是 “actf{“，然后调用 sub_78A 来检查 flag 内容。该函数可以理解成一个类似滑动冰壶的游戏，冰壶在冰面上滑动，不碰到墙壁就停不下来：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020Oruga/1.png" alt="ACTF新生赛2020Oruga"></p>
<p>如果不是很理解，可以玩下这个 <a target="_blank" rel="noopener" href="http://www.4399.com/flash/213575_1.htm">4399 滑动海绵漆</a></p>
<p>map 中的 0 表示冰面，感叹号表示终点，其他字符表示墙壁。把 map 拿出来处理一下，0 替换成 * 方便观察：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">maze = <span class="string">&quot;00 00 00 00 23 00 00 00 00 00 00 00 23 23 23 23 00 00 00 23 23 00 00 00 4F 4F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 4F 4F 00 50 50 00 00 00 00 00 00 4C 00 4F 4F 00 4F 4F 00 50 50 00 00 00 00 00 00 4C 00 4F 4F 00 4F 4F 00 50 00 00 00 00 00 00 4C 4C 00 4F 4F 00 00 00 00 50 00 00 00 00 00 00 00 00 00 4F 4F 00 00 00 00 50 00 00 00 00 23 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 23 00 00 00 00 00 00 00 00 00 4D 4D 4D 00 00 00 23 00 00 00 00 00 00 00 00 00 00 4D 4D 4D 00 00 00 00 45 45 00 00 00 30 00 4D 00 4D 00 4D 00 00 00 00 45 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 45 45 54 54 54 49 00 4D 00 4D 00 4D 00 00 00 00 45 00 00 54 00 49 00 4D 00 4D 00 4D 00 00 00 00 45 00 00 54 00 49 00 4D 00 4D 00 4D 21 00 00 00 45 45&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">maze = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> maze]</span><br><span class="line">maze = [i <span class="keyword">if</span> i !=<span class="number">0</span> <span class="keyword">else</span> <span class="built_in">ord</span>(<span class="string">&#x27;*&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> maze]</span><br><span class="line">maze = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, maze))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(maze), <span class="number">16</span>):</span><br><span class="line">	<span class="built_in">print</span> maze[i:i+<span class="number">16</span>]</span><br></pre></td></tr></table></figure>

<p>找到路径（假设 上 - U，下 - D，左 - L，右 - R）：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020Oruga/2.png" alt="MRCTF2020hello_world_go"></p>
<p>替换成题目中用到的控制方向的四个字符：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&quot;DRURDRULDRULD&quot;</span></span><br><span class="line">path = path.replace(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">path = path.replace(<span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">path = path.replace(<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">path = path.replace(<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;E&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> path</span><br></pre></td></tr></table></figure>

<br>

<h3 id="GWCTF-2019-re3-x86-elf-SMC-md5-AES-ECB"><a href="#GWCTF-2019-re3-x86-elf-SMC-md5-AES-ECB" class="headerlink" title="[GWCTF 2019]re3 | x86,elf,SMC,md5,AES_ECB"></a>[GWCTF 2019]re3 | x86,elf,SMC,md5,AES_ECB</h3><p>main 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GWCTF2019re3/1.png" alt="GWCTF2019re3"></p>
<p>for 循环表示只有在运行的时候才会解密 sub_402219 函数（该函数逐字节异或 0x99），写个 python 的 idc 脚本直接还原该函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line">funcAddr = <span class="number">0x402219</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">224</span>):</span><br><span class="line">	enc = get_bytes(funcAddr + i, <span class="number">1</span>)</span><br><span class="line">	dec = <span class="built_in">ord</span>(enc) ^ <span class="number">0x99</span></span><br><span class="line">	patch_byte(funcAddr + i, dec)</span><br></pre></td></tr></table></figure>

<p>在 ida 中选择 File -&gt; Script File…，选择该脚本即可运行。来到地址 0x402219 处，光标放在 sub_402219 标签上，按 U 取消函数定义，再按 C 数据转汇编代码，最后按 P 创建函数，F5 反编译：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GWCTF2019re3/2.png" alt="GWCTF2019re3"></p>
<p>至于为什么知道那个函数是 AES 加密，ida 有个插件叫 findcrypto 谁用谁知道，安装方式请自行百度。常用加密模式一般就 CBC/ECB，CBC 模式需要 iv，这里就俩参数，一个 key， 一个待加密明文，所以加密模式就是 ECB 咯。key 由 sub_40207B 函数准备，可以直接 gdb 动调从内存中拿出来。下面是解密脚本（python3）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> a2b_hex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">text</span>):</span></span><br><span class="line">	key = <span class="string">&quot;cb 8d 49 35 21 b4 7a 4c c1 ae 7e 62 22 92 66 ce&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	key = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">	key = <span class="built_in">bytes</span>(key)</span><br><span class="line"></span><br><span class="line">	mode = AES.MODE_ECB</span><br><span class="line">	cryptor = AES.new(key, mode)</span><br><span class="line">	plain_text = cryptor.decrypt(a2b_hex(text))</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bytes</span>.decode(plain_text).rstrip(<span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">raw = <span class="string">&quot;BC 0A AD C0 14 7C 5E CC E0 B1 40 BC 9C 51 D5 2B 46 B2 B9 43 4D E5 32 4B AD 7F B4 B3 9C DB 4B 5B&quot;</span></span><br><span class="line">target = raw.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">piece1 = target[:<span class="number">32</span>]</span><br><span class="line">piece2 = target[<span class="number">32</span>:]</span><br><span class="line"><span class="built_in">print</span>(decrypt(piece1) + decrypt(piece2))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="网鼎杯-2020-青龙组-singal-x86-exe-vm虚拟机-angr"><a href="#网鼎杯-2020-青龙组-singal-x86-exe-vm虚拟机-angr" class="headerlink" title="[网鼎杯 2020 青龙组]singal | x86,exe,vm虚拟机,angr"></a>[网鼎杯 2020 青龙组]singal | x86,exe,vm虚拟机,angr</h3><p>打开 vm_operad 函数，看样子出题人写了个超小型虚拟机：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84singal/1.png" alt="网鼎杯2020青龙组singal"></p>
<p>三种方法</p>
<p>第一种 —— code 也不多，手动跟踪每一次 switch，得到 flag 每一位的计算方式，再写脚本逆回去</p>
<p>第二种 —— 稍微分析一下得知 case 1 赋值 mem 数组，case 7 拿 mem 与 target 进行比较，把 vm_operad 从 ida 摘下来，用 VS 改亿小点，写个程序爆破 flag（或者逆着 code 回去，从 target 反推输入）。爆破的脚本我贴这儿了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vcruntime_string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable : 4996)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> code[<span class="number">0x1C8</span> / <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>)];</span><br><span class="line"><span class="keyword">char</span> target[<span class="number">15</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> mem[<span class="number">100</span>]; <span class="comment">// [esp-85h] [ebp-85h]</span></span><br><span class="line"><span class="keyword">char</span> reg; <span class="comment">// [esp-21h] [ebp-21h]</span></span><br><span class="line"><span class="keyword">int</span> dsp2; <span class="comment">// [esp-20h] [ebp-20h]</span></span><br><span class="line"><span class="keyword">int</span> tIdx; <span class="comment">// [esp-1Ch] [ebp-1Ch]</span></span><br><span class="line"><span class="keyword">int</span> idx; <span class="comment">// [esp-18h] [ebp-18h]</span></span><br><span class="line"><span class="keyword">int</span> dsp1; <span class="comment">// [esp-14h] [ebp-14h]</span></span><br><span class="line"><span class="keyword">int</span> ip; <span class="comment">// [esp-10h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> mem_bak[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">char</span> reg_bak;</span><br><span class="line"><span class="keyword">int</span> dsp2_bak;</span><br><span class="line"><span class="keyword">int</span> tIdx_bak;</span><br><span class="line"><span class="keyword">int</span> idx_bak;</span><br><span class="line"><span class="keyword">int</span> dsp1_bak;</span><br><span class="line"><span class="keyword">int</span> ip_bak;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化虚拟机环境</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">env_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化代码段</span></span><br><span class="line">    <span class="comment">// memdump 文件内容为 0x403040 开始的 0x1C8 个字节</span></span><br><span class="line">    FILE* fp = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\memdump&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Error memdump file path.&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fread</span>(code, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>), <span class="built_in"><span class="keyword">sizeof</span></span>(code) / <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>), fp);</span><br><span class="line">    <span class="built_in">fclose</span>(fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化内存及各寄存器</span></span><br><span class="line">    <span class="built_in">memset</span>(mem, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(mem));</span><br><span class="line">    reg = <span class="number">0</span>;</span><br><span class="line">    ip = <span class="number">0</span>;</span><br><span class="line">    dsp1 = <span class="number">0</span>;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    tIdx = <span class="number">0</span>;</span><br><span class="line">    dsp2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化target数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">        target[i] = (<span class="keyword">char</span>)code[<span class="number">0x154</span> / <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>) + <span class="number">2</span> * i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拍摄快照</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_vm_state</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(mem_bak, mem, <span class="built_in"><span class="keyword">sizeof</span></span>(mem));</span><br><span class="line">    reg_bak = reg;</span><br><span class="line">    dsp2_bak = dsp2;</span><br><span class="line">    tIdx_bak = tIdx;</span><br><span class="line">    idx_bak = idx;</span><br><span class="line">    dsp1_bak = dsp1;</span><br><span class="line">    ip_bak = ip;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 快照还原</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recover_vm_state</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(mem, mem_bak, <span class="built_in"><span class="keyword">sizeof</span></span>(mem));</span><br><span class="line">    reg = reg_bak;</span><br><span class="line">    dsp2 = dsp2_bak;</span><br><span class="line">    tIdx = tIdx_bak;</span><br><span class="line">    idx = idx_bak;</span><br><span class="line">    dsp1 = dsp1_bak;</span><br><span class="line">    ip = ip_bak;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 虚拟机运行函数</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">vm_operate</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">char</span>* input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span> (code[ip])</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> (cur == tIdx) &#123;</span><br><span class="line">                <span class="keyword">return</span> reg == target[cur];</span><br><span class="line">            &#125;</span><br><span class="line">            ++ip;</span><br><span class="line">            ++tIdx;</span><br><span class="line">            ++dsp1;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            reg = (<span class="keyword">char</span>)(code[ip + <span class="number">1</span>]) + input[dsp1];</span><br><span class="line">            ip += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            reg = input[dsp1] - (<span class="keyword">char</span>)(code[ip + <span class="number">1</span>]);</span><br><span class="line">            ip += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            reg = code[ip + <span class="number">1</span>] ^ input[dsp1];</span><br><span class="line">            ip += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            reg = code[ip + <span class="number">1</span>] * input[dsp1];</span><br><span class="line">            ip += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            ++ip;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="comment">// 原为比较加密结果与target</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            input[dsp2] = reg;</span><br><span class="line">            ++ip;</span><br><span class="line">            ++dsp2;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">            <span class="comment">// 原为接收长度为15的输入</span></span><br><span class="line">            ++ip;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">            reg = input[dsp1] - <span class="number">1</span>;</span><br><span class="line">            ++ip;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">            reg = input[dsp1] + <span class="number">1</span>;</span><br><span class="line">            ++ip;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">env_init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">16</span>]&#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 创建快照</span></span><br><span class="line">        <span class="built_in">save_vm_state</span>();</span><br><span class="line">        <span class="comment">// 所有可见字符</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">33</span>; j &lt; <span class="number">128</span>; j++) &#123;</span><br><span class="line">            flag[i] = j;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">vm_operate</span>(i, flag)) &#123;</span><br><span class="line">                <span class="comment">// flag[i]中途可能会被case 8修改，这里再赋值一次</span></span><br><span class="line">                flag[i] = j;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 本次猜测不正确，还原现场</span></span><br><span class="line">            <span class="built_in">recover_vm_state</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    flag[<span class="number">15</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出前两种方法非常不方便，都需要认真分析每个 opcode 对应干了什么事，边调边写，一血早没了。有没有无脑冲冲冲的方法呢？下面有请第三种方法 —— <strong>angr 符号执行</strong> 隆重登场</p>
<p>经过几个版本的更新，angr 的 API 现在用起来非常方便，不了解的可以阅读 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3990">系列文章</a>，这里直接贴脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">project = angr.Project(<span class="string">&quot;./signal.exe&quot;</span>, auto_load_libs = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@project.hook(<span class="params"><span class="number">0x40179E</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MyHook</span>(<span class="params">state</span>):</span></span><br><span class="line">	<span class="built_in">print</span>(state.posix.dumps(<span class="number">0</span>))</span><br><span class="line">	project.terminate_execution()</span><br><span class="line"></span><br><span class="line">project.execute()</span><br></pre></td></tr></table></figure>

<p>运行截图：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84singal/2.png" alt="网鼎杯2020青龙组singal"></p>
<p>什么叫秒解？</p>
<br>

<h3 id="GUET-CTF2019-number-game-x86-elf-二叉树-数独"><a href="#GUET-CTF2019-number-game-x86-elf-二叉树-数独" class="headerlink" title="[GUET-CTF2019]number_game | x86,elf,二叉树,数独"></a>[GUET-CTF2019]number_game | x86,elf,二叉树,数独</h3><p>根据函数行为还原 main 逻辑：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/1.png" alt="GUETCTF2019number_game"></p>
<p>结点的结构体经分析后有：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/2.png" alt="GUETCTF2019number_game"></p>
<p>Preorder_builder 函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/3.png" alt="GUETCTF2019number_game"></p>
<p>Inorder 中序遍历函数：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/4.png" alt="GUETCTF2019number_game"></p>
<p>CheckSudoku 函数检查是否满足数独游戏的要求：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/5.png" alt="GUETCTF2019number_game"></p>
<p>把数独拿出来看看：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/6.png" alt="GUETCTF2019number_game"></p>
<p>顺便手解了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(0, 2) = 0</span><br><span class="line">(1, 2) = 4</span><br><span class="line">(1, 4) = 2</span><br><span class="line">(2, 1) = 1</span><br><span class="line">(2, 4) = 4</span><br><span class="line">(3, 0) = 2</span><br><span class="line">(3, 2) = 1</span><br><span class="line">(3, 3) = 4</span><br><span class="line">(4, 2) = 3</span><br><span class="line">(4, 3) = 0</span><br></pre></td></tr></table></figure>

<p>FillSudoku 函数在填写数独的时候使用的就是中序遍历得到的数组下标序列：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/GUETCTF2019number_game/7.png" alt="GUETCTF2019number_game"></p>
<p>理解了原理可以照着写个前序、中序来获得填入数独时数组下标的映射序列。我偷懒直接把 CheckValid 函数 patch 掉，然后输个 ABCDEFGHIJ，动态调试看看被映射到哪里去了，得到被填写后的数独为 14H2330D1I0B23JE3AF042CG1，故有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(0, 2) = 0 -&gt; H</span><br><span class="line">(1, 2) = 4 -&gt; D</span><br><span class="line">(1, 4) = 2 -&gt; I</span><br><span class="line">(2, 1) = 1 -&gt; B</span><br><span class="line">(2, 4) = 4 -&gt; J</span><br><span class="line">(3, 0) = 2 -&gt; E</span><br><span class="line">(3, 2) = 1 -&gt; A</span><br><span class="line">(3, 3) = 4 -&gt; F</span><br><span class="line">(4, 2) = 3 -&gt; C</span><br><span class="line">(4, 3) = 0 -&gt; G</span><br></pre></td></tr></table></figure>

<p>按照 A-J 的顺序组织好输入就是 flag 了</p>
<br>

<h3 id="Zer0pts2020-easy-strcmp-x86-elf-elf运行流程"><a href="#Zer0pts2020-easy-strcmp-x86-elf-elf运行流程" class="headerlink" title="[Zer0pts2020]easy strcmp | x86,elf,elf运行流程"></a>[Zer0pts2020]easy strcmp | x86,elf,elf运行流程</h3><p>main 函数简单地通过 strcmp 来判断输入，那肯定没这么简单。直接找 init_array，发现可疑函数 sub_795：</p>
<p> <img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Zer0pts2020easystrcmp/1.png" alt="Zer0pts2020easystrcmp"></p>
<p>该函数将 strcmp 的 plt 表项替换为虚假的 strcmp，main 函数调用 strcmp 时控制流会来到 FakeStrcmp：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Zer0pts2020easystrcmp/2.png" alt="Zer0pts2020easystrcmp"></p>
<p>FakeStrcmp 首先对输入进行变换，再调用 RealStrcmp：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/Zer0pts2020easystrcmp/3.png" alt="Zer0pts2020easystrcmp"></p>
<p>脚本还原时需要注意小端序的问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="string">&quot;zer0pts&#123;********CENSORED********&#125;&quot;</span></span><br><span class="line">target = <span class="built_in">map</span>(<span class="built_in">ord</span>, target)</span><br><span class="line"></span><br><span class="line">nums = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(target), <span class="number">8</span>):</span><br><span class="line">	tmp = target[i:i+<span class="number">8</span>]</span><br><span class="line">	num = <span class="number">0</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">			num += tmp[j] &lt;&lt; j * <span class="number">8</span></span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	nums.append(num)</span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line">qword_201060 = [<span class="number">0</span>, <span class="number">0x410A4335494A0942</span>, <span class="number">0xB0EF2F50BE619F0</span>, <span class="number">0x4F0A3A064A35282B</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">	res.append(qword_201060[i] + nums[i])</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">	tmp = <span class="string">&quot;%016X&quot;</span> % res[i]</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>, -<span class="number">1</span>, -<span class="number">2</span>):</span><br><span class="line">		flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(tmp[j:j+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span> flag.strip(<span class="string">&#x27;\x00&#x27;</span>)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="FlareOn3-Challenge1-x86-exe-变种base64"><a href="#FlareOn3-Challenge1-x86-exe-变种base64" class="headerlink" title="[FlareOn3]Challenge1 | x86,exe,变种base64"></a>[FlareOn3]Challenge1 | x86,exe,变种base64</h3><p>main 函数逻辑清晰：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/FlareOn3Challenge1/1.png" alt="FlareOn3Challenge1"></p>
<p>不过 base64 编码表被替换，还原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">ori = <span class="string">&#x27;&#x27;</span></span><br><span class="line">target = <span class="string">&quot;x2dtJEOmyjacxDemx2eczT5cVS9fVUGvWTuZWjuexjRqy24rV29q&quot;</span></span><br><span class="line"></span><br><span class="line">oldTable = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">newTable = <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> target:</span><br><span class="line">	idx = newTable.find(i)</span><br><span class="line">	ori += oldTable[idx]</span><br><span class="line"><span class="built_in">print</span> base64.b64decode(ori)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="equation-javascript-JsFuck混淆"><a href="#equation-javascript-JsFuck混淆" class="headerlink" title="equation | javascript, JsFuck混淆"></a>equation | javascript, JsFuck混淆</h3><p>可以直接用 js 写正则替换，但最后还是要到 python 里来用 z3 求解器，所以干脆就全用 python 好了，python 里执行 js 代码需要用到 PyExecJS 库。所有等式反混淆脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExecFront</span>(<span class="params">string</span>):</span></span><br><span class="line">	num = execjs.<span class="built_in">eval</span>(string.group(<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;l[%s]&quot;</span> % num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExecBehind</span>(<span class="params">string</span>):</span></span><br><span class="line">	num = execjs.<span class="built_in">eval</span>(string.group(<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot; == %s&quot;</span> % num</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;equation.html&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read()</span><br><span class="line"><span class="comment"># 取出 html 文档中的所有等式</span></span><br><span class="line">equations = re.search(<span class="string">r&quot;if\((.+)\)&#123;&quot;</span>, data).group(<span class="number">1</span>).split(<span class="string">&quot;&amp;&amp;&quot;</span>)</span><br><span class="line"><span class="comment"># 每个等式分两部分匹配处理</span></span><br><span class="line"><span class="keyword">for</span> equation <span class="keyword">in</span> equations:</span><br><span class="line">	<span class="comment"># &#x27;==&#x27; 前面的部分</span></span><br><span class="line">	tmp = re.sub(<span class="string">r&quot;(?:l\[)([!\+\[\]]+)(?:\])&quot;</span>, ExecFront, equation)</span><br><span class="line">	<span class="comment"># &#x27;==&#x27; 后面的部分</span></span><br><span class="line">	<span class="built_in">print</span> re.sub(<span class="string">r&quot;(?:==)(.+)&quot;</span>, ExecBehind, tmp)</span><br></pre></td></tr></table></figure>

<p>还挺得劲儿：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/equation/1.png" alt="equation"></p>
<p>但是为了方便使用 z3，还需要小改亿些地方：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> z3</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExecFront</span>(<span class="params">string</span>):</span></span><br><span class="line">	num = execjs.<span class="built_in">eval</span>(string.group(<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;flag_char[%s]&quot;</span> % num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExecBehind</span>(<span class="params">string</span>):</span></span><br><span class="line">	num = execjs.<span class="built_in">eval</span>(string.group(<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot; == %s&quot;</span> % num</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;equation.html&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	data = f.read()</span><br><span class="line"></span><br><span class="line">flag_len = <span class="number">0x2a</span></span><br><span class="line">solver = z3.Solver()</span><br><span class="line">flag_char = [z3.Int(<span class="string">&quot;char%d&quot;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(flag_len)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加约束</span></span><br><span class="line">equations = re.search(<span class="string">r&quot;if\((.+)\)&#123;&quot;</span>, data).group(<span class="number">1</span>).split(<span class="string">&quot;&amp;&amp;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> equation <span class="keyword">in</span> equations:</span><br><span class="line">	tmp = re.sub(<span class="string">r&quot;(?:l\[)([!\+\[\]]+)(?:\])&quot;</span>, ExecFront, equation)</span><br><span class="line">	eq = re.sub(<span class="string">r&quot;(?:==)(.+)&quot;</span>, ExecBehind, tmp)</span><br><span class="line">	<span class="comment"># print eq</span></span><br><span class="line">	<span class="built_in">eval</span>( <span class="string">&quot;solver.add( &quot;</span> + eq + <span class="string">&quot; )&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解器求解</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> solver.check() == z3.sat:</span><br><span class="line">	s = solver.model()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(flag_len):</span><br><span class="line">		flag += <span class="built_in">chr</span>(s[flag_char[i]].as_long())</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ACTF新生赛2020-Universe-final-answer-x86-elf-z3-angr"><a href="#ACTF新生赛2020-Universe-final-answer-x86-elf-z3-angr" class="headerlink" title="[ACTF新生赛2020]Universe_final_answer | x86,elf,z3,angr"></a>[ACTF新生赛2020]Universe_final_answer | x86,elf,z3,angr</h3><p>sub_860 十个未知数，十个方程，未知数对应输入的 key，可以使用 python z3-solver 库来求解多元一次方程组，但我懒得从 ida 上摘方程了，angr 最喜欢这种了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">base_addr = <span class="number">0x400000</span></span><br><span class="line"></span><br><span class="line">project = angr.Project(<span class="string">&quot;./UniverseFinalAnswer&quot;</span>, </span><br><span class="line">				main_opts = &#123;<span class="string">&quot;base_addr&quot;</span> : base_addr&#125;,</span><br><span class="line">				auto_load_libs = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">state = project.factory.entry_state(add_options = &#123;angr.options.LAZY_SOLVES&#125;)</span><br><span class="line">simManager = project.factory.simgr(state)</span><br><span class="line">simManager.explore(find = base_addr + <span class="number">0x71A</span>, avoid = base_addr + <span class="number">0x6EF</span>)</span><br><span class="line"></span><br><span class="line">flag = simManager.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(flag[:<span class="number">10</span>].decode())</span><br></pre></td></tr></table></figure>

<p>得到 F0uRTy_7w@，运行程序，输入该 key 得到 flag</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">in1t</a></span></div><div class="post-cover__authorid"><span class="post-copyright-meta">封面画师: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.pixiv.net/users/9790122">9790122</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://in1nit1t.github.io/2020/11/10/buuoj-%E9%80%86%E5%90%91%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89/">http://in1nit1t.github.io/2020/11/10/buuoj-逆向刷题之旅（一）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://in1nit1t.github.io" target="_blank">in1t's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">逆向</a><a class="post-meta__tags" href="/tags/buuoj/">buuoj</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/buuojre1.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/28/buuoj-%E9%80%86%E5%90%91%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85%EF%BC%88%E4%BA%8C%EF%BC%89/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/buuojre2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">buuoj 逆向刷题之旅（二）</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/13/Xposed%E4%B8%8EEdXposed%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/xposedbuild.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Xposed与EdXposed框架搭建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/02/03/buuoj-逆向刷题之旅（三）/" title="buuoj 逆向刷题之旅（三）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/buuojre3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-03</div><div class="title">buuoj 逆向刷题之旅（三）</div></div></a></div><div><a href="/2020/11/28/buuoj-逆向刷题之旅（二）/" title="buuoj 逆向刷题之旅（二）"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/buuojre2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="title">buuoj 逆向刷题之旅（二）</div></div></a></div><div><a href="/2020/03/18/Source-Insight-3破解/" title="Source Insight 3破解"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/sourceinsight.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-18</div><div class="title">Source Insight 3破解</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#easyre-x86-exe"><span class="toc-number">1.</span> <span class="toc-text">easyre |x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reverse1-x86-exe"><span class="toc-number">2.</span> <span class="toc-text">reverse1 |x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reverse2-x86-elf"><span class="toc-number">3.</span> <span class="toc-text">reverse2 |x86,elf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%B6%B5%E7%9A%84%E8%BD%AF%E4%BB%B6-x86-exe"><span class="toc-number">4.</span> <span class="toc-text">内涵的软件 | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90-x86-exe-upx"><span class="toc-number">5.</span> <span class="toc-text">新年快乐 | x86,exe,upx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-guessgame-x86-exe"><span class="toc-number">6.</span> <span class="toc-text">[BJDCTF 2nd]guessgame | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#helloword-JVM-apk-java%E5%B1%82"><span class="toc-number">7.</span> <span class="toc-text">helloword | JVM,apk,java层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xor-x86-MachO"><span class="toc-number">8.</span> <span class="toc-text">xor | x86,MachO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reverse3-x86-exe-base64"><span class="toc-number">9.</span> <span class="toc-text">reverse3 | x86,exe,base64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84flag-x86-exe-maze"><span class="toc-number">10.</span> <span class="toc-text">不一样的flag | x86,exe,maze</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleRev-x86-elf"><span class="toc-number">11.</span> <span class="toc-text">SimpleRev | x86,elf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E9%80%86%E5%90%91%E8%A7%A3%E5%AF%86-JVM-java%E5%B1%82"><span class="toc-number">12.</span> <span class="toc-text">Java逆向解密 | JVM,java层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96-x86-exe-%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2-base64"><span class="toc-number">13.</span> <span class="toc-text">刮开有奖 | x86,exe,图形界面,base64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF-2nd-8086-x86-exe-DOS"><span class="toc-number">14.</span> <span class="toc-text">[BJDCTF 2nd]8086 | x86,exe,DOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GKCTF2020-Check-1n-x86-exe"><span class="toc-number">15.</span> <span class="toc-text">[GKCTF2020]Check_1n | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#findit-JVM-apk-java%E5%B1%82"><span class="toc-number">16.</span> <span class="toc-text">findit | JVM,apk,java层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-luck-guy-x86-elf-patch"><span class="toc-number">17.</span> <span class="toc-text">[GXYCTF2019]luck_guy | x86,elf,patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%B3%A8%E5%86%8C%E5%99%A8-JVM-apk-java%E5%B1%82"><span class="toc-number">18.</span> <span class="toc-text">简单注册器 | JVM,apk,java层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rsa-rsa"><span class="toc-number">19.</span> <span class="toc-text">rsa | rsa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWCTF-2019-pyre-PVM-pyc"><span class="toc-number">20.</span> <span class="toc-text">[GWCTF 2019]pyre | PVM,pyc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CrackRTF-x86-exe-sha1-md5"><span class="toc-number">21.</span> <span class="toc-text">CrackRTF | x86,exe,sha1,md5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-JustRE-x86-exe-%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2"><span class="toc-number">22.</span> <span class="toc-text">[BJDCTF2020]JustRE | x86,exe,图形界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-easyRE-x86-elf-elf%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">23.</span> <span class="toc-text">[2019红帽杯]easyRE | x86,elf,elf运行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Youngter-drive-x86-exe-upx-%E8%8A%B1%E6%8C%87%E4%BB%A4"><span class="toc-number">24.</span> <span class="toc-text">Youngter-drive | x86,exe,upx,花指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-easyre-x86-exe-upx"><span class="toc-number">25.</span> <span class="toc-text">[ACTF新生赛2020]easyre | x86,exe,upx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%86%8C-JVM-apk-native%E5%B1%82"><span class="toc-number">26.</span> <span class="toc-text">相册 | JVM,apk,native层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUCTF2019-SignIn-x86-elf-RSA"><span class="toc-number">27.</span> <span class="toc-text">[SUCTF2019]SignIn | x86,elf,RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-rome-x86-exe-%E6%81%BA%E6%92%92%E5%AF%86%E7%A0%81"><span class="toc-number">28.</span> <span class="toc-text">[ACTF新生赛2020]rome | x86,exe,恺撒密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUET-CTF2019-re-x86-elf-upx"><span class="toc-number">29.</span> <span class="toc-text">[GUET-CTF2019]re | x86,elf,upx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FlareOn4-login-javascript"><span class="toc-number">30.</span> <span class="toc-text">[FlareOn4]login | javascript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V-amp-N2020-%E5%85%AC%E5%BC%80%E8%B5%9B-strangeCpp-x86-exe"><span class="toc-number">31.</span> <span class="toc-text">[V&amp;N2020 公开赛]strangeCpp | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-easy-x86-exe-patch"><span class="toc-number">32.</span> <span class="toc-text">[BJDCTF2020]easy | x86,exe,patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-usualCrypt-x86-exe-%E5%8F%98%E7%A7%8Dbase64"><span class="toc-number">33.</span> <span class="toc-text">[ACTF新生赛2020]usualCrypt | x86,exe,变种base64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#V-amp-N2020-%E5%85%AC%E5%BC%80%E8%B5%9B-CSRe-x86-exe-NET-%E6%B7%B7%E6%B7%86"><span class="toc-number">34.</span> <span class="toc-text">[V&amp;N2020 公开赛]CSRe | x86,exe,.NET,混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-Transform-x86-exe"><span class="toc-number">35.</span> <span class="toc-text">[MRCTF2020]Transform | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWCTF-2019-xxor-x86-elf-tea"><span class="toc-number">36.</span> <span class="toc-text">[GWCTF 2019]xxor | x86,elf,tea</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDCTF2019-Maze-x86-exe-upx-maze"><span class="toc-number">37.</span> <span class="toc-text">[HDCTF2019]Maze | x86,exe,upx,maze</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-BJD-hamburger-competition-x86-exe-NET-Unity%E6%B8%B8%E6%88%8F"><span class="toc-number">38.</span> <span class="toc-text">[BJDCTF2020]BJD hamburger competition | x86,exe,.NET,Unity游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-level1-x86-elf"><span class="toc-number">39.</span> <span class="toc-text">[WUSTCTF2020]level1 | x86,elf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-level2-x86-elf-upx"><span class="toc-number">40.</span> <span class="toc-text">[WUSTCTF2020]level2 | x86,elf,upx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crackMe-x86-exe-%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="toc-number">41.</span> <span class="toc-text">crackMe | x86,exe,反调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FlareOn4-IgniteMe-x86-exe"><span class="toc-number">42.</span> <span class="toc-text">[FlareOn4]IgniteMe | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-Xor-x86-exe"><span class="toc-number">43.</span> <span class="toc-text">[MRCTF2020]Xor | x86,exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GKCTF2020-BabyDriver-x86-sys-maze"><span class="toc-number">44.</span> <span class="toc-text">[GKCTF2020]BabyDriver | x86,sys,maze</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#firmware-%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90-upx"><span class="toc-number">45.</span> <span class="toc-text">firmware | 固件分析,upx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF2020-hello-world-go-x86-elf-go%E8%AF%AD%E8%A8%80"><span class="toc-number">46.</span> <span class="toc-text">[MRCTF2020]hello_world_go | x86,elf,go语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FlareOn6-Overlong-x86-exe-patch"><span class="toc-number">47.</span> <span class="toc-text">[FlareOn6]Overlong | x86,exe,patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-level3-x86-elf-elf%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">48.</span> <span class="toc-text">[WUSTCTF2020]level3 | x86,elf,elf运行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WUSTCTF2020-Cr0ssfun-x86-elf"><span class="toc-number">49.</span> <span class="toc-text">[WUSTCTF2020]Cr0ssfun | x86,elf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GXYCTF2019-simple-CPP-x86-exe-%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="toc-number">50.</span> <span class="toc-text">[GXYCTF2019]simple CPP | x86,exe,反调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-xx-x86-exe-xxtea"><span class="toc-number">51.</span> <span class="toc-text">[2019红帽杯]xx | x86,exe,xxtea</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-Oruga-x86-elf-maze"><span class="toc-number">52.</span> <span class="toc-text">[ACTF新生赛2020]Oruga | x86,elf,maze</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GWCTF-2019-re3-x86-elf-SMC-md5-AES-ECB"><span class="toc-number">53.</span> <span class="toc-text">[GWCTF 2019]re3 | x86,elf,SMC,md5,AES_ECB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-singal-x86-exe-vm%E8%99%9A%E6%8B%9F%E6%9C%BA-angr"><span class="toc-number">54.</span> <span class="toc-text">[网鼎杯 2020 青龙组]singal | x86,exe,vm虚拟机,angr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUET-CTF2019-number-game-x86-elf-%E4%BA%8C%E5%8F%89%E6%A0%91-%E6%95%B0%E7%8B%AC"><span class="toc-number">55.</span> <span class="toc-text">[GUET-CTF2019]number_game | x86,elf,二叉树,数独</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zer0pts2020-easy-strcmp-x86-elf-elf%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">56.</span> <span class="toc-text">[Zer0pts2020]easy strcmp | x86,elf,elf运行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FlareOn3-Challenge1-x86-exe-%E5%8F%98%E7%A7%8Dbase64"><span class="toc-number">57.</span> <span class="toc-text">[FlareOn3]Challenge1 | x86,exe,变种base64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#equation-javascript-JsFuck%E6%B7%B7%E6%B7%86"><span class="toc-number">58.</span> <span class="toc-text">equation | javascript, JsFuck混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-Universe-final-answer-x86-elf-z3-angr"><span class="toc-number">59.</span> <span class="toc-text">[ACTF新生赛2020]Universe_final_answer | x86,elf,z3,angr</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover/buuojre1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By in1t</div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-orange?style=flat&logo=bitdefender" title="主题采用butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-brightgreen?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);</script><div class="js-pjax"></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="/js/modify.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="💐,🌸,💮,🏵,🌹,🥀,🌺,🌻,🌼,🌷,🌱,🌲,🌳,🌴,🌵,🌾,🌿,☘,🍀,🍁,🍂,🍃,🍇,🍈,🍉,🍊,🍋,🍌,🍍,🍎,🍏,🍐,🍑,🍒,🍓,🥝,🍅,🥥,🥑,🍆,🥔,🥕,🌽,🌶,🥒,🥬,🥦,🧄,🧅,🍄,🥜,🌰,🍞,🥐,🥖,🥨,🥯,🥞,🧇,🧀,🍖,🍗,🥩,🥓,🍔,🍟,🍕,🌭,🥪,🌮,🌯,🥙,🧆,🥚,🍳,🥘,🍲,🥣,🥗,🍿,🧈,🧂,🥫,🍱,🍘,🍙,🍚,🍛,🍜,🍠,🍢,🍣,🍤,🍥,🥮,🍡,🥟,🥠,🥡,🦪,🍨,🍩,🍪,🎂,🍰,🧁,🥧,🍫,🍬,🍭,🍮,🍯,🍼,🥛,☕,🍵,🍶,🍾,🍷,🍹,🍻,🥂,🥃,🥤,🧃,🧉,🧊,🥢,🍽,🥄" data-fontsize="20px" data-random="false" async="async"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":20,"vOffset":-65},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>