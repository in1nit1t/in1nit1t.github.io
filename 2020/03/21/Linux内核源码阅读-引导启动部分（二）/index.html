<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆäºŒï¼‰ | in1t's blog</title><meta name="keywords" content="æ“ä½œç³»ç»Ÿ,Linux0.11"><meta name="author" content="in1t"><meta name="copyright" content="in1t"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="setup.s çš„ä½œç”¨æ˜¯ä¿å­˜ä¸€äº›é‡è¦å‚æ•°ï¼Œå°† system æ¨¡å—ç§»åˆ°å†…å­˜åœ°å€èµ·å§‹å¤„ï¼Œè®¾ç½® GDTR åŠ IDTRï¼Œæ‰“å¼€ A20 åœ°å€çº¿ï¼Œç¼–è¾‘ 8259A èŠ¯ç‰‡ï¼ŒCR0 å¯„å­˜å™¨ PE ä½ç½® 1ï¼Œæœ€åè·³è½¬è‡³ head.s">
<meta property="og:type" content="article">
<meta property="og:title" content="Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆäºŒï¼‰">
<meta property="og:url" content="http://in1nit1t.github.io/2020/03/21/Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%83%A8%E5%88%86%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="in1t&#39;s blog">
<meta property="og:description" content="setup.s çš„ä½œç”¨æ˜¯ä¿å­˜ä¸€äº›é‡è¦å‚æ•°ï¼Œå°† system æ¨¡å—ç§»åˆ°å†…å­˜åœ°å€èµ·å§‹å¤„ï¼Œè®¾ç½® GDTR åŠ IDTRï¼Œæ‰“å¼€ A20 åœ°å€çº¿ï¼Œç¼–è¾‘ 8259A èŠ¯ç‰‡ï¼ŒCR0 å¯„å­˜å™¨ PE ä½ç½® 1ï¼Œæœ€åè·³è½¬è‡³ head.s">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://in1nit1t.github.io/img/cover/boot2.jpg">
<meta property="article:published_time" content="2020-03-21T07:57:57.000Z">
<meta property="article:modified_time" content="2021-07-07T08:20:24.028Z">
<meta property="article:author" content="in1t">
<meta property="article:tag" content="æ“ä½œç³»ç»Ÿ">
<meta property="article:tag" content="Linux0.11">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://in1nit1t.github.io/img/cover/boot2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://in1nit1t.github.io/2020/03/21/Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%83%A8%E5%88%86%EF%BC%88%E4%BA%8C%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆäºŒï¼‰',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-07 16:20:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">39</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> ç•ªå‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> é“¾æ¥</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/boot2.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">in1t's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-play-circle"></i><span> ç•ªå‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> é“¾æ¥</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆäºŒï¼‰</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-03-21T07:57:57.000Z" title="å‘è¡¨äº 2020-03-21 15:57:57">2020-03-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-07-07T08:20:24.028Z" title="æ›´æ–°äº 2021-07-07 16:20:24">2021-07-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>9åˆ†é’Ÿ</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>ä¹‹å‰ä¹Ÿæåˆ°ï¼Œsetup.s çš„ä½œç”¨æ˜¯ä¿å­˜ä¸€äº›é‡è¦å‚æ•°ï¼Œå°† system æ¨¡å—ä» 0x10000 ç§»åˆ°å†…å­˜åœ°å€èµ·å§‹å¤„ï¼Œè®¾ç½®å…¨å±€æè¿°ç¬¦è¡¨å¯„å­˜å™¨åŠä¸­æ–­æè¿°ç¬¦è¡¨å¯„å­˜å™¨ï¼Œæ‰“å¼€ A20 åœ°å€çº¿ï¼Œç¼–è¾‘ 8259A èŠ¯ç‰‡ï¼ŒCR0 å¯„å­˜å™¨ PE ä½ç½® 1ï¼Œè·³è½¬è‡³ head.s</p>
<h2 id="ä¿å­˜å‚æ•°"><a href="#ä¿å­˜å‚æ•°" class="headerlink" title="ä¿å­˜å‚æ•°"></a>ä¿å­˜å‚æ•°</h2><p>å…¶ä¸­ä¿å­˜çš„å‚æ•°æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å†…å­˜åœ°å€</th>
<th align="center">é•¿åº¦(bytes)</th>
<th align="center">åç§°</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x90000</td>
<td align="center">2</td>
<td align="center">å…‰æ ‡ä½ç½®</td>
<td align="left">å…‰æ ‡åˆ—å·ä¸è¡Œå·</td>
</tr>
<tr>
<td align="center">0x90002</td>
<td align="center">2</td>
<td align="center">æ‰©å±•å†…å­˜æ•°</td>
<td align="left">ç³»ç»Ÿä» 1MB å¼€å§‹çš„æ‰©å±•å†…å­˜æ•°å€¼(KB)</td>
</tr>
<tr>
<td align="center">0x90004</td>
<td align="center">2</td>
<td align="center">æ˜¾ç¤ºé¡µé¢</td>
<td align="left">å½“å‰æ˜¾ç¤ºé¡µé¢</td>
</tr>
<tr>
<td align="center">0x90006</td>
<td align="center">1</td>
<td align="center">æ˜¾ç¤ºæ¨¡å¼</td>
<td align="left">å½“å‰æ˜¾ç¤ºæ¨¡å¼</td>
</tr>
<tr>
<td align="center">0x90007</td>
<td align="center">1</td>
<td align="center">å­—ç¬¦åˆ—æ•°</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">0x90008</td>
<td align="center">2</td>
<td align="center">??</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">0x9000A</td>
<td align="center">1</td>
<td align="center">æ˜¾å­˜å¤§å°</td>
<td align="left">(0-64k; 1-128k; 2-192k; 3-256k)</td>
</tr>
<tr>
<td align="center">0x9000B</td>
<td align="center">1</td>
<td align="center">æ˜¾ç¤ºçŠ¶æ€</td>
<td align="left">0-å½©è‰², I/Oç«¯å£=0x3dX; 1-å•è‰², I/Oç«¯å£=0x3bX</td>
</tr>
<tr>
<td align="center">0x9000C</td>
<td align="center">2</td>
<td align="center">ç‰¹æ€§å‚æ•°</td>
<td align="left">æ˜¾å¡ç‰¹æ€§</td>
</tr>
<tr>
<td align="center">â€¦</td>
<td align="center">â€¦</td>
<td align="center">â€¦</td>
<td align="left">â€¦</td>
</tr>
<tr>
<td align="center">0x90080</td>
<td align="center">16</td>
<td align="center">ç¡¬ç›˜å‚æ•°è¡¨</td>
<td align="left">ç¬¬ä¸€ä¸ªç¡¬ç›˜çš„å‚æ•°è¡¨</td>
</tr>
<tr>
<td align="center">0x90090</td>
<td align="center">16</td>
<td align="center">ç¡¬ç›˜å‚æ•°è¡¨</td>
<td align="left">ç¬¬äºŒä¸ªç¡¬ç›˜çš„å‚æ•°è¡¨(å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ¸…é›¶)</td>
</tr>
<tr>
<td align="center">0x901FC</td>
<td align="center">2</td>
<td align="center">æ ¹è®¾å¤‡å·</td>
<td align="left">æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨çš„è®¾å¤‡å·(bootsect å·²ç»è®¾ç½®å¥½)</td>
</tr>
</tbody></table>
<br>

<p>ä¸‹é¢æ˜¯å¯¹å®é™…ä»£ç çš„é˜…è¯»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/* Line 17 */</span><br><span class="line">INITSEG  = 0x9000	/* boosect æ¨¡å—èµ·å§‹åœ°å€ï¼Œç°è¢«ç”¨äºå­˜æ”¾å†…å­˜/æ˜¾å¡ç­‰ä¿¡æ¯ */</span><br><span class="line">SYSSEG   = 0x1000	/* system æ¨¡å—æ‰€åœ¨çš„æ®µåœ°å€ */</span><br><span class="line">SETUPSEG = 0x9020	/* å½“å‰ setup æ¨¡å—æ®µåœ°å€ */</span><br><span class="line"></span><br><span class="line">/* Line 21 */</span><br><span class="line">.globl begtext, begdata, begbss, endtext, enddata, endbss</span><br><span class="line">.text</span><br><span class="line">begtext:</span><br><span class="line">.data</span><br><span class="line">begdata:</span><br><span class="line">.bss</span><br><span class="line">begbss:</span><br><span class="line">.text</span><br><span class="line"></span><br><span class="line">/* Line 226 */</span><br><span class="line">.text</span><br><span class="line">endtext:</span><br><span class="line">.data</span><br><span class="line">enddata:</span><br><span class="line">.bss</span><br><span class="line">endbss:</span><br></pre></td></tr></table></figure>

<p>ä¸ bootsect.s ç›¸åŒï¼Œæœ¬ç¨‹åºå®é™…ä¸Šä¸åˆ†æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/* Line 30 */</span><br><span class="line">entry start</span><br><span class="line">start:</span><br><span class="line">	mov	ax,#INITSEG</span><br><span class="line">	mov	ds,ax		/* å°†æ•°æ®æ®µå¯„å­˜å™¨èµ‹å€¼ 0x9000 */</span><br><span class="line">/* ä¿å­˜å…‰æ ‡ä½ç½® */</span><br><span class="line">	mov	ah,#0x03	/* åŠŸèƒ½å·ä¸º 3ï¼Œè¡¨ç¤ºå–å…‰æ ‡ä½ç½® */</span><br><span class="line">	xor	bh,bh		/* ç¬¬ 0 é¡µ */</span><br><span class="line">	int	0x10		/* è¿”å›å€¼ä¸º DL=åˆ—å·ï¼ŒDH=è¡Œå· */</span><br><span class="line">	mov	[0],dx		/* å­˜å‚¨åœ¨ 0x90000 */</span><br><span class="line">/* ä¿å­˜æ‰©å±•å†…å­˜çš„å¤§å°(KB) */</span><br><span class="line">	mov	ah,#0x88</span><br><span class="line">	int	0x15</span><br><span class="line">	mov	[2],ax		/* å­˜å‚¨åœ¨ 0x90002 */</span><br></pre></td></tr></table></figure>
<p>å…³äº BIOS 0x15 å·ä¸­æ–­ï¼š</p>
<p>åŠŸèƒ½å· AH = 0x88 è¡¨ç¤ºå–ç³»ç»Ÿæ‰€å«æ‰©å±•å†…å­˜çš„å¤§å°ï¼Œè¿”å›å€¼ AX = ä» 0x100000 å¤„å¼€å§‹çš„æ‰©å±•å†…å­˜å¤§å°ï¼Œå‡ºé”™åˆ™å°†é”™è¯¯ç ä¿å­˜åœ¨ AX ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/* Line 51 */</span><br><span class="line">	mov	ah,#0x0f</span><br><span class="line">	int	0x10</span><br><span class="line">	mov	[4],bx		/* å½“å‰æ˜¾ç¤ºé¡µä¿å­˜åœ¨ 0x90004 */</span><br><span class="line">	mov	[6],ax		/* æ˜¾ç¤ºæ¨¡å¼ä¸å­—ç¬¦åˆ—æ•°ä¿å­˜åœ¨ 0x90006 */</span><br><span class="line">/* æ£€æŸ¥æ˜¾ç¤ºæ–¹å¼(EGA/VGA)ï¼Œå¹¶å–å‚æ•° */</span><br><span class="line">	mov	ah,#0x12</span><br><span class="line">	mov	bl,#0x10	/* å– EGA å‚æ•° */</span><br><span class="line">	int	0x10</span><br><span class="line">	mov	[8],ax</span><br><span class="line">	mov	[10],bx		/* æ˜¾å­˜å¤§å°åŠæ˜¾ç¤ºçŠ¶æ€ä¿å­˜åœ¨ 0x9000A */</span><br><span class="line">	mov	[12],cx		/* æ˜¾å¡ç‰¹æ€§å‚æ•°ä¿å­˜åœ¨ 0x9000C */</span><br></pre></td></tr></table></figure>
<p>å…³äº BIOS 0X10 å·ä¸­æ–­ï¼š</p>
<p>åŠŸèƒ½å· AH = 0x0f è¡¨ç¤ºå–æ˜¾å¡å½“å‰æ˜¾ç¤ºæ¨¡å¼ï¼Œè¿”å›å€¼ï¼š</p>
<ul>
<li>AH = æ˜¾ç¤ºçª—å£çš„å­—ç¬¦åˆ—æ•°ï¼ˆwindow widthï¼‰</li>
<li>AL = æ˜¾ç¤ºæ¨¡å¼</li>
<li>BH = å½“å‰æ˜¾ç¤ºé¡µ</li>
</ul>
<p>åŠŸèƒ½å· AH = 0x12ï¼ŒBL = 0x10 è¡¨ç¤ºå– EGA é…ç½®ä¿¡æ¯ï¼Œè¿”å›å€¼ï¼š</p>
<ul>
<li>BH = æ˜¾ç¤ºçŠ¶æ€ï¼ˆ0-å½©è‰²æ¨¡å¼, I/Oç«¯å£=0x3dX; 1-å•è‰²æ¨¡å¼, I/Oç«¯å£=0x3bXï¼‰</li>
<li>BL = å®‰è£…çš„æ˜¾å­˜å¤§å°ï¼ˆ0-64k; 1-128k; 2-192k; 3-256kï¼‰</li>
<li>CX = æ˜¾å¡ç‰¹æ€§å‚æ•°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/* Line 67 */</span><br><span class="line">/* ç¬¬ä¸€ä¸ªç¡¬ç›˜çš„å‚æ•° */</span><br><span class="line">	mov	ax,#0x0000</span><br><span class="line">	mov	ds,ax			/* ds æŒ‡å‘ä¸­æ–­å‘é‡è¡¨ */</span><br><span class="line">/* LDS reg,mem æ„å‘³æŠŠ mem æ‰€æŒ‡çš„ 32 ä½åœ°å€æŒ‡é’ˆçš„æ®µåœ°å€é€å…¥ DS,åç§»åœ°å€é€å…¥ reg */</span><br><span class="line">/* ç¬¬ä¸€ä¸ªç¡¬ç›˜å‚æ•°è¡¨çš„åœ°å€æŒ‡é’ˆæ”¾åœ¨ 0x41 å·ä¸­æ–­å‘é‡å¤„ */</span><br><span class="line">	lds	si,[4*0x41]		/* ç°åœ¨ ds:si æŒ‡å‘ hd0 çš„å‚æ•°è¡¨ */</span><br><span class="line">	mov	ax,#INITSEG</span><br><span class="line">	mov	es,ax</span><br><span class="line">	mov	di,#0x0080</span><br><span class="line">	mov	cx,#0x10	</span><br><span class="line">	rep</span><br><span class="line">	movsb				/* å°† hd0 çš„å‚æ•°è¡¨æ‹·è´è‡³ 0x90080ï¼Œè¡¨é•¿ä¸º 16 ä¸ªå­—èŠ‚ */</span><br><span class="line">/* åŒç†ï¼Œä»¥ä¸‹éƒ¨åˆ†åœ¨å°† hd1 çš„å‚æ•°è¡¨æ‹·è´è‡³ 0x90090 */</span><br><span class="line">	mov	ax,#0x0000</span><br><span class="line">	mov	ds,ax</span><br><span class="line">	lds	si,[4*0x46]		/* ç¬¬äºŒä¸ªç¡¬ç›˜å‚æ•°è¡¨çš„åœ°å€æŒ‡é’ˆä¸º 0x46 å·ä¸­æ–­å‘é‡ */</span><br><span class="line">	mov	ax,#INITSEG</span><br><span class="line">	mov	es,ax</span><br><span class="line">	mov	di,#0x0090</span><br><span class="line">	mov	cx,#0x10</span><br><span class="line">	rep</span><br><span class="line">	movsb</span><br><span class="line">/* ç°åœ¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰ hd1ï¼Œæ²¡æœ‰å°±å°† 0x90090 å¤„ 16 å­—èŠ‚æ¸…ç©º */</span><br><span class="line">	mov	ax,#0x01500		/* åŠŸèƒ½å· 0x15ï¼Œè¡¨ç¤ºå–ç£ç›˜ç±»å‹ */</span><br><span class="line">	mov	dl,#0x81		/* è¦æŸ¥è¯¢ç¬¬äºŒä¸ªç¡¬ç›˜ */</span><br><span class="line">	int	0x13</span><br><span class="line">	jc	no_disk1		/* æ²¡æœ‰è¿™ä¸ªç›˜å°±è·³å» no_disk1 */</span><br><span class="line">	cmp	ah,#3			/* å¦‚æœè¯¥ç£ç›˜ç±»å‹ä¸ºç¡¬ç›˜ */</span><br><span class="line">	je	is_disk1		/* å°±ä¸ä½œå¤„ç†è·³åˆ° is_disk1ï¼Œå¦åˆ™ä»å°†åˆšæ‰è¯»å…¥çš„ç¬¬äºŒç¡¬ç›˜å‚æ•°è¡¨æ¸…ç©º */</span><br><span class="line">no_disk1:				/* å°† 0x90090 å¤„ 16 å­—èŠ‚æ¸…ç©º */</span><br><span class="line">	mov	ax,#INITSEG</span><br><span class="line">	mov	es,ax</span><br><span class="line">	mov	di,#0x0090</span><br><span class="line">	mov	cx,#0x10</span><br><span class="line">	mov	ax,#0x00</span><br><span class="line">	rep</span><br><span class="line">	stosb</span><br><span class="line">is_disk1:</span><br><span class="line">	cli			/* å±è”½æ‰€æœ‰å¤–ä¸­æ–­ï¼Œå‡†å¤‡è¿›è¡Œ system æ¨¡å—çš„ç§»ä½ */</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œé‡è¦å‚æ•°è¯»å®Œï¼Œ</p>
<br>

<h2 id="ç§»åŠ¨-system-amp-è®¾ç½®-GDTR-IDTR"><a href="#ç§»åŠ¨-system-amp-è®¾ç½®-GDTR-IDTR" class="headerlink" title="ç§»åŠ¨ system &amp; è®¾ç½® GDTR/IDTR"></a>ç§»åŠ¨ system &amp; è®¾ç½® GDTR/IDTR</h2><p>æ¥ä¸‹æ¥å°† system ç§»åˆ°å†…å­˜èµ·å§‹å¤„ï¼Œå¹¶è®¾ç½® IDTR ä¸ GDTR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/* Line 113 */</span><br><span class="line">	mov	ax,#0x0000</span><br><span class="line">	cld			/* å°† DF ä½ç½® 0ï¼Œè¡¨ç¤ºåé¢ movsw æ—¶,si ä¸ di å‘é«˜åœ°å€é€’å¢ */</span><br><span class="line">do_move:			/* è¿›å…¥ move å¾ªç¯ */</span><br><span class="line">	mov	es,ax		/* ax ä¸ºä¸Šæ¬¡å¤åˆ¶æ“ä½œçš„ç›®æ ‡æ®µ */</span><br><span class="line">	add	ax,#0x1000	/* åŠ ä¸Š 0x1000 */</span><br><span class="line">	cmp	ax,#0x9000	/* åˆ¤æ–­æ˜¯å¦ç­‰äº 0x9000 */</span><br><span class="line">	jz	end_move	/* ç›¸ç­‰è¡¨ç¤ºç§»åŠ¨å®Œæ¯•ï¼Œè·³å‡ºå¾ªç¯ */</span><br><span class="line">	mov	ds,ax		/* å¦åˆ™å°†ä¸‹ä¸ªç›®æ ‡æ®µæ”¾åœ¨ ds */</span><br><span class="line">	sub	di,di		/* æ¸…ç©º di,si */</span><br><span class="line">	sub	si,si</span><br><span class="line">	mov cx,#0x8000		/* å¾ªç¯æ‹·è´ 0x8000 æ¬¡ */</span><br><span class="line">	rep</span><br><span class="line">	movsw			/* æ¯æ¬¡æ‹·è´ 2 å­—èŠ‚ï¼Œæ‰€ä»¥ä¸€æ¬¡æ‹·è´ 64KB */</span><br><span class="line">	jmp	do_move</span><br><span class="line"></span><br><span class="line">! then we load the segment descriptors</span><br><span class="line"></span><br><span class="line">end_move:</span><br><span class="line">	mov	ax,#SETUPSEG</span><br><span class="line">	mov	ds,ax		/* ds æŒ‡å‘ setup æ¨¡å— */</span><br><span class="line">	lidt	idt_48		/* å°† 6 å­—èŠ‚çš„ 0 è½½å…¥ IDTRï¼ŒæŒ‡å‘ä¸€å¼ ç©ºçš„ä¸­æ–­è¡¨ */</span><br><span class="line">	lgdt	gdt_48		/* å°† GDT ä¿¡æ¯è½½å…¥ GDTR */</span><br><span class="line"></span><br><span class="line">/* Line 205 */</span><br><span class="line">gdt:				/* å®šä¹‰äº† 3 ä¸ªå…¨å±€æè¿°ç¬¦ */</span><br><span class="line">	.word	0,0,0,0		/* ç¬¬ä¸€ä¸ªä¸ºç©ºæè¿°ç¬¦ */</span><br><span class="line"></span><br><span class="line">	.word	0x07FF		/* æ®µç•Œé™ä¸º 8M */</span><br><span class="line">	.word	0x0000		/* æ®µåŸºå€ä¸º 0 */</span><br><span class="line">	.word	0x9A00		/* P=1, DPL=00, S=1, ä»£ç æ®µï¼Œåªè¯»ï¼Œå¯æ‰§è¡Œ */</span><br><span class="line">	.word	0x00C0		/* G ä½ä¸º 1ï¼Œè¡¨ç¤ºé¢—ç²’åº¦ä¸º 4K */</span><br><span class="line"></span><br><span class="line">	.word	0x07FF		/* æ®µç•Œé™ä¸º 8M */</span><br><span class="line">	.word	0x0000		/* æ®µåŸºå€ä¸º 0 */</span><br><span class="line">	.word	0x9200		/* P=1, DPL=00, S=1, æ•°æ®æ®µï¼Œå¯è¯»å¯å†™ */</span><br><span class="line">	.word	0x00C0		/* G ä½ä¸º 1ï¼Œè¡¨ç¤ºé¢—ç²’åº¦ä¸º 4K */</span><br><span class="line">idt_48:</span><br><span class="line">	.word	0		/* idt ç•Œé™ä¸º 0 */</span><br><span class="line">	.word	0,0		/* idt åŸºå€ä¸º 0 */</span><br><span class="line">gdt_48:</span><br><span class="line">	.word	0x800		/* gdt æ®µé™é•¿æš‚æ—¶å®šä¸º 2KBï¼Œèƒ½æ”¾ 256 ä¸ªæè¿°ç¬¦ */</span><br><span class="line">	.word	512+gdt,0x9	/* gdt åŸºå€ä¸º0x90200 + gdt */</span><br></pre></td></tr></table></figure>

<p>GDTR ä¸ IDTR çš„ç»“æ„å†æ¥å›é¡¾ä¸€ä¸‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/s1.png" alt="GDTRä¸IDTR"></p>
<p>æè¿°ç¬¦ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/s2.png" alt="æè¿°ç¬¦"></p>
<p>è¯¦ç»†çš„ä»‹ç»åœ¨ <a href="https://in1nit1t.github.io/2020/03/15/%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/" target="_blank">ä¿æŠ¤æ¨¡å¼</a> è¿™ç¯‡æ–‡ç« ä¸­ã€‚</p>
<br>

<h2 id="æ‰“å¼€-A20-åœ°å€çº¿"><a href="#æ‰“å¼€-A20-åœ°å€çº¿" class="headerlink" title="æ‰“å¼€ A20 åœ°å€çº¿"></a>æ‰“å¼€ A20 åœ°å€çº¿</h2><p>æ­¤æ—¶ system å·²ç»ç§»åˆ°å†…å­˜å¼€å§‹ï¼Œä¸‹é¢æ‰“å¼€ A20 åœ°å€çº¿ï¼Œéœ€è¦æ‰“å¼€ A20 åœ°å€çº¿çš„åŸå› æ˜¯å®æ¨¡å¼ä¸‹ A20 åœ°å€çº¿é»˜è®¤å…³é—­ï¼Œåªèƒ½è®¿é—® 1M çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰“å¼€åå¯ä»¥è®¿é—®æ‰€æœ‰ 4G ç©ºé—´</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/* Line 138 */</span><br><span class="line">	call	empty_8042		/* åå¤æµ‹è¯• 8042 çŠ¶æ€å¯„å­˜å™¨ï¼Œåˆ¤æ–­è¾“å…¥ç¼“å†²å™¨æ˜¯å¦ä¸ºç©º */</span><br><span class="line">	mov	al,#0xD1		/* 0xD1 å‘½ä»¤ç è¡¨ç¤ºå†™æ•°æ®åˆ° 8042 çš„ P2 ç«¯å£ */</span><br><span class="line">	out	#0x64,al		/* P2 ç«¯å£ä½ 1 ç”¨äº A20 åœ°å€çº¿çš„é€‰é€š */</span><br><span class="line">	call	empty_8042		/* ç­‰å¾…è¾“å…¥ç¼“å†²å™¨ä¸ºç©ºï¼ŒæŸ¥çœ‹å‘½ä»¤æ˜¯å¦è¢«æ¥å— */</span><br><span class="line">	mov	al,#0xDF		/* 0xD1 å‘½ä»¤ç è¡¨ç¤ºæ‰“å¼€ A20 åœ°å€çº¿ */</span><br><span class="line">	out	#0x60,al		/* æ•°æ®å†™åˆ° 0x60 å£ */</span><br><span class="line">	call	empty_8042		/* è‹¥æ­¤æ—¶è¾“å…¥ç¼“å†²å™¨ä¸ºç©ºï¼Œè¡¨ç¤º A20 å·²ç»æ‰“å¼€ */</span><br><span class="line"></span><br><span class="line">/* Line 198 */</span><br><span class="line">empty_8042:</span><br><span class="line">	.word	0x00eb,0x00eb		/* æ•ˆæœç±»ä¼¼ nop */</span><br><span class="line">	in	al,#0x64		/* è¯» AT é”®ç›˜æ§åˆ¶å™¨çŠ¶æ€å¯„å­˜å™¨ */</span><br><span class="line">	test	al,#2			/* æµ‹è¯•ä½ 1ï¼Œåˆ¤æ–­è¾“å…¥ç¼“å†²å™¨æ˜¯å¦ä¸ºç©º */</span><br><span class="line">	jnz	empty_8042		/* è‹¥éç©ºï¼Œåˆ™è·³å›å»å¾ªç¯åˆ¤æ–­ */</span><br><span class="line">	ret				/* å¦åˆ™è¿”å› */</span><br></pre></td></tr></table></figure>

<p>0xeb æ˜¯è¿‘åœ°å€è·³è½¬çš„æ“ä½œç ï¼Œå¯ä»¥æºå¸¦ä¸€ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œæ•…è·³è½¬èŒƒå›´åœ¨ -127 ~ 127 ä¹‹é—´ï¼Œ0x00eb è¡¨ç¤ºè·³è½¬åˆ°ç›¸å¯¹ä¸‹ä¸€æ¡æŒ‡ä»¤åç§»å€¼ä¸º 0 çš„æŒ‡ä»¤ï¼Œç›¸å½“äºç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ŒèŠ±è´¹çš„ CPU æ—¶é’Ÿå‘¨æœŸæ•°æ˜¯ 7~ 10 ä¸ªï¼Œä¸¤æ¡å°±å¯ä»¥é€ æˆ 14 ~ 20 ä¸ªæ—¶é’Ÿå‘¨æœŸçš„å»¶è¿Ÿï¼Œä¸€ä¸ª nop æŒ‡ä»¤åªèŠ±è´¹ 3 ä¸ªæ—¶é’Ÿå‘¨æœŸæ•°ã€‚å› ä¸º as86 ä¸­æ²¡æœ‰ç›¸åº”çš„æŒ‡ä»¤åŠ©è®°ç¬¦ï¼Œæ‰€ä»¥ Linus ç›´æ¥ä½¿ç”¨äº†æœºå™¨ç </p>
<br>

<h2 id="ç¼–è¾‘-8259A-èŠ¯ç‰‡"><a href="#ç¼–è¾‘-8259A-èŠ¯ç‰‡" class="headerlink" title="ç¼–è¾‘ 8259A èŠ¯ç‰‡"></a>ç¼–è¾‘ 8259A èŠ¯ç‰‡</h2><p>æ¥ä¸‹æ¥è¯¥å¯¹ 8259A èŠ¯ç‰‡é‡æ–°ç¼–ç¨‹ï¼Œå°†ç¡¬ä»¶ä¸­æ–­å·è®¾ç½®æˆä» 0x20 å¼€å§‹ã€‚PC æœºä½¿ç”¨ä¸¤ç‰‡ 8259Aï¼Œä¸»ç‰‡çš„æ“ä½œç«¯å£æ˜¯ 0x20 - 0x21ï¼Œä»ç‰‡çš„ç«¯å£æ˜¯ 0xA0 - 0xA1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/* Line 154 */</span><br><span class="line">	mov	al,#0x11		</span><br><span class="line">	out	#0x20,al		/* å¾€ä¸»ç‰‡ç«¯å£å‘é€ 0x11 ICW1å‘½ä»¤å­—ï¼Œè¡¨ç¤ºåˆå§‹åŒ–å‘½ä»¤å¼€å§‹ */</span><br><span class="line">	.word	0x00eb,0x00eb		/* nop */</span><br><span class="line">	out	#0xA0,al		/* å†å°†åˆå§‹åŒ–ä¿¡å·å‘é€ç»™ä»ç‰‡ */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0x20</span><br><span class="line">	out	#0x21,al		/* å‘é€ä¸»ç‰‡ ICW2 å‘½ä»¤å­—ï¼Œè®¾ç½®ä¸»ç‰‡èµ·å§‹ä¸­æ–­å·ä¸º 0x20ï¼Œè¦å‘ç»™å¥‡ç«¯å£ */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0x28</span><br><span class="line">	out	#0xA1,al		/* å‘é€ä»ç‰‡ ICW2 å‘½ä»¤å­—ï¼Œè®¾ç½®ä»ç‰‡èµ·å§‹ä¸­æ–­å·ä¸º 0x28 */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0x04</span><br><span class="line">	out	#0x21,al		/* å‘é€ä¸»ç‰‡ ICW3 å‘½ä»¤å­—ï¼Œè¡¨ç¤ºä¸»ç‰‡ IR2 è¿æ¥ä»ç‰‡ INT */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0x02</span><br><span class="line">	out	#0xA1,al		/* å‘é€ä»ç‰‡ ICW3 å‘½ä»¤å­—ï¼Œè¡¨ç¤ºä»ç‰‡ INT è¿æ¥ä¸»ç‰‡ IR2 */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0x01</span><br><span class="line">	out	#0x21,al		/* å‘é€ä¸»ç‰‡ ICW4 å‘½ä»¤å­—ï¼Œ8086 æ¨¡å¼ */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	out	#0xA1,al		/* å‘é€ä»ç‰‡ ICW4 å‘½ä»¤å­—ï¼Œ8086 æ¨¡å¼ï¼Œåˆå§‹åŒ–ç»“æŸï¼ŒèŠ¯ç‰‡å°±ç»ª */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	mov	al,#0xFF</span><br><span class="line">	out	#0x21,al		/* å±è”½ä¸»ç‰‡æ‰€æœ‰ä¸­æ–­è¯·æ±‚ */</span><br><span class="line">	.word	0x00eb,0x00eb</span><br><span class="line">	out	#0xA1,al		/* å±è”½ä»ç‰‡æ‰€æœ‰ä¸­æ–­è¯·æ±‚ */</span><br></pre></td></tr></table></figure>

<br>

<h2 id="è¿›å…¥ä¿æŠ¤æ¨¡å¼"><a href="#è¿›å…¥ä¿æŠ¤æ¨¡å¼" class="headerlink" title="è¿›å…¥ä¿æŠ¤æ¨¡å¼"></a>è¿›å…¥ä¿æŠ¤æ¨¡å¼</h2><p>ç„¶åæ˜¯ setup.s æœ€åéƒ¨åˆ†ï¼ŒPE ç½®ä½ï¼Œè¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œç»“æŸè¿ Linus éƒ½è§‰å¾—æ— èŠçš„ä¸ BIOSã€ç¡¬ä»¶ç­‰æ‰“äº¤é“çš„è¿‡ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* Line 191 */</span><br><span class="line">	mov	ax,#0x0001</span><br><span class="line">	lmsw	ax		/* å°† CR0 PE ä½ç½® 1 */</span><br><span class="line">	jmpi	0,8		/* è·³è½¬è‡³ head.s æ‰§è¡Œ  */</span><br></pre></td></tr></table></figure>

<p>lmsw æŒ‡ä»¤æ„ä¸ºç½®å¤„ç†å™¨çŠ¶æ€å­—ï¼Œåªæœ‰æ“ä½œæ•°çš„ä½ 4 ä½è¢«å­˜å…¥ CR0ï¼Œè¯¥æŒ‡ä»¤ä»…å…¼å®¹ 286 çš„ CPUï¼Œ386 ä»¥ä¸Šçš„ CPU åº”è¯¥ä½¿ç”¨ â€œmov cr0, axâ€ åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ã€‚åŒæ—¶åœ¨è®¾ç½® PE ä½åï¼Œéšåçš„ä¸€æ¡æŒ‡ä»¤<strong>å¿…é¡»æ˜¯æ®µé—´è·³è½¬æŒ‡ä»¤</strong>ï¼Œä»¥åˆ·æ–° CPU æå‰ä»å†…å­˜å–å‡ºå¹¶è§£ç çš„å®æ¨¡å¼æŒ‡ä»¤é˜Ÿåˆ—</p>
<p>æ‰§è¡Œæœ€åä¸€æ¡è·³è½¬æŒ‡ä»¤æ—¶ï¼Œå·²å¤„äºä¿æŠ¤æ¨¡å¼ï¼Œæ“ä½œæ•° 8 ä¸ºæ®µé€‰æ‹©å­ï¼Œ16 ä½äºŒè¿›åˆ¶å½¢å¼ä¸º 0b0000 0000 0000 1000ï¼Œæœ€ä½ä¸¤ä½ä¸º RPLï¼Œ0 è¡¨ç¤ºå†…æ ¸çº§ï¼Œç¬¬ä¸‰ä½ä¸º TI ä½ï¼Œ0 è¡¨ç¤ºä» GDT ä¸­é€‰æ‹©æè¿°ç¬¦ï¼Œå…¶ä½™é«˜ä½ä¸ºç´¢å¼•ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºé€‰æ‹©ç¬¬ 2 é¡¹ã€‚å¦ä¸€ä¸ªæ“ä½œæ•° 0ï¼Œè¡¨ç¤ºæ®µå†…åç§»é‡ä¸º 0ã€‚GDT ä¸­ç¬¬äºŒé¡¹åç§» 0ï¼ŒæŒ‡å‘ç‰©ç†åœ°å€èµ·å§‹ä½ç½®ï¼Œè¯¥å¤„ä¸º head æ¨¡å—ã€‚è¿˜è®°å¾—æ®µé€‰æ‹©å­ç»“æ„å—ï¼Ÿ</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="../img/s3.png" alt="é€‰æ‹©å­"></p>
<p>å…³äºé”®ç›˜æ§åˆ¶å™¨ 8042 ä¸ 8259A èŠ¯ç‰‡çš„ç¼–ç¨‹æ–¹æ³•æœ‰å¿…è¦æ—¶å†ä¸“é—¨è®°å½•åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">in1t</a></span></div><div class="post-cover__authorid"><span class="post-copyright-meta">å°é¢ç”»å¸ˆ: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.pixiv.net/users/9790122">9790122</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://in1nit1t.github.io/2020/03/21/Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%83%A8%E5%88%86%EF%BC%88%E4%BA%8C%EF%BC%89/">http://in1nit1t.github.io/2020/03/21/Linuxå†…æ ¸æºç é˜…è¯»-å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆäºŒï¼‰/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://in1nit1t.github.io" target="_blank">in1t's blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a><a class="post-meta__tags" href="/tags/Linux0-11/">Linux0.11</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/boot2.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/22/Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%83%A8%E5%88%86%EF%BC%88%E4%B8%89%EF%BC%89/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/boot3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆä¸‰ï¼‰</div></div></a></div><div class="next-post pull-right"><a href="/2020/03/20/Linux%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%83%A8%E5%88%86%EF%BC%88%E4%B8%80%EF%BC%89/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/boot1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Linuxå†…æ ¸æºç é˜…è¯»--å¼•å¯¼å¯åŠ¨éƒ¨åˆ†ï¼ˆä¸€ï¼‰</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2020/04/11/Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆä¸‰ï¼‰/" title="Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆä¸‰ï¼‰"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/kernel3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-11</div><div class="title">Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆä¸‰ï¼‰</div></div></a></div><div><a href="/2020/04/27/Linuxå†…æ ¸æºç é˜…è¯»-mm/" title="Linuxå†…æ ¸æºç é˜…è¯»-mm"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/mmmodule.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-27</div><div class="title">Linuxå†…æ ¸æºç é˜…è¯»-mm</div></div></a></div><div><a href="/2020/04/13/Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆå››ï¼‰/" title="Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆå››ï¼‰"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/cover/kernel4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-13</div><div class="title">Linuxå†…æ ¸æºç é˜…è¯»-kernelï¼ˆå››ï¼‰</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%8F%82%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">ä¿å­˜å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8-system-amp-%E8%AE%BE%E7%BD%AE-GDTR-IDTR"><span class="toc-number">2.</span> <span class="toc-text">ç§»åŠ¨ system &amp; è®¾ç½® GDTR&#x2F;IDTR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%BC%80-A20-%E5%9C%B0%E5%9D%80%E7%BA%BF"><span class="toc-number">3.</span> <span class="toc-text">æ‰“å¼€ A20 åœ°å€çº¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91-8259A-%E8%8A%AF%E7%89%87"><span class="toc-number">4.</span> <span class="toc-text">ç¼–è¾‘ 8259A èŠ¯ç‰‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">è¿›å…¥ä¿æŠ¤æ¨¡å¼</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover/boot2.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By in1t</div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-orange?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-brightgreen?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);</script><div class="js-pjax"></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="/js/modify.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="ğŸ’,ğŸŒ¸,ğŸ’®,ğŸµ,ğŸŒ¹,ğŸ¥€,ğŸŒº,ğŸŒ»,ğŸŒ¼,ğŸŒ·,ğŸŒ±,ğŸŒ²,ğŸŒ³,ğŸŒ´,ğŸŒµ,ğŸŒ¾,ğŸŒ¿,â˜˜,ğŸ€,ğŸ,ğŸ‚,ğŸƒ,ğŸ‡,ğŸˆ,ğŸ‰,ğŸŠ,ğŸ‹,ğŸŒ,ğŸ,ğŸ,ğŸ,ğŸ,ğŸ‘,ğŸ’,ğŸ“,ğŸ¥,ğŸ…,ğŸ¥¥,ğŸ¥‘,ğŸ†,ğŸ¥”,ğŸ¥•,ğŸŒ½,ğŸŒ¶,ğŸ¥’,ğŸ¥¬,ğŸ¥¦,ğŸ§„,ğŸ§…,ğŸ„,ğŸ¥œ,ğŸŒ°,ğŸ,ğŸ¥,ğŸ¥–,ğŸ¥¨,ğŸ¥¯,ğŸ¥,ğŸ§‡,ğŸ§€,ğŸ–,ğŸ—,ğŸ¥©,ğŸ¥“,ğŸ”,ğŸŸ,ğŸ•,ğŸŒ­,ğŸ¥ª,ğŸŒ®,ğŸŒ¯,ğŸ¥™,ğŸ§†,ğŸ¥š,ğŸ³,ğŸ¥˜,ğŸ²,ğŸ¥£,ğŸ¥—,ğŸ¿,ğŸ§ˆ,ğŸ§‚,ğŸ¥«,ğŸ±,ğŸ˜,ğŸ™,ğŸš,ğŸ›,ğŸœ,ğŸ ,ğŸ¢,ğŸ£,ğŸ¤,ğŸ¥,ğŸ¥®,ğŸ¡,ğŸ¥Ÿ,ğŸ¥ ,ğŸ¥¡,ğŸ¦ª,ğŸ¨,ğŸ©,ğŸª,ğŸ‚,ğŸ°,ğŸ§,ğŸ¥§,ğŸ«,ğŸ¬,ğŸ­,ğŸ®,ğŸ¯,ğŸ¼,ğŸ¥›,â˜•,ğŸµ,ğŸ¶,ğŸ¾,ğŸ·,ğŸ¹,ğŸ»,ğŸ¥‚,ğŸ¥ƒ,ğŸ¥¤,ğŸ§ƒ,ğŸ§‰,ğŸ§Š,ğŸ¥¢,ğŸ½,ğŸ¥„" data-fontsize="20px" data-random="false" async="async"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":20,"vOffset":-65},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>